/**
 * om midi v3.10.25.0
 * 简称 OMM，After Effects 的音 MAD / YTPMV 辅助脚本。它是一个能够自动将 MIDI 文件转换为 After Effects 中关键帧的脚本。
 * 希望在 om midi 的帮助下，可以把人们从枯燥繁重的音画对齐中解救出来，把更多的精力投入到更有创造性的工作中。
 *
 * 描述：读取一个 MIDI 序列，并为当前合成添加一个或多个新图层，其中包含各个 MIDI 轨道的音高、力度和持续时间等滑块控件。
 *
 * 脚本原作者：大卫·范·布林克 (omino)、Dora (NGDXW)、韩琦、家鳖大帝
 * 脚本作者：兰音
 *
 * 在此处获取最新版：https://github.com/otomad/om_midi/releases/latest
 * 仓库地址：https://github.com/otomad/om_midi
 *
 * 构建日期：2022 年 10 月 24 日 星期一 晚上 23:07:53
 * Copyright (c) 2022 ~, Ranne
 *
 * 原作者介绍：
 * 日期：2011 年 12 月 25 日 星期日 晚上 22:58:10 太平洋时间
 * 作者：大卫·范·布林克
 *
 * 此脚本是 omino Adobe 脚本套件的一部分。
 * 我写这些是因为我喜欢。请尽情享受。
 * 向 poly@omino.com 提出问题，主题行应以“插件”开头，以便我的垃圾邮件过滤器允许它。
 * 此文件已被预处理为独立脚本。我针对一些可重用的库开发它们⸺例如对话框布局⸺但对于分发来说，最好只有一个文件。
 * 大卫·范·布林克 2007。
 *
 * ****************************************************************************************************
 *
 * om midi v3.10.25.0
 * Or OMM for short, an Otomad/YTPMV assistant script for After Effects. It is a script that automatically
 * converts MIDI files to keyframes in After Effects. Hope that with the help of om midi, people can be
 * rescued from tedious aligning video and audio, and put more energy into more creative works.
 *
 * Description: This After Effects script reads a Standard MIDI file (.mid)
 * and creates layers and keyframes corresponding to the notes and controllers in that MIDI file.
 *
 * Script Original Authors: David Van Brink (omino), Dora (NGDXW), HanceyMica, Z4HD
 * Script Author: Ranne
 *
 * Get the Latest Version Here: https://github.com/otomad/om_midi/releases/latest
 * Repository Link: https://github.com/otomad/om_midi
 *
 * Building Date: Monday, October 24, 2022 11:07 PM
 * Copyright (c) 2022 ~, Ranne
 *
 * Introduction by the Original Author:
 * Date: Sunday, December 25, 2011 10:58 PM PST
 * Author: David Van Brink
 * This script is part of the omino adobe script suite.
 *
 * I write these because I like to. Please enjoy as you see fit.
 *
 * Questions to poly@omino.com, subject line should start with "plugins" so my spam filter lets it in.
 *
 * This file has been preprocessed to be standalone. I develop them against some reusable libraries
 * ⸺ such as for dialog layout ⸺ but for distribution it's nicer to have just one file.
 * dvb 2007.
 */

(function(t){var e={scriptName:"om midi",version:"3.10.25.0",githubPage:unescape("%68%74%74%70%73%3a%2f%2f%67%69%74%68%75%62%2e%63%6f%6d%2f%6f%74%6f%6d%61%64%2f%6f%6d%5f%6d%69%64%69"),githubLatest:unescape("%68%74%74%70%73%3a%2f%2f%67%69%74%68%75%62%2e%63%6f%6d%2f%6f%74%6f%6d%61%64%2f%6f%6d%5f%6d%69%64%69%2f%72%65%6c%65%61%73%65%73%2f%6c%61%74%65%73%74")};function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function r(t,e){for(var r in e)try{if(i(e,r))t[r]=e[r]}catch(t){}return t}function n(t,e,i,n){var a;if("group"===e)a=t.add(e,void 0,n);else if("progressbar"===e)a=t.add(e,void 0,void 0,void 0,n);else if("scrollbar"===e||"slider"===e)a=t.add(e,void 0,void 0,void 0,void 0,n);else a=t.add(e,void 0,void 0,n);var o=a;if(void 0!==i)r(o,i);return o}function a(t){var e=[];for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=t.items.length?t.getSelectedIndex():0;t.removeAll();for(var n=0,a=e;n<a.length;n++){var o=a[n];t.add("item",o)}t.selection=r;return t}function o(t,e,i,r,a){var o=function(){return n(t,"group",{orientation:"row",spacing:7,alignment:"fill",alignChildren:"fill"})};var l=function(t){var e=60;t.minimumSize=[e,Number.MAX_VALUE]};var s=function(t,e){var i=n(t,"statictext",{text:e});l(i);return i};var c=o();var u=s(c,e);var p=void 0;if(i)p=n(c,i,r,a);var h={group:c,label:u,control:p};return h}var l=function(t,e){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i))t[i]=e[i]};return l(t,e)};function s(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");l(t,e);function i(){this.constructor=t}t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var c=function(){c=Object.assign||function t(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var a in i)if(Object.prototype.hasOwnProperty.call(i,a))e[a]=i[a]}return e};return c.apply(this,arguments)};function u(t,e,i){if(i||2===arguments.length)for(var r=0,n=e.length,a;r<n;r++)if(a||!(r in e)){if(!a)a=Array.prototype.slice.call(e,0,r);a[r]=e[r]}return t.concat(a||Array.prototype.slice.call(e))}var p={ok:"OK",cancel:"Cancel",channel_abbr:"CH",error:"Error",warning:"Warning",apply:"Apply",settings:"Settings",select_all:"Select all",channel:"Channel",name:"name",note_count:"Note count",language:"Language",general:"General",app_default:"App Default",tools:"Tools",create_null_object_short:"Null",create_null_object:"Create Null Object",apply_effects_short:"Effects",apply_effects:"Apply Effects",marker_conductor:"Marker Conductor",easing_100_percent:"Easing 100%",unit:"Unit",time:"Time",frames:"Frames",seconds:"Seconds",beat:"Beat",shift_seconds_and_frames:"Shift",mark_on:"Mark on",add_null_layer:"Add null layer",current_layer:"Current layer",ease_in:"Ease in",ease_out:"Ease out",ease_in_out:"Ease in out",midi_track_selector_title:"Select MIDI tracks",select_at_least_one_track:"Please select at least one track.",no_midi_file_selected:"No MIDI file selected",select_midi_file:"MIDI",select_midi_track:"Track",set_midi_bpm:"BPM",start_time:"Start time",display_start_time:"Display start time",current_time:"Current time",work_area:"Work area",select_a_midi_file:"Select a MIDI Sequence",midi_files:"MIDI Sequence",all_files:"All Files",check_update:"Check for updates",repository_link:"Repository link",about_script_engine:"About ExtendScript engine",import_om_utils:"Import om utils",import_pure_quarter_midi:"Import pure quarter MIDI",using_selected_layer_name:"Use selected layer name instead of MIDI track name.",normalize_pan_to_100:"Normalize the pan to -100 ~ 100.",using_layering:"@Koorihato Sakuno's unique layering method.",optimize_apply_effects:"Optimize some effects visual.",add_to_effect_transform:"Add the properties to an effect called Transform.",sure_to_import_pure_quarter_midi:"Are you sure you want to import the pure quarter notes MIDI file?",pure_quarter_midi:"Pure quarter notes MIDI",add_at_top_of_expression:"Prepend to expressions",om_utils_same_as_project_directory:"If placed in the same directory as the aep project",om_utils_added_to_project:"If placed anywhere, and then add to AE project",pitch:"Pitch",velocity:"Velocity",duration:"Duration",scale:"Scale",cw_rotation:"Clockwise Rotation",ccw_ratation:"Counterclockwise Rotation",count:"Count",bool:"Bool",time_remap:"Time Remap",pingpong:"Ping-pong",note_on:"Note On",channel_pan:"Channel Pan",channel_volume:"Channel Volume",channel_glide:"Channel Glide",horizontal_flip:"Horizontal Flip",invert_color:"Invert Color",tuning:"Tuning",base_pitch:"Base pitch",paren_stretched:" (Stretched)",paren_truncated:" (Truncated)",cannot_find_window_error:"Error: Unable to find or create window.",unsupported_setting_type_error:"Error: Unsupported setting data type.",file_unreadable_error:"Error: Could not read the MIDI file. The file may already be occupied or not exist.",midi_header_validation_error:"Error: MIDI file header chunks validation failed (not a standard MIDI file or this file is corrupt).",midi_track_header_validation_error:"Error: MIDI track header chunks validation failed.",midi_custom_events_error:"Error: Custom MIDI events could not be read.",midi_no_track_error:"Error: This MIDI file does not contain any valid tracks.",not_after_effects_error:"Error: Please use this script on Adobe After Effects.",cannot_create_file_error:"Error: Could not create file.",cannot_find_composition_error:"Error: Could not find an active composition. Please activate a composition first.\n\nSolution: Open a composite first, then click on the composite preview or track window to make it active.",no_midi_error:"Error: Please open a valid MIDI file first.",no_options_checked_error:"Error: Please check at least one option.",no_layer_selected_error:"Error: No layers are selected in the current composition.",not_one_track_for_apply_effects_only_error:"Error: Applying effects can only select one MIDI track at one time.",end_of_track_position_error:"Error: Track ends in wrong position. Expected %1, actually %2.",cannot_set_time_remap_error:"Error: Time remapping cannot be set for the selected layer.",cannot_tuning_error:"Error: The selected layer does not contain audio so that cannot be tuned.",about:"It reads a Standard MIDI sequence file and creates layers and keyframes corresponding to the notes and controllers in that MIDI sequence file.\n\nVersion: %4\nApp: %2\nSpecifier: %3\n\nScript Original Authors: David Van Brink (omino), Dora (NGDXW), HanceyMica, Z4HD\nScript Author: Ranne\nRepository Link: %1",horizontal_mirror:"Horizontal Mirror",advanced_scale:"Advanced Scale",loading_midi:"Loading %1 ...",unsupported_fps_time_division_error:"Error: The current mode does not support frames per second time division data format.",low_version_error:"Error: Using Adobe After Effects software version is too low, please update.",map_velocity:"Mapping Velocity",map_velocity_to_opacity:"Mapping Velocity to Opacity",map_velocity_to_volume:"Mapping Velocity to Volume",opacity:"Opacity",audio_levels:"Audio levels",notes_velocity:"Notes velocity",has_no_video_error:"Error: The selected layer does not contain video so that the selected effect cannot be applied."};var h={ok:"OK",cancel:"キャンセル",channel_abbr:"チャネル",error:"エラー",warning:"警告",apply:"適用",settings:"設定",select_all:"すべて選択",channel:"チャネル",name:"名",note_count:"音符の数",language:"言語",general:"一般",app_default:"アプリのデフォルト",tools:"ツール",create_null_object_short:"ヌル",create_null_object:"ヌル オブジェクトを作成",apply_effects_short:"効果を適用",apply_effects:"効果を適用",marker_conductor:"マーカー司令官",easing_100_percent:"イージング百パーセント",unit:"単位",time:"時間",frames:"フレーム",seconds:"秒数",beat:"拍子",shift_seconds_and_frames:"シフト",mark_on:"どこ",add_null_layer:"ヌルレイヤーを追加",current_layer:"現在のレイヤー",ease_in:"イーズイン",ease_out:"イーズアウト",ease_in_out:"イーズインアウト",midi_track_selector_title:"MIDI トラックを選択",select_at_least_one_track:"少なくとも 1 つのトラックを選択してください。",no_midi_file_selected:"MIDI が選択されていない",select_midi_file:"MIDI",select_midi_track:"トラック",set_midi_bpm:"BPM",start_time:"開始時刻",display_start_time:"表示開始時刻",current_time:"現在の時刻",work_area:"作業エリア",select_a_midi_file:"MIDI シーケンスを選択する",midi_files:"MIDI シーケンス",all_files:"全ファイル",check_update:"アップデートを確認",repository_link:"リポジトリ リンク",about_script_engine:"スクリプトエンジンについて",import_om_utils:"om utils をインポート",import_pure_quarter_midi:"純粋な 4 分 MIDI をインポート",using_selected_layer_name:"MIDI トラック名の代わりに、選択したレイヤー名を使用します。",normalize_pan_to_100:"パンを -100~100 に正規化します。",using_layering:"@氷鳩さくのの特有なレイヤリング方法。",optimize_apply_effects:"一部のエフェクトのビジュアルを最適化。",add_to_effect_transform:"変換という効果にプロパティを追加します。",sure_to_import_pure_quarter_midi:"純粋な 4 分音符 MIDI ファイルをインポートしてもよろしいですか？",pure_quarter_midi:"純粋な 4 分音符 MIDI",add_at_top_of_expression:"式の先頭に追加",om_utils_same_as_project_directory:"AEP プロジェクトと同じディレクトリに配置する場合",om_utils_added_to_project:"任意の場所に配置し、AE プロジェクトに追加する場合",pitch:"ピッチ",velocity:"ベロシティ",duration:"持続時間",scale:"スケール",cw_rotation:"右回り",ccw_ratation:"左回り",count:"カウント",bool:"ブール",time_remap:"時間リマップ",pingpong:"ピンポン",note_on:"音符オン",channel_pan:"チャンネルパン",channel_volume:"チャンネル音量",channel_glide:"チャンネルポルタメント",horizontal_flip:"水平方向にフリップ",invert_color:"色を反転",tuning:"色を反転",base_pitch:"ベースピッチ",paren_stretched:"（ストレッチ）",paren_truncated:"（切り捨て）",cannot_find_window_error:"エラー：ウィンドウが見つからないか作成できません。",unsupported_setting_type_error:"エラー：サポートされていないセット データ型です。",file_unreadable_error:"エラー：MIDI ファイルを読み取れませんでした。ファイルが既に占有されているか、存在しない可能性があります。",midi_header_validation_error:"エラー：MIDI ファイル ヘッダー チャンクの検証に失敗しました（標準の MIDI ファイルではないか、ファイルが破損しています）。",midi_track_header_validation_error:"エラー：MIDI トラック ヘッダー チャンクの検証に失敗しました。",midi_custom_events_error:"エラー：カスタム MIDI イベントを読み取れませんでした。",midi_no_track_error:"エラー：MIDI ファイルに有効なトラックが含まれていません。",not_after_effects_error:"エラー：Adobe After Effects でこのスクリプトを使用してください。",cannot_create_file_error:"エラー：ファイルを作成できませんでした。",cannot_find_composition_error:"エラー：アクティブな構成が見つかりません。最初にコンポジションをアクティブにしてください。\n\n解決策: まずコンポジットを開き、コンポジット プレビューまたはトラック ウィンドウをクリックしてアクティブにします。",no_midi_error:"エラー：最初に有効な MIDI ファイルを開いてください。",no_options_checked_error:"エラー：少なくとも 1 つのオプションをオンにしてください。",no_layer_selected_error:"エラー：現在のコンポジションでレイヤーが選択されていません。",not_one_track_for_apply_effects_only_error:"エラー：エフェクトを適用すると、一度に選択できる MIDI トラックは 1 つだけです。",end_of_track_position_error:"エラー：トラックの終了位置が間違っています。期待される %1、実際には %2。",cannot_set_time_remap_error:"エラー：選択したレイヤーにタイム リマップを設定できません。",cannot_tuning_error:"エラー：選択したレイヤーにはオーディオが含まれていないため、調整できません。",about:"標準 MIDI ファイルを読み取り、その MIDI ファイル内のノートとコントローラーに対応するレイヤーとキーフレームを作成します。\n\nバージョン：%4\nアプリ：%2\nスペック：%3\n\n脚本原作者：デビッド・ヴァン・ブリンク（オミノ）、ドラ (NGDXW)、韓琦、家鼈大帝\n脚本作者：蘭音\nリポジトリ リンク：%1",horizontal_mirror:"水平方向のミラー",advanced_scale:"高度なスケール",loading_midi:"%1 を読み込んでいます...",unsupported_fps_time_division_error:"エラー：現在のモードは、FPS 時分割データフォーマットに対応していません。",low_version_error:"エラー：Adobe After Effects のソフトウェアのバージョンが低すぎるため、アップデートしてください。",map_velocity:"ベロシティのマッピング",map_velocity_to_opacity:"ベロシティと不透明度のマッピング",map_velocity_to_volume:"ベロシティとオーディオレベルのマッピング",opacity:"不透明度",audio_levels:"オーディオレベル",notes_velocity:"音符ベロシティ",has_no_video_error:"エラー：選択したレイヤーにはビデオが含まれていないため、選択されたエフェクトを適用できません。"};var _={ok:"确定",cancel:"取消",channel_abbr:"通道",error:"错误",warning:"警告",apply:"应用",settings:"设置",select_all:"全选",channel:"通道",name:"名称",note_count:"音符数",language:"语言",general:"通用",app_default:"应用默认值",tools:"工具",create_null_object_short:"空对象",create_null_object:"创建空对象",apply_effects_short:"应用效果",apply_effects:"应用效果",marker_conductor:"标记指挥官",easing_100_percent:"缓动百分百",unit:"单位",time:"时间",frames:"帧数",seconds:"秒数",beat:"节拍",shift_seconds_and_frames:"偏移",mark_on:"标记在",add_null_layer:"新建空对象图层",current_layer:"当前图层",ease_in:"缓入",ease_out:"缓出",ease_in_out:"缓入缓出",midi_track_selector_title:"选择 MIDI 轨道",select_at_least_one_track:"请至少选择一条轨道。",no_midi_file_selected:"未选择 MIDI 文件",select_midi_file:"MIDI 文件",select_midi_track:"选择轨道",set_midi_bpm:"设定 BPM",start_time:"开始时间",display_start_time:"显示开始时间",current_time:"当前时间",work_area:"工作区域",select_a_midi_file:"选择一个 MIDI 序列",midi_files:"MIDI 序列",all_files:"所有文件",check_update:"检查更新",repository_link:"仓库地址",about_script_engine:"关于脚本引擎",import_om_utils:"导入 om utils",import_pure_quarter_midi:"导入纯四分 MIDI",using_selected_layer_name:"使用选中图层名称而不是 MIDI 轨道名称。",normalize_pan_to_100:"声像标准化到 -100 ~ 100。",using_layering:"@冰鸠さくの的特有图层叠叠乐方法。",optimize_apply_effects:"优化部分效果视觉。",add_to_effect_transform:"将属性添加到效果中的变换中。",sure_to_import_pure_quarter_midi:"确定要导入纯四分音符 MIDI 文件吗？",pure_quarter_midi:"纯四分音符 MIDI",add_at_top_of_expression:"在表达式顶部添加",om_utils_same_as_project_directory:"若放置在 aep 项目的相同目录下",om_utils_added_to_project:"若放置在任意位置，然后添加到 AE 项目中",pitch:"音高",velocity:"力度",duration:"持续时间",scale:"缩放",cw_rotation:"顺时针旋转",ccw_ratation:"逆时针旋转",count:"计数",bool:"布尔",time_remap:"时间重映射",pingpong:"来回",note_on:"音符开",channel_pan:"通道声像",channel_volume:"通道音量",channel_glide:"通道弯音",horizontal_flip:"水平翻转",invert_color:"颜色反转",tuning:"调音",base_pitch:"原始音高",paren_stretched:"（拉伸）",paren_truncated:"（截断）",cannot_find_window_error:"错误：无法找到或创建窗口。",unsupported_setting_type_error:"错误：不支持的设置数据类型。",file_unreadable_error:"错误：无法读取 MIDI 文件。该文件可能已占用或不存在。",midi_header_validation_error:"错误：MIDI 文件头验证失败（不是标准 MIDI 文件或文件已损坏）。",midi_track_header_validation_error:"错误：MIDI 轨道块标头验证失败。",midi_custom_events_error:"错误：自定义 MIDI 事件无法读取。",midi_no_track_error:"错误：该 MIDI 文件不包含任何有效轨道。",not_after_effects_error:"错误：请在 Adobe After Effects 上使用此脚本。",cannot_create_file_error:"错误：无法创建文件。",cannot_find_composition_error:"错误：无法找到活动合成。请先激活一个合成。\n\n解决方法：请先打开一个合成，然后点击一下该合成的预览画面或轨道的窗口使之处于活跃状态即可。",no_midi_error:"错误：请先打开一个有效的 MIDI 文件。",no_options_checked_error:"错误：请至少勾选一个项目。",no_layer_selected_error:"错误：在当前合成中未选中任何图层。",not_one_track_for_apply_effects_only_error:"错误：应用效果只能同时选择一条轨道。",end_of_track_position_error:"错误：轨道结束位置有误。应为 %1，实际 %2。",cannot_set_time_remap_error:"错误：所选图层不能设置时间重映射。",cannot_tuning_error:"错误：所选图层不包含音频，不能进行调音。",about:"读取一个 MIDI 序列，并为当前合成添加一个或多个新图层，其中包含各个 MIDI 轨道的音高、力度和持续时间等滑块控件。\n\n脚本版本：%4\n应用程序：%2\n应用版本：%3\n\n脚本原作者：大卫·范·布林克 (omino)、哆啦 (NGDXW)、韩琦、家鳖大帝\n脚本作者：兰音\n仓库地址：%1",horizontal_mirror:"水平镜像",advanced_scale:"高级缩放",loading_midi:"加载 %1 ...",unsupported_fps_time_division_error:"错误：当前模式不支持帧每秒时分数据格式。",low_version_error:"错误：使用 Adobe After Effects 软件版本过低，请更新。",map_velocity:"映射力度",map_velocity_to_opacity:"映射力度到不透明度",map_velocity_to_volume:"映射力度到音频电平",opacity:"不透明度",audio_levels:"音频电平",notes_velocity:"音符力度",has_no_video_error:"错误：所选图层不包含视频，不能应用所选效果。"};var f={};for(var d in _)if(i(_,d))f[d]={zh:_[d],en:p[d],ja:h[d]};var m="...";var v="~";var g=13;var E=function(){function t(t,e){var i=this;if(void 0===e)e={};this.scrollY=0;this.resizeTimes=0;this.parent=t;this.panel=n(t,"group",{orientation:"stack",alignment:["fill","fill"],spacing:0});this.content=n(this.panel,"group",c({orientation:"column",alignment:["fill","top"],alignChildren:"fill"},e));this.children=this.content.children;this.margins=e.margins;this.scrollbar=n(this.panel,"scrollbar",{alignment:"right"});this.scrollbar.onChanging=function(){return i.onScroll()}}t.prototype.add=function(t,e,i){return n(this.content,t,e,i)};t.prototype.onResize=function(){var t=this.getContentPadding(),e=t[0],i=t[1];var r=this.parent.bounds;this.panel.bounds=c(c({},r),{x:0,y:0});var n=false;var a=this.getViewHeight();if(a.viewHeight>=a.height){this.scrollY=i;n=true}else if(a.viewHeight>a.height+this.scrollY)this.scrollY=a.viewHeight-a.height;if(this.resizeTimes>2)this.content.alignment=["left","top"];this.content.bounds={x:e,y:this.scrollY,width:r.width-g*+!n-e,height:this.getContentHeight()};this.scrollbar.bounds={x:n?r.width:r.width-g,y:0,width:g,height:r.height};this.scrollbar.value=(this.scrollY-i)/-a.y*(this.scrollbar.maxvalue-this.scrollbar.minvalue)+this.scrollbar.minvalue;this.resizeTimes++};t.prototype.getContentHeight=function(){var t=this.content.margins[1];var e=t;for(var i=0,r=this.content.children;i<r.length;i++){var n=r[i];e+=n.size.height+this.content.spacing}return e};t.prototype.onScroll=function(){var t=this.getViewHeight().y;if(t<=0)return;var e=this.getContentPadding()[1];var i=(this.scrollbar.value-this.scrollbar.minvalue)/(this.scrollbar.maxvalue-this.scrollbar.minvalue);this.content.location.y=this.scrollY=-t*i+e};t.prototype.getViewHeight=function(){var t=this.content.size.height;var e=this.panel.size.height;var i=t-e;return{height:t,viewHeight:e,y:i}};t.test=function(){var e=new Window("window","Scroll Test",void 0,{resizeable:true});var i=n(e,"group",{alignment:["fill","fill"]});var r=new t(i);var a=20;for(var o=1;o<=a;o++)r.add("checkbox",{text:"Item "+o});e.onShow=e.onResizing=e.onResize=function(){e.layout.resize();r.onResize()};e.center();e.show()};t.prototype.getContentPadding=function(){if(this.margins instanceof Array)return[this.margins[0],this.margins[1]];else if("number"===typeof this.margins)return[this.margins,this.margins];else return[0,0]};return t}();var y=2;var T={spacing:y,margins:[7,5,0,0]};var O={orientation:"column",alignment:["fill","top"],alignChildren:"fill",spacing:y,margins:[10,5,10,0]};var R=function(){function t(t,e,i,r){this.parent=t;this.tab=n(this.parent.tabs,"tab",{text:i});null!==r&&void 0!==r?r:r=e?T:O;this.group=e?new E(this.tab,r):n(this.tab,"group",r)}t.prototype.getCheckedChecks=function(){var t=[];var e=this.group instanceof Group?this.group.children:this.group.content.children;for(var i=0,r=e;i<r.length;i++){var n=r[i];if(n instanceof Checkbox&&n.value)t.push(n)}return t};t.prototype.addCheckbox=function(t){var e={text:t,alignment:["fill","fill"]};var i=this.group instanceof E?this.group.add("checkbox",e):n(this.group,"checkbox",e);return i};return t}();var L=function(t){s(e,t);function e(e){var i=t.call(this,e,true)||this;i.pitch=i.addCheckbox();i.velocity=i.addCheckbox();i.duration=i.addCheckbox();i.scale=i.addCheckbox();i.advancedScale=i.addCheckbox();i.cwRotation=i.addCheckbox();i.ccwRotation=i.addCheckbox();i.count=i.addCheckbox();i.bool=i.addCheckbox();i.timeRemap=i.addCheckbox();i.pingpong=i.addCheckbox();i.noteOn=i.addCheckbox();i.pan=i.addCheckbox();i.volume=i.addCheckbox();i.glide=i.addCheckbox();return i}e.prototype.translate=function(){this.tab.text=localize(f.create_null_object_short);this.pitch.text=localize(f.pitch);this.velocity.text=localize(f.velocity);this.duration.text=localize(f.duration);this.scale.text=localize(f.scale);this.advancedScale.text=localize(f.advanced_scale);this.cwRotation.text=localize(f.cw_rotation);this.ccwRotation.text=localize(f.ccw_ratation);this.count.text=localize(f.count);this.bool.text=localize(f.bool);this.timeRemap.text=localize(f.time_remap);this.pingpong.text=localize(f.pingpong);this.noteOn.text=localize(f.note_on);this.pan.text=localize(f.channel_pan);this.volume.text=localize(f.channel_volume);this.glide.text=localize(f.channel_glide)};return e}(R);var S;(function(t){var e=function(){function t(t){this.velocityLess=0;this.velocityMore=127;this.targetLess=-192;this.targetMore=0;if(t)r(this,t)}return t}();t.MappingVelocity=e})(S||(S={}));var b=S;var C=function(t){s(e,t);function e(i){var r=this.constructor;var n=this;if("string"===typeof i||!(i instanceof e))alert(i.toString(),localize(f.error),true);n=t.call(this,i.toString())||this;n.isMyError=true;n.__proto__=r.prototype;return n}return e}(Error);var N=function(t){s(e,t);function e(){return t.call(this,localize(f.cannot_find_window_error))||this}return e}(C);var w=function(t){s(e,t);function e(){return t.call(this,localize(f.unsupported_setting_type_error))||this}return e}(C);var I=function(t){s(e,t);function e(){return t.call(this,localize(f.file_unreadable_error))||this}return e}(C);var k=function(t){s(e,t);function e(){return t.call(this,localize(f.midi_header_validation_error))||this}return e}(C);var A=function(t){s(e,t);function e(){return t.call(this,localize(f.midi_track_header_validation_error))||this}return e}(C);var x=function(t){s(e,t);function e(){return t.call(this,localize(f.midi_custom_events_error))||this}return e}(C);var D=function(t){s(e,t);function e(){return t.call(this,localize(f.midi_no_track_error))||this}return e}(C);var M=function(t){s(e,t);function e(){return t.call(this,localize(f.not_after_effects_error))||this}return e}(C);var B=function(t){s(e,t);function e(){return t.call(this,localize(f.cannot_create_file_error))||this}return e}(C);var P=function(t){s(e,t);function e(){return t.call(this,localize(f.cannot_find_composition_error))||this}return e}(C);var z=function(t){s(e,t);function e(){return t.call(this,localize(f.no_midi_error))||this}return e}(C);var F=function(t){s(e,t);function e(){return t.call(this,localize(f.no_options_checked_error))||this}return e}(C);var K=function(t){s(e,t);function e(){return t.call(this,localize(f.no_layer_selected_error))||this}return e}(C);var G=function(t){s(e,t);function e(){return t.call(this,localize(f.not_one_track_for_apply_effects_only_error))||this}return e}(C);var U=function(t){s(e,t);function e(e,i){return t.call(this,localize(f.end_of_track_position_error,e,i))||this}return e}(C);var V=function(t){s(e,t);function e(){return t.call(this,localize(f.cannot_set_time_remap_error))||this}return e}(C);var H=function(t){s(e,t);function e(){return t.call(this,localize(f.cannot_tuning_error))||this}return e}(C);var j=function(t){s(e,t);function e(){return t.call(this,localize(f.unsupported_fps_time_division_error))||this}return e}(C);var Y=function(t){s(e,t);function e(){return t.call(this,localize(f.low_version_error))||this}return e}(C);var Q=function(t){s(e,t);function e(){return t.call(this,localize(f.has_no_video_error))||this}return e}(C);function q(t,e,i){t.onChange=function(){var r=t.text;var n=/\d+/g;if("decimal"===e.type){n=/-?\d+(\.\d+)?/g;if(void 0!==e.min&&e.min>=0)n=/\d+(\.\d+)?/g}var a=r.match(n);if(a){r=a[0].replace(/^0+(?!\.)/g,"");r||(r="0");var o="int"===e.type?parseInt(r,10):parseFloat(r);if(isNaN(o))o=null!==i&&void 0!==i?i:0;if(void 0!==e.max&&o>e.max)o=null!==i&&void 0!==i?i:e.max;if(void 0!==e.min&&o<e.min)o=null!==i&&void 0!==i?i:e.min;r=String(o)}else r=String(i);t.text=r}}var X=function(){function t(t,e,i){var r,a;var o=this;this.dialogResult=false;this.window=new Window("dialog",localize(f.map_velocity),void 0,{resizeable:false});if(null===this.window)throw new N;this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"});r=this.addRow(f.notes_velocity),this.velocityLessTxt=r[0],this.velocityMoreTxt=r[1];a=this.addRow(t),this.targetLessTxt=a[0],this.targetMoreTxt=a[1];this.buttonGroup=n(this.group,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]});this.okBtn=n(this.buttonGroup,"button",{text:localize(f.ok)});this.cancelBtn=n(this.buttonGroup,"button",{text:localize(f.cancel)});this.window.defaultElement=this.okBtn;this.window.cancelElement=this.cancelBtn;this.okBtn.onClick=function(){o.dialogResult=true;o.window.close()};if(i){this.velocityLessTxt.text=String(i.velocityLess);this.velocityMoreTxt.text=String(i.velocityMore);this.targetLessTxt.text=String(i.targetLess);this.targetMoreTxt.text=String(i.targetMore)}[this.velocityLessTxt,this.velocityMoreTxt].forEach((function(t){return q(t,{type:"int",min:0,max:127})}));[this.targetLessTxt,this.targetMoreTxt].forEach((function(t){return q(t,{type:"decimal",min:e[0],max:e[1]})}))}t.prototype.showDialog=function(){this.window.center();this.window.show();if(!this.dialogResult)return;var t=new b.MappingVelocity({velocityLess:parseFloat(this.velocityLessTxt.text),velocityMore:parseFloat(this.velocityMoreTxt.text),targetLess:parseFloat(this.targetLessTxt.text),targetMore:parseFloat(this.targetMoreTxt.text)});return t};t.prototype.addRow=function(t){var e=6;var i=o(this.group,localize(t),"group",{orientation:"row",alignment:["right","center"]}).control;var r=n(i,"edittext",{characters:e});n(i,"statictext",{text:"~"});var a=n(i,"edittext",{characters:e});return[r,a]};return t}();function W(t,e,i){return Math.max(t,Math.min(i,e))}function Z(t,e,i,r,n){return(n-r)*(t-e)/(i-e)+r}var J=function(){function t(t,e,i,r,a){var o=this;this.value=false;this.parent=t;this.targetRange=i;this.mapping=new b.MappingVelocity({targetLess:r[0],targetMore:r[1]});this.group=n(t,"group",{orientation:"row"});this.checkbox=n(this.group,"checkbox",{text:a});this.advanceBtn=n(this.group,"button",{text:"...",size:[ue,18]});this.checkbox.onClick=function(){return o.value=o.checkbox.value};this.advanceBtn.onClick=function(){var t=new X(e,i,o.mapping).showDialog();if(t)o.mapping=t}}t.prototype.setEnabled=function(t){this.checkbox.enabled=this.advanceBtn.enabled=t;if(!t)this.value=this.checkbox.value=false};t.prototype.map=function(t){return W(this.targetRange[0],Z(t,this.mapping.velocityLess,this.mapping.velocityMore,this.mapping.targetLess,this.mapping.targetMore),this.targetRange[1])};return t}();var tt=function(t){s(e,t);function e(e){var i;var r=t.call(this,e,true)||this;r.timeRemap=r.addCheckbox();r.timeRemap2=r.addCheckbox();r.pingpong=r.addCheckbox();r.hFlip=r.addCheckbox();r.hMirror=r.addCheckbox();r.cwRotation=r.addCheckbox();r.ccwRotation=r.addCheckbox();r.negative=r.addCheckbox();r.mapVelToOpacity=new J(r.group.content,f.opacity,[0,100],[0,100]);r.tuning=r.addCheckbox();i=o(r.group.content,"","dropdownlist"),r.basePitchGroup=i.group,r.basePitchLbl=i.label,r.basePitchKeyCombo=i.control;r.basePitchOctCombo=n(r.basePitchGroup,"dropdownlist");a.apply(void 0,u([r.basePitchKeyCombo],"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(",")));a.apply(void 0,u([r.basePitchOctCombo],"0,1,2,3,4,5,6,7,8,9,10".split(",")));r.basePitchOctCombo.selection=5;r.basePitchGroup.enabled=false;r.mapVelToVolume=new J(r.group.content,f.audio_levels,[-192,12],[-40,0]);r.mapVelToVolume.group.margins=[0,7,10,0];r.cwRotation.onClick=function(){return r.ccwRotation.value=false};r.ccwRotation.onClick=function(){return r.cwRotation.value=false};r.timeRemap.onClick=function(){return r.timeRemap2.value=r.pingpong.value=false};r.timeRemap2.onClick=function(){return r.timeRemap.value=r.pingpong.value=false};r.pingpong.onClick=function(){return r.timeRemap.value=r.timeRemap2.value=false};r.tuning.onClick=function(){r.basePitchGroup.enabled=r.tuning.value;r.mapVelToVolume.setEnabled(r.tuning.value)};r.mapVelToVolume.setEnabled(false);return r}e.prototype.translate=function(){this.tab.text=localize(f.apply_effects_short);this.basePitchLbl.text=localize(f.base_pitch);this.timeRemap.text=localize(f.time_remap)+localize(f.paren_stretched);this.timeRemap2.text=localize(f.time_remap)+localize(f.paren_truncated);this.pingpong.text=localize(f.pingpong);this.hFlip.text=localize(f.horizontal_flip);this.hMirror.text=localize(f.horizontal_mirror);this.cwRotation.text=localize(f.cw_rotation);this.ccwRotation.text=localize(f.ccw_ratation);this.negative.text=localize(f.invert_color);this.tuning.text=localize(f.tuning);this.mapVelToOpacity.checkbox.text=localize(f.map_velocity_to_opacity);this.mapVelToVolume.checkbox.text=localize(f.map_velocity_to_volume)};e.prototype._getCheckedChecks=function(){var t=this.getCheckedChecks();if(this.mapVelToOpacity.value)t.push(this.mapVelToOpacity);if(this.tuning.value&&this.mapVelToVolume.value)t.push(this.mapVelToVolume);return t};return e}(R);var et=function(){function t(t){this.parent=t;this.group=n(this.parent.toolsPanel,"group",{orientation:"column",alignment:["fill","fill"],alignChildren:"fill",spacing:y})}return t}();var it=function(t){s(e,t);function e(e){var i,r,n,a;var l=t.call(this,e)||this;var s=["fill","center"];i=o(l.group,"","dropdownlist",{alignment:s}),l.unitGroup=i.group,l.unitLbl=i.label,l.unitCombo=i.control;r=o(l.group,"BPM","edittext",{text:"120",alignment:s}),l.bpmGroup=r.group,l.bpmLbl=r.label,l.bpmTxt=r.control;n=o(l.group,"","edittext",{text:"4",alignment:s}),l.beatGroup=n.group,l.beatLbl=n.label,l.beatTxt=n.control;a=o(l.group,"","dropdownlist",{alignment:s}),l.markOnGroup=a.group,l.markOnLbl=a.label,l.markOnCombo=a.control;l.translate();q(l.bpmTxt,{type:"decimal",min:1},120);l.unitCombo.onChange=function(){var t=l.unitCombo.getSelectedIndex();l.beatLbl.text=0===t?localize(f.beat):localize(f.shift_seconds_and_frames);if(0===t)l.bpmLbl.text="BPM";else if(1===t)l.bpmLbl.text=localize(f.seconds);else l.bpmLbl.text=localize(f.frames);q(l.beatTxt,0===t?{type:"int",min:1}:{type:"decimal"},4);l.beatTxt.notify("onChange")};l.unitCombo.notify("onChange");return l}e.prototype.translate=function(){this.unitLbl.text=localize(f.unit);this.markOnLbl.text=localize(f.mark_on);a(this.unitCombo,"BPM",localize(f.time),localize(f.frames));a(this.markOnCombo,localize(f.add_null_layer),localize(f.current_layer))};return e}(et);var rt=function(){function t(t,e){this.control=t.add("panel");this.control.alignment="horizontal"===e?["fill","top"]:["center","fill"]}return t}();var nt;(function(t){t[t["EASE_IN"]=0]="EASE_IN";t[t["EASE_OUT"]=1]="EASE_OUT";t[t["EASE_IN_OUT"]=2]="EASE_IN_OUT"})(nt||(nt={}));var at=nt;var ot=function(t){s(e,t);function e(e){var i=t.call(this,e)||this;i.easeInRadio=n(i.group,"radiobutton",{value:true});i.easeOutRadio=n(i.group,"radiobutton");i.easeInOutRadio=n(i.group,"radiobutton");i.translate();return i}e.prototype.getValue=function(){if(this.easeInOutRadio.value)return at.EASE_IN_OUT;else if(this.easeOutRadio.value)return at.EASE_OUT;else return at.EASE_IN};e.prototype.translate=function(){this.easeInRadio.text=localize(f.ease_in);this.easeOutRadio.text=localize(f.ease_out);this.easeInOutRadio.text=localize(f.ease_in_out)};return e}(et);var lt="om_midi";var st={get:function(t,e){if(!app.settings.haveSetting(lt,t))return e;else{var i=app.settings.getSetting(lt,t);var r=void 0;if("string"===typeof e)r=i;else if("number"===typeof e)r=Number(i);else if("boolean"===typeof e)r="0"!==i;else throw new w;return r}},set:function(t,e){var i=e;if("boolean"===typeof e)i=i?"1":"0";app.settings.saveSetting(lt,t,i.toString())},has:function(t){return app.settings.haveSetting(lt,t)}};var ct={Language:0,UsingSelectedLayerName:false,UsingLayering:false,OptimizeApplyEffects:true,NormalizePanTo100:true,AddToEffectTransform:false,ApplyEffectsStartTime:1,NullObjectStartTime:0,LastTool:0};var ut={};var pt=function(t){if(i(ct,t)){ut["get"+t]=function(e){if(void 0===e)e=ct[t];return st.get(t,e)};ut["set"+t]=function(e){return st.set(t,e)}}};for(var ht in ct)pt(ht);var _t=function(t){s(e,t);function e(e){var i=t.call(this,e,false,void 0,{orientation:"column",alignment:"fill",alignChildren:"fill",margins:[10,5,0,0]})||this;i.toolsCombo=n(i.group,"dropdownlist");i.toolsCombo.selection=ut.getLastTool();i.separator=new rt(i.group,"horizontal");i.toolsPanel=n(i.group,"group",{orientation:"stack",alignment:"fill",alignChildren:"fill"});i.marker=new it(i);i.ease=new ot(i);i.toolsCombo.onChange=function(){var t=i.toolsCombo.getSelectedIndex();for(var e=0;e<i.toolsPanel.children.length;e++){var r=i.toolsPanel.children[e];r.visible=e===t}ut.setLastTool(i.toolsCombo.getSelectedIndex())};i.toolsCombo.notify("onChange");return i}e.prototype.getSelectedTool=function(){switch(this.toolsCombo.getSelectedIndex()){case 0:return this.marker;case 1:return this.ease;default:return null}};e.prototype.translate=function(){this.tab.text=localize(f.tools);a(this.toolsCombo,localize(f.marker_conductor),localize(f.easing_100_percent));this.marker.translate();this.ease.translate()};return e}(R);var ft=function(t){s(e,t);function e(e){return t.call(this,Folder.temp.fsName+"/"+(new Date).valueOf()+"_"+e)||this}return e}(File);function dt(t){var e;if(-1!==$.os.indexOf("Win"))e="explorer.exe "+t;else e="open "+t;try{system.callSystem(e)}catch(t){throw new C(t)}}var mt=function(){function t(){this.window=new Window("dialog",localize(f.add_at_top_of_expression),void 0,{resizeable:false});if(null===this.window)throw new N;this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"});n(this.group,"statictext",{text:localize(f.om_utils_same_as_project_directory)});n(this.group,"edittext",{text:'$.evalFile(thisProject.fullPath.replace(/\\\\[^\\\\]*$/, "/om_utils.jsx"));'},{readonly:true});n(this.group,"statictext",{text:localize(f.om_utils_added_to_project)});n(this.group,"edittext",{text:'footage("om_utils.jsx").sourceData;'},{readonly:true});this.okBtn=n(this.group,"button",{text:localize(f.ok),alignment:"right"});this.window.defaultElement=this.okBtn}t.prototype.showDialog=function(){this.window.center();this.window.show()};return t}();function vt(t){if("string"===typeof t)t=[t];if(0===t.length)return[];var e=new ft("tmp.txt");var i;if(e&&e.open("w")){i=e.encoding;e.encoding="binary";for(var r=0,n=t;r<n.length;r++){var a=n[r];e.writeln(a)}e.close()}else throw new B;var o=[];if(e&&e.open("r")){e.encoding=i;while(!e.eof)o.push(e.readln());e.close();e.remove()}else throw new B;return o}var gt=function(){function t(t,e,i){this.secondsPerQuarter=t;this.startTick=e;this.startSecond=i}t.prototype.toString=function(){return this.startSecond.toFixed(2)+"s,"+(60/this.secondsPerQuarter).toFixed(2)+"bpm,"+this.startTick+"t"};return t}();var Et;(function(t){t[t["SINGLE_TRACK"]=0]="SINGLE_TRACK";t[t["SYNC_MULTI_TRACK"]=1]="SYNC_MULTI_TRACK";t[t["ASYNC_MULTI_TRACK"]=2]="ASYNC_MULTI_TRACK"})(Et||(Et={}));var yt;(function(t){t[t["END_OF_TRACK"]=47]="END_OF_TRACK";t[t["END_OF_FILE"]=-1]="END_OF_FILE";t[t["TEXT_EVENT"]=1]="TEXT_EVENT";t[t["COPYRIGHT_NOTICE"]=2]="COPYRIGHT_NOTICE";t[t["TRACK_NAME"]=3]="TRACK_NAME";t[t["INSTRUMENT_NAME"]=4]="INSTRUMENT_NAME";t[t["LYRICS"]=5]="LYRICS";t[t["MARKER"]=6]="MARKER";t[t["CUE_POINT"]=7]="CUE_POINT";t[t["MIDI_PORT"]=33]="MIDI_PORT";t[t["MIDI_PORT_2"]=32]="MIDI_PORT_2";t[t["SET_TEMPO"]=81]="SET_TEMPO";t[t["KEY_SIGNATURE"]=89]="KEY_SIGNATURE";t[t["SMPTE_OFFSET"]=84]="SMPTE_OFFSET";t[t["TIME_SIGNATURE"]=88]="TIME_SIGNATURE";t[t["SEQUENCER_SPECIFIC"]=127]="SEQUENCER_SPECIFIC"})(yt||(yt={}));var Tt;(function(t){t[t["SYSTEM_EXCLUSIVE_EVENTS"]=15]="SYSTEM_EXCLUSIVE_EVENTS";t[t["NOTE_AFTERTOUCH"]=10]="NOTE_AFTERTOUCH";t[t["CONTROLLER"]=11]="CONTROLLER";t[t["PITCH_BEND_EVENT"]=14]="PITCH_BEND_EVENT";t[t["NOTE_OFF"]=8]="NOTE_OFF";t[t["NOTE_ON"]=9]="NOTE_ON";t[t["PROGRAM_CHANGE"]=12]="PROGRAM_CHANGE";t[t["CHANNEL_AFTERTOUCH"]=13]="CHANNEL_AFTERTOUCH";t[t["END_OF_FILE"]=-1]="END_OF_FILE"})(Tt||(Tt={}));var Ot;(function(t){t[t["BANK_SELECT"]=0]="BANK_SELECT";t[t["MODULATION"]=1]="MODULATION";t[t["BREATH_CONTROLLER"]=2]="BREATH_CONTROLLER";t[t["FOOT_CONTROLLER"]=4]="FOOT_CONTROLLER";t[t["PORTAMENTO_TIME"]=5]="PORTAMENTO_TIME";t[t["DATA_ENTRY"]=6]="DATA_ENTRY";t[t["MAIN_VOLUME"]=7]="MAIN_VOLUME";t[t["BALANCE"]=8]="BALANCE";t[t["PAN"]=10]="PAN";t[t["EXPRESSION_CONTROLLER"]=11]="EXPRESSION_CONTROLLER";t[t["EFFECT_CONTROL_1"]=12]="EFFECT_CONTROL_1";t[t["EFFECT_CONTROL_2"]=13]="EFFECT_CONTROL_2";t[t["GENERAL_PURPOSE_CONTROLLERS_1"]=16]="GENERAL_PURPOSE_CONTROLLERS_1";t[t["GENERAL_PURPOSE_CONTROLLERS_2"]=17]="GENERAL_PURPOSE_CONTROLLERS_2";t[t["GENERAL_PURPOSE_CONTROLLERS_3"]=18]="GENERAL_PURPOSE_CONTROLLERS_3";t[t["GENERAL_PURPOSE_CONTROLLERS_4"]=19]="GENERAL_PURPOSE_CONTROLLERS_4";t[t["LSB_FOR_CONTROLLERS_0"]=32]="LSB_FOR_CONTROLLERS_0";t[t["LSB_FOR_CONTROLLERS_1"]=33]="LSB_FOR_CONTROLLERS_1";t[t["LSB_FOR_CONTROLLERS_2"]=34]="LSB_FOR_CONTROLLERS_2";t[t["LSB_FOR_CONTROLLERS_3"]=35]="LSB_FOR_CONTROLLERS_3";t[t["LSB_FOR_CONTROLLERS_4"]=36]="LSB_FOR_CONTROLLERS_4";t[t["LSB_FOR_CONTROLLERS_5"]=37]="LSB_FOR_CONTROLLERS_5";t[t["LSB_FOR_CONTROLLERS_6"]=38]="LSB_FOR_CONTROLLERS_6";t[t["LSB_FOR_CONTROLLERS_7"]=39]="LSB_FOR_CONTROLLERS_7";t[t["LSB_FOR_CONTROLLERS_8"]=40]="LSB_FOR_CONTROLLERS_8";t[t["LSB_FOR_CONTROLLERS_9"]=41]="LSB_FOR_CONTROLLERS_9";t[t["LSB_FOR_CONTROLLERS_10"]=42]="LSB_FOR_CONTROLLERS_10";t[t["LSB_FOR_CONTROLLERS_11"]=43]="LSB_FOR_CONTROLLERS_11";t[t["LSB_FOR_CONTROLLERS_12"]=44]="LSB_FOR_CONTROLLERS_12";t[t["LSB_FOR_CONTROLLERS_13"]=45]="LSB_FOR_CONTROLLERS_13";t[t["LSB_FOR_CONTROLLERS_14"]=46]="LSB_FOR_CONTROLLERS_14";t[t["LSB_FOR_CONTROLLERS_15"]=47]="LSB_FOR_CONTROLLERS_15";t[t["LSB_FOR_CONTROLLERS_16"]=48]="LSB_FOR_CONTROLLERS_16";t[t["LSB_FOR_CONTROLLERS_17"]=49]="LSB_FOR_CONTROLLERS_17";t[t["LSB_FOR_CONTROLLERS_18"]=50]="LSB_FOR_CONTROLLERS_18";t[t["LSB_FOR_CONTROLLERS_19"]=51]="LSB_FOR_CONTROLLERS_19";t[t["LSB_FOR_CONTROLLERS_20"]=52]="LSB_FOR_CONTROLLERS_20";t[t["LSB_FOR_CONTROLLERS_21"]=53]="LSB_FOR_CONTROLLERS_21";t[t["LSB_FOR_CONTROLLERS_22"]=54]="LSB_FOR_CONTROLLERS_22";t[t["LSB_FOR_CONTROLLERS_23"]=55]="LSB_FOR_CONTROLLERS_23";t[t["LSB_FOR_CONTROLLERS_24"]=56]="LSB_FOR_CONTROLLERS_24";t[t["LSB_FOR_CONTROLLERS_25"]=57]="LSB_FOR_CONTROLLERS_25";t[t["LSB_FOR_CONTROLLERS_26"]=58]="LSB_FOR_CONTROLLERS_26";t[t["LSB_FOR_CONTROLLERS_27"]=59]="LSB_FOR_CONTROLLERS_27";t[t["LSB_FOR_CONTROLLERS_28"]=60]="LSB_FOR_CONTROLLERS_28";t[t["LSB_FOR_CONTROLLERS_29"]=61]="LSB_FOR_CONTROLLERS_29";t[t["LSB_FOR_CONTROLLERS_30"]=62]="LSB_FOR_CONTROLLERS_30";t[t["LSB_FOR_CONTROLLERS_31"]=63]="LSB_FOR_CONTROLLERS_31";t[t["DAMPER_PEDAL"]=64]="DAMPER_PEDAL";t[t["PORTAMENTO"]=65]="PORTAMENTO";t[t["SOSTENUTO"]=66]="SOSTENUTO";t[t["SOFT_PEDAL"]=67]="SOFT_PEDAL";t[t["LEGATO_FOOTSWITCH"]=68]="LEGATO_FOOTSWITCH";t[t["HOLD_2"]=69]="HOLD_2";t[t["SOUND_CONTROLLER_1"]=70]="SOUND_CONTROLLER_1";t[t["SOUND_CONTROLLER_2"]=71]="SOUND_CONTROLLER_2";t[t["SOUND_CONTROLLER_3"]=72]="SOUND_CONTROLLER_3";t[t["SOUND_CONTROLLER_4"]=73]="SOUND_CONTROLLER_4";t[t["SOUND_CONTROLLER_5"]=74]="SOUND_CONTROLLER_5";t[t["SOUND_CONTROLLER_6"]=75]="SOUND_CONTROLLER_6";t[t["SOUND_CONTROLLER_7"]=76]="SOUND_CONTROLLER_7";t[t["SOUND_CONTROLLER_8"]=77]="SOUND_CONTROLLER_8";t[t["SOUND_CONTROLLER_9"]=78]="SOUND_CONTROLLER_9";t[t["SOUND_CONTROLLER_10"]=79]="SOUND_CONTROLLER_10";t[t["GENERAL_PURPOSE_CONTROLLERS_5"]=80]="GENERAL_PURPOSE_CONTROLLERS_5";t[t["GENERAL_PURPOSE_CONTROLLERS_6"]=81]="GENERAL_PURPOSE_CONTROLLERS_6";t[t["GENERAL_PURPOSE_CONTROLLERS_7"]=82]="GENERAL_PURPOSE_CONTROLLERS_7";t[t["GENERAL_PURPOSE_CONTROLLERS_8"]=83]="GENERAL_PURPOSE_CONTROLLERS_8";t[t["PORTAMENTO_CONTROL"]=84]="PORTAMENTO_CONTROL";t[t["EFFECTS_1_DEPTH"]=91]="EFFECTS_1_DEPTH";t[t["EFFECTS_2_DEPTH"]=92]="EFFECTS_2_DEPTH";t[t["EFFECTS_3_DEPTH"]=93]="EFFECTS_3_DEPTH";t[t["EFFECTS_4_DEPTH"]=94]="EFFECTS_4_DEPTH";t[t["EFFECTS_5_DEPTH"]=95]="EFFECTS_5_DEPTH";t[t["DATA_INCREMENT"]=96]="DATA_INCREMENT";t[t["DATA_DECREMENT"]=97]="DATA_DECREMENT";t[t["NON_REGISTERED_PARAMETER_NUMBER_LSB"]=98]="NON_REGISTERED_PARAMETER_NUMBER_LSB";t[t["NON_REGISTERED_PARAMETER_NUMBER_MSB"]=99]="NON_REGISTERED_PARAMETER_NUMBER_MSB";t[t["REGISTERED_PARAMETER_NUMBER_LSB"]=100]="REGISTERED_PARAMETER_NUMBER_LSB";t[t["REGISTERED_PARAMETER_NUMBER_MSB"]=101]="REGISTERED_PARAMETER_NUMBER_MSB";t[t["MODE_MESSAGES_1"]=121]="MODE_MESSAGES_1";t[t["MODE_MESSAGES_2"]=122]="MODE_MESSAGES_2";t[t["MODE_MESSAGES_3"]=123]="MODE_MESSAGES_3";t[t["MODE_MESSAGES_4"]=124]="MODE_MESSAGES_4";t[t["MODE_MESSAGES_5"]=125]="MODE_MESSAGES_5";t[t["MODE_MESSAGES_6"]=126]="MODE_MESSAGES_6";t[t["MODE_MESSAGES_7"]=127]="MODE_MESSAGES_7"})(Ot||(Ot={}));var Rt=function(){function t(){this.deltaTime=0;this.startTick=0}return t}();var Lt=function(t){s(e,t);function e(e){var i=t.call(this)||this;i.type=0;i.type=e;return i}return e}(Rt);var St=function(t){s(e,t);function e(e,i){var r=t.call(this,e)||this;r.content=i;return r}return e}(Lt);var bt=function(t){s(e,t);function e(e,i){var r=t.call(this,e)||this;r.value=i;return r}return e}(Lt);var Ct=function(t){s(e,t);function e(e){var i=t.call(this,yt.SET_TEMPO,e)||this;i.tempo=e;return i}return e}(bt);var Nt=function(t){s(e,t);function e(e){var i=t.call(this,yt.SMPTE_OFFSET)||this;i.hour=e[0];i.min=e[1];i.sec=e[2];i.fr=e[3];i.subFr=e[4];return i}return e}(Lt);var wt=function(t){s(e,t);function e(e){var i=t.call(this,yt.TIME_SIGNATURE)||this;i.number=e[0];i.denom=e[1];i.metro=e[2];i.thirtySeconds=e[3];return i}e.prototype.toString=function(){return this.number+"/"+Math.pow(2,this.denom)};return e}(Lt);var It=function(t){s(e,t);function e(e,i){var r=t.call(this,e)||this;r.value=i;return r}return e}(Lt);var kt=function(t){s(e,t);function e(e,i,r){var n=t.call(this)||this;n.type=e;n.channel=i;n.values=r;return n}return e}(Rt);var At=function(t){s(e,t);function e(e,i,r){var n=t.call(this,e,i,r)||this;n.pitch=r[0];n.velocity=r[1];return n}return e}(kt);var xt=function(t){s(e,t);function e(e,i,r,n,a,o){var l=this;if(i instanceof Array)l=t.call(this,Tt.NOTE_ON,e,i)||this;else{l=t.call(this,Tt.NOTE_ON,e,[i,r])||this;l.deltaTime=n;l.duration=a;l.startTick=o}return l}return e}(At);var Dt=function(t){s(e,t);function e(e,i){return t.call(this,Tt.NOTE_OFF,e,i)||this}return e}(At);var Mt=function(t){s(e,t);function e(e,i){return t.call(this,Tt.SYSTEM_EXCLUSIVE_EVENTS,e,i)||this}return e}(kt);var Bt=function(t){s(e,t);function e(e,i){var r=t.call(this,Tt.CONTROLLER,e,i)||this;r.controller=i[0];r.value=i[1];return r}return e}(kt);var Pt=function(t){s(e,t);function e(i,r){var n=t.call(this,Tt.PITCH_BEND_EVENT,i,r)||this;n.value=e.take7Bit(r[1])<<7|e.take7Bit(r[0]);return n}e.take7Bit=function(t){return 127&t};return e}(kt);var zt=function(t){s(e,t);function e(e,i){var n=t.call(this,e.channel,e.values)||this;r(n,e);n.startSecond=i;return n}return e}(xt);var Ft=function(t){s(e,t);function e(e,i){var n=t.call(this)||this;r(n,e);n.startSecond=i;return n}return e}(Rt);var Kt=function(){function t(t){this.datas=[];this.tempoTrack=t;var e=t.midi();if(!e.isTpbTimeDivision())throw new j;this.ticksPerQuarter=e.timeDivision;this.initData()}t.prototype.initData=function(){for(var t=0,e=this.tempoTrack;t<e.length;t++){var i=e[t];if(i instanceof Ct){var r=i.startTick;if(0===this.datas.length&&0!==r)r=0;var n=0;var a=this.getLastData();var o=i.tempo/1e6;if(a){if(o===a.secondsPerQuarter)continue;else if(r===a.startTick){a.secondsPerQuarter=o;continue}n=(r-a.startTick)/this.ticksPerQuarter*a.secondsPerQuarter+a.startSecond}this.datas.push(new gt(o,r,n))}}write(this.datas.length)};t.prototype.getLastData=function(){return this.datas[this.datas.length-1]};t.prototype.getSecond=function(t){var e=this.getActualSecond(t.startTick);if(t instanceof xt){var i=new zt(t,e);if(t.duration)i.durationSecond=this.getActualSecond(t.startTick+t.duration)-e;if(t.interruptDuration)i.interruptDurationSecond=this.getActualSecond(t.startTick+t.interruptDuration)-e;return i}else{var i=new Ft(t,e);return i}};t.prototype.getActualSecond=function(t){for(var e=0;e<this.datas.length;e++){var i=this.datas[e],r=this.datas[e+1];if(void 0!==r&&t>r.startTick)continue;var n=(t-i.startTick)*i.secondsPerQuarter/this.ticksPerQuarter;return i.startSecond+n}alert("No Bpm Keys!");return t};return t}();var Gt=function(){function t(){}return t}();var Ut=function(t){s(e,t);function e(e){var i=t.call(this)||this;i.file=e;return i}e.prototype.getPointer=function(){return this.file.tell()};e.prototype.length=function(){return this.file.length};e.prototype.readByte=function(t){if(void 0===t)t=1;var e=this.file.read(t);var i=0;for(var r=0;r<e.length;r++){i<<=8;i+=e.charCodeAt(r)}return i};e.prototype.readString=function(t){return this.file.read(t)};e.prototype.readByteArray=function(t){var e=this.file.read(t);var i=[];for(var r=0;r<e.length;r++)i.push(e.charCodeAt(r));return i};e.prototype.readDeltaTime=function(){var t=0;var e=false;while(!(this.isReadOver()||e)){t<<=7;var i=this.file.read(1).charCodeAt(0);if(!(128&i))e=true;t+=127&i}return t};e.prototype.isReadOver=function(){return this.file.eof};e.prototype.movePointer=function(t){this.file.seek(t,1)};e.prototype.setPointer=function(t){if(t<0||t>=this.length())return false;return this.file.seek(t,0)};return e}(Gt);var Vt=function(t){s(e,t);function e(e,i,r){var n=this.constructor;var a=t.call(this)||this;a.noteCount=0;a.lengthTick=0;a.__proto__=n.prototype;a.parent=e;a.offset=i;a.size=r;a.readNotes();return a}e.prototype.setName=function(t){var e;null!==(e=this.name)&&void 0!==e?e:this.name=t};e.prototype.setInstrument=function(t){var e;null!==(e=this.instrument)&&void 0!==e?e:this.instrument=t};e.prototype.setChannel=function(t){var e;null!==(e=this.channel)&&void 0!==e?e:this.channel=t};e.prototype.setTempo=function(t){var e,i,r;null!==(e=this.tempo)&&void 0!==e?e:this.tempo=t;var n=this.midi(),a=this.bpm();null!==(i=n.bpm)&&void 0!==i?i:n.bpm=a;null!==(r=n.tempoTrack)&&void 0!==r?r:n.tempoTrack=this;if(this.tempo!==t)n.isDynamicBpm=true};e.prototype.bpm=function(){if(void 0===this.tempo)return;var t=6e7/this.tempo;return parseFloat(t.toFixed(3))};e.prototype.readNotes=function(){var t=this.offset+this.size;var e=[];var i;while(!(this.parent.isReadOver()||this.parent.getPointer()>=t)){var r=this.parent.readDeltaTime();var n=this.lengthTick+=r;var a=i;i=this.parent.readByte(1);if(-1===i)break;else if(!(128&i)){i=a;this.parent.movePointer(-1)}var o=null;if(255===i){var l=this.parent.readByte(1);var s=this.parent.readDeltaTime();switch(l){case yt.END_OF_TRACK:if(this.parent.getPointer()!==t)new U(t,this.parent.getPointer());case yt.END_OF_FILE:return;case yt.TEXT_EVENT:case yt.COPYRIGHT_NOTICE:case yt.TRACK_NAME:case yt.INSTRUMENT_NAME:case yt.LYRICS:case yt.MARKER:case yt.CUE_POINT:var c=this.parent.readString(s);o=new St(l,c);if(l===yt.TRACK_NAME)this.setName(c);else if(l===yt.INSTRUMENT_NAME)this.setInstrument(c);break;case yt.MIDI_PORT:case yt.MIDI_PORT_2:case yt.KEY_SIGNATURE:case yt.SET_TEMPO:var u=this.parent.readByte(s);if(l===yt.SET_TEMPO){o=new Ct(u);this.setTempo(u)}else o=new bt(l,u);break;case yt.SMPTE_OFFSET:var p=this.parent.readByteArray(s);o=new Nt(p);break;case yt.TIME_SIGNATURE:var h=this.parent.readByteArray(s);o=new wt(h);break;default:var _=this.parent.readByteArray(s);o=new It(l,_);break}}else{var f=(15&i)+1;this.setChannel(f);var d=i>>4;switch(d){case Tt.NOTE_AFTERTOUCH:case Tt.CONTROLLER:case Tt.PITCH_BEND_EVENT:case Tt.NOTE_OFF:case Tt.NOTE_ON:var m=this.parent.readByteArray(2);switch(d){case Tt.NOTE_ON:o=new xt(f,m);var v=o;this.noteCount++;for(var g=0,E=e;g<E.length;g++){var y=E[g];if(void 0===y.interruptDuration)if(n<=y.startTick)v.interruptDuration=0;else y.interruptDuration=n-y.startTick}e.push(v);break;case Tt.NOTE_OFF:o=new Dt(f,m);var T=o;for(var O=e.length-1;O>=0;O--){var v=e[O];if(v.pitch===T.pitch){v.duration=n-v.startTick;v.noteOff=T;T.noteOn=v;e.splice(O,1);break}}break;case Tt.CONTROLLER:o=new Bt(f,m);break;case Tt.PITCH_BEND_EVENT:o=new Pt(f,m);break;case Tt.NOTE_AFTERTOUCH:default:o=new kt(d,f,m);break}break;case Tt.PROGRAM_CHANGE:case Tt.CHANNEL_AFTERTOUCH:var R=this.parent.readByteArray(1);o=new kt(d,f,R);break;case Tt.END_OF_FILE:return;case Tt.SYSTEM_EXCLUSIVE_EVENTS:var L=this.parent.readDeltaTime();o=new Mt(f,this.parent.readByteArray(L));break;default:throw new x}}if(null!==o){o.deltaTime=r;o.startTick=n;this.push(o)}}};e.prototype.toString=function(){var t;var e=localize(f.channel_abbr)+" "+(null!==(t=this.channel)&&void 0!==t?t:0);if(this.name)e+=": "+this.name;e+=" ("+this.noteCount+")";return e};e.prototype.getPointer=function(){return this.parent.getPointer()};e.prototype.midi=function(){return this.parent.midi};return e}(Array);var Ht=function(t){s(e,t);function e(e){var i=t.call(this,e.file)||this;i.midi=e;i.readHeader();i.readTracks();return i}e.prototype.readHeader=function(){if(1297377380!==this.readByte(4))throw new k;this.readByte(4);this.midi.formatType=this.readByte(2);this.midi.trackCount=this.readByte(2);var t=this.readByte(1),e=this.readByte(1);if(128&t)this.midi.timeDivision=[127&t,e];else this.midi.timeDivision=(t<<8)+e};e.prototype.readTracks=function(){while(!this.isReadOver()){var t=this.readByte(4);if(-1===t)break;if(1297379947!==t)throw new A;var e=this.readByte(4);var i=new Vt(this,this.getPointer(),e);this.midi.tracks.push(i)}};return e}(Ut);var jt=function(){function t(t){this.formatType=Et.SYNC_MULTI_TRACK;this.trackCount=0;this.timeDivision=0;this.tracks=[];this.preferredTrackIndex=0;this.isPureQuarter=false;this.isDynamicBpm=false;if(true===t){this.fileName=localize(f.pure_quarter_midi);this.isPureQuarter=true;this.formatType=Et.SINGLE_TRACK;this.trackCount=1;this.timeDivision=1;return}this.file=t;this.fileName=t.displayName;if(t&&t.open("r")){t.encoding="binary";this.length=t.length;this.midiReader=new Ht(this);t.close();if(this.isDynamicBpm&&this.tempoTrack)this.integrator=new Kt(this.tempoTrack);this.removeNotNoteTrack();this.setPreferredTrack();this.convertTracksNameEncoding()}else throw new I}t.prototype.removeNotNoteTrack=function(){for(var t=this.tracks.length-1;t>=0;t--){var e=this.tracks[t];if(0===e.noteCount)this.tracks.splice(t,1)}};t.prototype.setPreferredTrack=function(){for(var t=0;t<this.tracks.length;t++){var e=this.tracks[t];if(10!==e.channel){this.preferredTrackIndex=t;break}}};t.prototype.convertTracksNameEncoding=function(){var t=[];var e=[];for(var i=0,r=this.tracks;i<r.length;i++){var n=r[i];if(n.name){t.push(n);e.push(n.name)}}if(0===e.length)return;e=vt(e);for(var a=0;a<t.length&&a<e.length;a++){var n=t[a];var o=e[a].trim();if(""===o)o=void 0;n.name=o}};t.prototype.isTpbTimeDivision=function(){return"number"===typeof this.timeDivision};t.prototype.displayBpm=function(){var t=120;if(!this.bpm)return String(t);var e=String(this.bpm);if(this.isDynamicBpm)e+=v;return e};return t}();var Yt=function(){function t(t,e,i){if(void 0===i)i="fill";this.parent=t;this.outerGroup=n(this.parent,"group",{orientation:"column",alignment:i,alignChildren:"fill"});this.columns=e}t.prototype.add=function(t,e,i){var r=this.outerGroup.children;if(0===r.length||r[r.length-1].children.length>=this.columns)this.addRow();r=this.outerGroup.children;var a=r[r.length-1];return n(a,t,e,i)};t.prototype.addRow=function(){n(this.outerGroup,"group",{orientation:"row",alignment:"fill",alignChildren:"left"})};return t}();function Qt(t){var e=t.graphics.BrushType.SOLID_COLOR;t.graphics.newBrush(e,[1,1,1,1]);var i=.25*Math.random();var r=t.graphics.newBrush(e,[i,i,i,1]);t.graphics.backgroundColor=r;t.layout.layout(true);var n=24;var a=.05;var o=.15;var l=t.windowBounds.width;var s=t.windowBounds.height;for(var c=0;c<n;c++){var u=10+(l-20)*Math.random();var p=10+(s-20)*Math.random();var h=5+15*Math.random();var _=5+15*Math.random();var f=1+4*Math.random();var d=[Math.random(),Math.random(),Math.random(),a+(o-a)*Math.random()];var m=t.graphics.newBrush(e,d);var v=t.add("group",[u,p,u+h,p+f]);var g=t.add("group",[u,p+_-f,u+h,p+_]);var E=t.add("group",[u,p+f,u+f,p+_-f]);var y=t.add("group",[u+h-f,p+f,u+h,p+_-f]);v.graphics.backgroundColor=g.graphics.backgroundColor=E.graphics.backgroundColor=y.graphics.backgroundColor=m}}var qt=BridgeTalk.getDisplayName(BridgeTalk.appSpecifier);var Xt=function(){function t(i){var r;var l=this;this.portal=i;this.window=new Window("dialog",localize(f.settings)+" - "+e.scriptName+" v"+e.version,void 0,{resizeable:false});if(null===this.window)throw new N;this.group=n(this.window,"group",{orientation:"row",alignChildren:"fill",alignment:"fill"});this.leftGroup=n(this.group,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"});this.separator=new rt(this.group,"vertical");this.rightGroup=n(this.group,"group",{orientation:"column",alignChildren:"fill",alignment:"fill",spacing:5});this.aboutLbl=n(this.leftGroup,"statictext",{text:localize(f.about,e.githubPage,qt,BridgeTalk.appSpecifier,"v"+e.version)},{multiline:true,scrolling:true});this.openGithubBtnGroup=new Yt(this.leftGroup,3,["fill","bottom"]);this.openGithubLatestBtn=this.openGithubBtnGroup.add("button",{text:localize(f.check_update)+m});this.openGithubPageBtn=this.openGithubBtnGroup.add("button",{text:localize(f.repository_link)});this.extendScriptEngineAboutBtn=this.openGithubBtnGroup.add("button",{text:localize(f.about_script_engine)});this.importOmUtilsBtn=this.openGithubBtnGroup.add("button",{text:localize(f.import_om_utils)+m});this.importPureQuarterMidiBtn=this.openGithubBtnGroup.add("button",{text:localize(f.import_pure_quarter_midi)+m});this.generalPanel=this.addPanel(this.rightGroup,localize(f.general),[10,10,10,7]);r=o(this.generalPanel,localize(f.language),"dropdownlist"),this.languageGroup=r.group,this.languageLbl=r.label,this.languageCombo=r.control;a(this.languageCombo,localize(f.app_default)+" ("+this.getDefaultLocale()+")","简体中文","English","日本語");var s=ut.getLanguage();if(s>0&&s<this.languageCombo.items.length)this.languageCombo.selection=s;this.nullObjPanel=this.addPanel(this.rightGroup,localize(f.create_null_object));this.usingSelectedLayerName=n(this.nullObjPanel,"checkbox",{text:localize(f.using_selected_layer_name)});this.usingSelectedLayerName.value=ut.getUsingSelectedLayerName();this.normalizePanTo100=n(this.nullObjPanel,"checkbox",{text:localize(f.normalize_pan_to_100)});this.normalizePanTo100.value=ut.getNormalizePanTo100();this.applyEffectsPanel=this.addPanel(this.rightGroup,localize(f.apply_effects));this.usingLayering=n(this.applyEffectsPanel,"checkbox",{text:localize(f.using_layering)});this.usingLayering.value=ut.getUsingLayering();this.optimizeApplyEffects=n(this.applyEffectsPanel,"checkbox",{text:localize(f.optimize_apply_effects)});this.optimizeApplyEffects.value=ut.getOptimizeApplyEffects();this.addToEffectTransform=n(this.applyEffectsPanel,"checkbox",{text:localize(f.add_to_effect_transform)});this.addToEffectTransform.value=ut.getAddToEffectTransform();this.buttonGroup=n(this.rightGroup,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]});this.okBtn=n(this.buttonGroup,"button",{text:localize(f.ok)});this.cancelBtn=n(this.buttonGroup,"button",{text:localize(f.cancel)});this.window.defaultElement=this.okBtn;this.window.cancelElement=this.cancelBtn;this.okBtn.onClick=function(){ut.setUsingSelectedLayerName(l.usingSelectedLayerName.value);ut.setUsingLayering(l.usingLayering.value);ut.setOptimizeApplyEffects(l.optimizeApplyEffects.value);ut.setNormalizePanTo100(l.normalizePanTo100.value);ut.setAddToEffectTransform(l.addToEffectTransform.value);ut.setLanguage(l.languageCombo.getSelectedIndex());$.locale=t.langIso[l.languageCombo.getSelectedIndex()];l.window.close()};this.openGithubPageBtn.onClick=function(){return dt(e.githubPage)};this.openGithubLatestBtn.onClick=function(){return dt(e.githubLatest)};this.importPureQuarterMidiBtn.onClick=function(){if(!confirm(localize(f.sure_to_import_pure_quarter_midi),true,localize(f.import_pure_quarter_midi)))return;var t=new jt(true);l.portal.midi=t;l.portal.selectedTracks=[void 0];l.portal.selectMidiName.text=localize(f.pure_quarter_midi);l.portal.selectTrackBtn.text="";l.portal.selectTrackBtn.enabled=false;l.portal.selectBpmTxt.enabled=true;l.portal.updateDefaultBpm(t)};this.importOmUtilsBtn.onClick=function(){return(new mt).showDialog()};this.extendScriptEngineAboutBtn.onClick=function(){return $.about()};Qt(this.window)}t.prototype.showDialog=function(){this.window.center();this.window.show()};t.prototype.addPanel=function(t,e,i){if(void 0===i)i=[10,13,10,3];return n(t,"panel",{text:e,orientation:"column",alignChildren:"fill",alignment:"fill",spacing:2,margins:i})};t.prototype.getDefaultLocale=function(){if(!ut.getLanguage()){$.locale="";return $.locale}else{var t=$.locale;$.locale="";var e=$.locale;$.locale=t;return e}};t.langIso=["","zh_CN","en","ja"];return t}();var Wt=function(){function t(t){var e=this;this.parent=t;this.window=new Window("dialog",localize(f.midi_track_selector_title),void 0,{resizeable:true});if(null===this.window)throw new N;this.window.onResizing=this.window.onResize=function(){return e.window.layout.resize()};this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:["fill","fill"]});this.selectAllCheck=n(this.group,"checkbox",{text:localize(f.select_all)});this.trackList=n(this.group,"listbox",{alignment:["fill","fill"]},{multiselect:true,numberOfColumns:4,showHeaders:true,columnTitles:[localize(f.channel),localize(f.name),localize(f.note_count)],columnWidths:[50,225,75]});this.trackList.size=[400,400];this.buttonGroup=n(this.group,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]});this.okBtn=n(this.buttonGroup,"button",{text:localize(f.ok)});this.cancelBtn=n(this.buttonGroup,"button",{text:localize(f.cancel)});this.window.defaultElement=this.okBtn;this.window.cancelElement=this.cancelBtn;this.initMidiTracks();this.selectAllCheck.onClick=function(){var t=e.selectAllCheck.value;for(var i=0,r=e.trackList.items;i<r.length;i++){var n=r[i];n.checked=n.selected=t}};this.trackList.onChange=function(){return e.trackList_onChange()};this.okBtn.onClick=function(){var t;if(!e.parent.midi){e.window.close();return}var i=[];for(var r=0;r<e.trackList.items.length;r++){var n=e.trackList.items[r];var a=e.parent.midi.tracks[r];if(n.checked)i.push(a)}var o="";if(0===i.length){alert(localize(f.select_at_least_one_track),localize(f.warning));return}else if(1===i.length)o=i[0].toString();else{var l=[];for(var s=0,c=i;s<c.length;s++){var a=c[s];var u=String(null!==(t=a.channel)&&void 0!==t?t:0);if(a.name)u+=": "+a.name;l.push(u)}o=l.join("; ")}e.parent.selectedTracks=i;e.parent.selectTrackBtn.text=o;e.window.close()}}t.prototype.showDialog=function(){this.window.center();this.window.show()};t.prototype.initMidiTracks=function(){var t,e;if(this.parent.midi)for(var i=0,r=this.parent.midi.tracks;i<r.length;i++){var n=r[i];var a=this.trackList.add("item",String(null!==(t=n.channel)&&void 0!==t?t:0));a.checked=this.parent.selectedTracks.includes(n);a.subItems[0].text=null!==(e=n.name)&&void 0!==e?e:"";a.subItems[1].text=n.noteCount}this.trackList_onChange(true)};t.prototype.trackList_onChange=function(t){if(void 0===t)t=false;var e=true;for(var i=0,r=this.trackList.items;i<r.length;i++){var n=r[i];if(!t)n.checked=n.selected;if(!n.checked)e=false}this.selectAllCheck.value=e};return t}();function Zt(){var t=app.project.activeItem;if(!isValid(t))return null;return t}var Jt=function(){function t(t,e){this.running=true;this.palette=new Window("palette");this.palette.orientation="column";this.palette.alignChildren="left";this.title1=this.palette.add("statictext",void 0,t);this.title2=this.palette.add("statictext",void 0,e);this.progressBar=this.palette.add("progressbar");this.cancelBtn=this.palette.add("button",void 0,localize(f.cancel));this.cancelBtn.alignment="right";this.palette.cancelElement=this.cancelBtn}t.prototype.isRunning=function(){return this.running};t.prototype.isCanceled=function(){return!this.running};t.prototype.setValue=function(t){this.progressBar.value=100*t};t.prototype.setTitle1=function(t){this.title1.text=t};t.prototype.setTitle2=function(t){this.title2.text=t};t.prototype.close=function(){this.palette.close()};t.prototype.show=function(){this.palette.show()};return t}();var $t=5e-4;var te="om midi null";var ee="om midi Transform";var ie=15;var re=15;var ne=false;var ae=function(){function t(t){this.portal=t}t.prototype.apply=function(){var t=Zt();if(null===t)throw new P;var e;try{var i=this.portal.getSelectedTab();if(i!==this.portal.toolsTab&&this.portal.midi&&ne){e=new Jt(localize(f.loading_midi,this.portal.midi.fileName));e.show();e.setValue(.6)}if(i===this.portal.nullObjTab)this.applyCreateNullObject(t);else if(i===this.portal.applyEffectsTab)this.applyEffects(t);else if(i===this.portal.toolsTab){var r=this.portal.toolsTab.getSelectedTool();if(r===this.portal.toolsTab.marker)this.applyMarkerConductor(t);else if(r===this.portal.toolsTab.ease)this.applyEase100Percent(t)}}catch(t){throw new C(t)}finally{if(e)e.close();app.endUndoGroup()}};t.prototype.applyCreateNullObject=function(t){var e=this;var i,r;app.beginUndoGroup("om midi - Apply Create Null Object");var n=this.portal.nullObjTab;if(!this.portal.midi||0===this.portal.selectedTracks.length)throw new z;var a=n.getCheckedChecks();if(0===a.length)throw new F;var o=ut.getUsingSelectedLayerName();var l=this.getSelectLayer(t);if(null===l)o=false;var s=ut.getNormalizePanTo100();var c=this.getSecondsPerTick();var u=this.getStartTime(t);var p=this.getIntegrator();var h=function(h){if(void 0===h&&!_.portal.midi.isPureQuarter)return"continue";var f=_.createNullLayer(t);if(void 0!==h)f.name="[midi]"+(o&&null!==l?l.name:null!==(i=h.name)&&void 0!==i?i:"Channel "+(null!==(r=h.channel)&&void 0!==r?r:0));else f.name="[midi]BPM: "+_.portal.selectBpmTxt.text;f.inPoint=u;f.outPoint=void 0!==h?u+h.lengthTick*c:u+t.duration;for(var d=0,m=a;d<m.length;d++){var v=m[d];_.addSliderControl(f,v.text)}var g=function(t,i,r,n,o){return e.setValueAtTime(f,a,t,u+i,r,n,o)};var E=0,y=Tt.NOTE_OFF,T=-1,O=NaN,R=NaN,L=NaN;var S=function(t){var e,i,r;if(t.startTick<=T&&!(y===Tt.NOTE_OFF&&t instanceof xt)&&(t instanceof xt||t instanceof Dt))return;var a=p?p.getSecond(t):void 0;var o=a?a.startSecond:t.startTick*c;if(t instanceof xt&&0!==t.velocity){if(0===t.interruptDuration||0===t.duration||+t.interruptDuration<0||+t.duration<0)return;E++;g(n.pitch,o,t.pitch,KeyframeInterpolationType.HOLD);g(n.velocity,o,t.velocity,KeyframeInterpolationType.HOLD);g(n.duration,o,(null!==(e=t.duration)&&void 0!==e?e:0)*c,KeyframeInterpolationType.HOLD);g(n.count,o,E,KeyframeInterpolationType.HOLD);g(n.bool,o,E%2,KeyframeInterpolationType.HOLD);g(n.scale,o,E%2?100:-100,KeyframeInterpolationType.HOLD);g(n.advancedScale,o,E%2?1:-1,KeyframeInterpolationType.HOLD);g(n.cwRotation,o,(E-1)%4*90,KeyframeInterpolationType.HOLD);g(n.ccwRotation,o,(4-(E-1)%4)%4*90,KeyframeInterpolationType.HOLD);g(n.noteOn,o,1,KeyframeInterpolationType.HOLD);g(n.timeRemap,o,0,KeyframeInterpolationType.LINEAR);g(n.pingpong,o,+!(E%2),KeyframeInterpolationType.LINEAR);if(void 0!==t.interruptDuration||void 0!==t.duration){var l=void 0;if(!a){var u=null!==(i=t.interruptDuration)&&void 0!==i?i:t.duration;l=(t.startTick+u)*c-$t}else l=(null!==(r=a.interruptDurationSecond)&&void 0!==r?r:a.durationSecond)-$t+a.startSecond;g(n.timeRemap,l,1,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD);g(n.pingpong,l,E%2,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD)}y=Tt.NOTE_ON;T=t.startTick}else if(t instanceof xt&&0===t.velocity||t instanceof Dt){var l=o-$t;g(n.velocity,l,t.velocity,KeyframeInterpolationType.HOLD);g(n.noteOn,o,0,KeyframeInterpolationType.HOLD);y=Tt.NOTE_OFF;T=t.startTick}else if(t instanceof Bt){var h=t.controller;if(h===Ot.PAN){if(O===t.value)return;O=t.value;var _=t.value-64;if(s)if(_<0)_=_/64*100;else if(_>0)_=_/63*100;g(n.pan,o,_,KeyframeInterpolationType.HOLD)}else if(h===Ot.MAIN_VOLUME){if(R===t.value)return;R=t.value;g(n.volume,o,t.value,KeyframeInterpolationType.HOLD)}}else if(t instanceof Pt){if(L===t.value)return;L=t.value;var f=t.value-8192;g(n.glide,o,f,KeyframeInterpolationType.HOLD)}};g(n.velocity,0,0,KeyframeInterpolationType.HOLD);g(n.noteOn,0,0,KeyframeInterpolationType.HOLD);g(n.count,0,0,KeyframeInterpolationType.HOLD);_.dealNoteEvents(h,t,c,u,S)};var _=this;for(var f=0,d=this.portal.selectedTracks;f<d.length;f++){var m=d[f];h(m)}};t.prototype.applyMarkerConductor=function(t){app.beginUndoGroup("om midi - Apply Marker Conductor");var e=this.portal.toolsTab.marker;var i;if(1===e.markOnCombo.getSelectedIndex()){var r=this.getSelectLayer(t);if(null===r)throw new K;i=r}else{i=this.createNullLayer(t);i.name="BPM:"+e.bpmTxt.text+" ("+e.beatTxt.text+"/4)"}var n=this.getStartTime(t);i.startTime=n;var a=1;var o=e.unitCombo.getSelectedIndex();if(1===o)n-=parseFloat(e.beatTxt.text);else if(2===o)n-=parseFloat(e.beatTxt.text)*t.frameDuration;var l=parseFloat(e.bpmTxt.text);while(n<=t.displayStartTime+t.duration){if(n>=t.displayStartTime)i.marker.setValueAtTime(n,new MarkerValue(String(a)));if(0===o){a=a%parseInt(e.beatTxt.text)+1;n+=60/l}else{a++;if(1===o)n+=l;else if(2===o)n+=l*t.frameDuration}}};t.prototype.applyEffects=function(e){var i=this;app.beginUndoGroup("om midi - Apply Effects");var r=this.portal.applyEffectsTab;if(!this.portal.midi||0===this.portal.selectedTracks.length)throw new z;if(0===r._getCheckedChecks().length)throw new F;if(1!==this.portal.selectedTracks.length)throw new G;var n=1===r.getCheckedChecks().length&&r.tuning.value;var a=this.getSelectLayer(e);if(null===a)throw new K;var o=a;var l=this.getSecondsPerTick();var s=this.portal.selectedTracks[0];var c=this.getStartTime(e);var u=function(){return c-(o.inPoint-o.startTime)};var p=function(){return void 0!==s?c+s.lengthTick*l:c+e.duration};if(1===this.portal.startTimeCombo.getSelectedIndex())c=o.inPoint;else if(!n)o.startTime=u();var h=this.getIntegrator();var _=ut.getUsingLayering();var f=ut.getOptimizeApplyEffects();var d=ut.getAddToEffectTransform();if(o.timeRemapEnabled)o.timeRemapEnabled=false;var m=o.source;var v=(+(m.duration/m.frameDuration).toFixed(0)-1)*m.frameDuration;var g=o.outPoint-o.inPoint-m.frameDuration;var E=0;var y=function(){return t.getEffects(o).property(E).property(2)};if(r.hMirror.value){E=t.getEffects(o).addProperty("ADBE Mirror").propertyIndex;t.getEffects(o).property(E).property(1).setValue([m.width/2,m.height/2])}var T=0;var O={prop:function(){return t.getEffects(o).property(T)},scaleTogether:function(){return this.prop().property(3)},scaleHeight:function(){return this.prop().property(4)},scaleWidth:function(){return this.prop().property(5)},rotation:function(){return this.prop().property(8)},opacity:function(){return this.prop().property(9)}};if(r.hFlip.value||r.cwRotation.value||r.ccwRotation.value||r.mapVelToOpacity.value)if(!d){if(!o.hasVideo)throw new Q;if(r.hFlip.value)o.scale.expressionEnabled=false;if(r.cwRotation.value||r.ccwRotation.value)o.rotation.expressionEnabled=false;if(r.mapVelToOpacity.value)o.opacity.expressionEnabled=false}else{T=this.getGeometry2Effect(o).propertyIndex;O.scaleTogether().setValue(false)}var R=function(t,e){try{t.timeRemap.removeKey(e)}catch(t){}};var L=0;if(r.timeRemap.value||r.timeRemap2.value||r.pingpong.value){if(!o.canSetTimeRemapEnabled)throw new V;o.timeRemapEnabled=true;L=o.timeRemap.valueAtTime(o.inPoint,false);R(o,2);o.timeRemap.expressionEnabled=false}if(!n)o.outPoint=p();var S;var b=this.getBasePitch();if(r.tuning.value){if(!o.hasAudio)throw new H;S=o.duplicate();S.enabled=false;S.moveAfter(o);S.timeRemapEnabled=true;if(!(r.timeRemap.value||r.timeRemap2.value||r.pingpong.value))L=S.timeRemap.valueAtTime(o.inPoint,false);R(S,2);S.startTime=u();S.outPoint=p();S.timeRemap.expressionEnabled=false;o.audioEnabled=false}var C=0;var N=function(){return t.getEffects(o).property(C).property(2)};if(r.negative.value){C=t.getEffects(o).addProperty("ADBE Invert").propertyIndex;N().setValue(100)}var w=0,I=Tt.NOTE_OFF,k=-1;var A=function(t){var e,a,s,u;if(t.startTick<=k&&!(I===Tt.NOTE_OFF&&t instanceof xt))return;var p=h?h.getSecond(t):void 0;var m=(p?p.startSecond:t.startTick*l)+c;if(t instanceof xt){if(0===t.interruptDuration||0===t.duration||+t.interruptDuration<0||+t.duration<0)return;var E=void 0!==t.interruptDuration||void 0!==t.duration;var T=void 0;if(!p){var R=null!==(a=null!==(e=t.interruptDuration)&&void 0!==e?e:t.duration)&&void 0!==a?a:0;T=(t.startTick+R)*l-$t+c}else T=(null!==(u=null!==(s=p.interruptDurationSecond)&&void 0!==s?s:p.durationSecond)&&void 0!==u?u:0)-$t+p.startSecond+c;if(r.hFlip.value){var C=function(t){return!d?o.scale.addKey(t):(O.scaleHeight().addKey(t),O.scaleWidth().addKey(t))};var A=function(t,e){return!d?o.scale.setValueAtKey(t,e):(O.scaleHeight().setValueAtKey(t,e[1]),O.scaleWidth().setValueAtKey(t,e[0]))};var x=function(t,e){return!d?o.scale.setInterpolationTypeAtKey(t,e):(O.scaleHeight().setInterpolationTypeAtKey(t,e),O.scaleWidth().setInterpolationTypeAtKey(t,e))};var D=function(t,e,r){return!d?i.setPointKeyEase(o.scale,t,e,r):(i.setPointKeyEase(O.scaleHeight(),t,e,r),i.setPointKeyEase(O.scaleWidth(),t,e,r))};var M=C(m);var B=w%2?-100:100;if(!f||!E){A(M,[B,100]);x(M,KeyframeInterpolationType.HOLD)}else{A(M,[B+ie*Math.sign(B),100+ie]);x(M,KeyframeInterpolationType.LINEAR);var P=C(T);A(P,[B,100]);D(P,at.EASE_IN,true)}}if(r.cwRotation.value||r.ccwRotation.value){var C=function(t){return!d?o.rotation.addKey(t):O.rotation().addKey(t)};var A=function(t,e){return!d?o.rotation.setValueAtKey(t,e):O.rotation().setValueAtKey(t,e)};var x=function(t,e){return!d?o.rotation.setInterpolationTypeAtKey(t,e):O.rotation().setInterpolationTypeAtKey(t,e)};var D=function(t,e,r){return!d?i.setPointKeyEase(o.rotation,t,e,r):i.setPointKeyEase(O.rotation(),t,e,r)};var z=r.cwRotation.value?w%4*90:(4-w%4)%4*90;var M=C(m);if(!f||!E){A(M,z);x(M,KeyframeInterpolationType.HOLD)}else{var F=z+re*(r.cwRotation.value?-1:1);A(M,F);x(M,KeyframeInterpolationType.LINEAR);var P=C(T);A(P,z);D(P,at.EASE_IN,true)}}if(r.mapVelToOpacity.value){var C=function(t){return!d?o.opacity.addKey(t):O.opacity().addKey(t)};var A=function(t,e){return!d?o.opacity.setValueAtKey(t,e):O.opacity().setValueAtKey(t,e)};var x=function(t,e){return!d?o.opacity.setInterpolationTypeAtKey(t,e):O.opacity().setInterpolationTypeAtKey(t,e)};var z=r.mapVelToOpacity.map(t.velocity);var M=C(m);A(M,z);x(M,KeyframeInterpolationType.HOLD)}if(r.timeRemap.value||r.timeRemap2.value||r.pingpong.value){if(0===w&&0!==t.startTick){var K=o.timeRemap.keyValue(1);var G=o.timeRemap.keyTime(1);o.timeRemap.setValueAtTime(G+m-c,K)}var M=o.timeRemap.addKey(m);var U=!(w%2);o.timeRemap.setValueAtKey(M,L);o.timeRemap.setInterpolationTypeAtKey(M,KeyframeInterpolationType.LINEAR);if(E){var P=o.timeRemap.addKey(T);var V=r.timeRemap.value||r.pingpong.value?L+g:T-m+L;var H=r.pingpong.value&&!U;if(H)o.timeRemap.setValueAtKey(M,V);if(V<o.source.duration)o.timeRemap.setValueAtKey(P,!H?V:L);else{o.timeRemap.removeKey(P);P=o.timeRemap.addKey(m+v-L);o.timeRemap.setValueAtKey(P,v)}o.timeRemap.setInterpolationTypeAtKey(P,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD)}}if(r.negative.value){var M=N().addKey(m);N().setValueAtKey(M,w%2?0:100);N().setInterpolationTypeAtKey(M,KeyframeInterpolationType.HOLD)}if(r.hMirror.value){var M=y().addKey(m);y().setValueAtKey(M,w%2?0:180);y().setInterpolationTypeAtKey(M,KeyframeInterpolationType.HOLD)}if(r.tuning.value&&S){var M=S.timeRemap.addKey(m);S.timeRemap.setValueAtKey(M,L);S.timeRemap.setInterpolationTypeAtKey(M,KeyframeInterpolationType.LINEAR);if(E){var P=S.timeRemap.addKey(T);var j=T-m;var Y=t.pitch-b;var Q=Math.pow(2,Y/12);var V=j*Q+L;if(V<o.source.duration)S.timeRemap.setValueAtKey(P,V);else{S.timeRemap.removeKey(P);P=S.timeRemap.addKey(m+(v-L)/Q);S.timeRemap.setValueAtKey(P,v)}S.timeRemap.setInterpolationTypeAtKey(P,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD)}if(r.mapVelToVolume.value){var q=S.audio.audioLevels;var X=q.addKey(m);var z=r.mapVelToVolume.map(t.velocity);q.setValueAtKey(X,[z,z]);q.setInterpolationTypeAtKey(X,KeyframeInterpolationType.HOLD);if(E){var P=q.addKey(T);var W=-192;q.setValueAtKey(P,[W,W]);q.setInterpolationTypeAtKey(P,KeyframeInterpolationType.HOLD)}}}if(_&&0!==w){if(!n)o=i.splitLayer(o,m);if(r.tuning.value&&S)S=i.splitLayer(S,m)}w++;I=Tt.NOTE_ON;k=t.startTick}};this.dealNoteEvents(s,e,l,L,A)};t.prototype.applyEase100Percent=function(t){app.beginUndoGroup("om midi - Apply Easing 100%");var e=this.portal.toolsTab.ease.getValue();var i=t.selectedLayers;for(var r=0,n=i;r<n.length;r++){var a=n[r];if(void 0===a)continue;for(var o=0,l=a.selectedProperties;o<l.length;o++){var s=l[o];if(void 0===s)continue;for(var c=0,u=s.selectedKeys;c<u.length;c++){var p=u[c];if(void 0===p)continue;this.setPointKeyEase(s,p,e,false)}}}};t.prototype.createNullLayer=function(t){var e;t:while(true){var i=false;try{i=!!this.nullSource&&!!this.nullSource.parentFolder}catch(t){i=false}if(i){e=t.layers.add(this.nullSource,t.workAreaDuration);e.opacity.setValue(0);e.anchorPoint.setValue([0,0])}else{e=t.layers.addNull(t.workAreaDuration);var r=e.source;for(var n=1;n<=r.parentFolder.items.length;n++){var a=r.parentFolder.items[n];if(a.name===te&&a instanceof FootageItem&&a.mainSource instanceof SolidSource){this.nullSource=a;r.remove();continue t}}this.nullSource=r;e.source.name=te}break}e.enabled=false;return e};t.getEffects=function(t){return t("Effects")};t.prototype.addSliderControl=function(e,i){var r=t.getEffects(e).addProperty("ADBE Slider Control");r.name=i;return r.propertyIndex};t.prototype.setValueAtTime=function(e,i,r,n,a,o,l){if(void 0===l)l=o;var s=i.indexOf(r);if(-1===s)return;var c=t.getEffects(e).property(s+1).property(1);var u=c.addKey(n);c.setValueAtKey(u,a);c.setInterpolationTypeAtKey(u,o,l)};t.prototype.getSelectLayer=function(t){if(0===t.selectedLayers.length)return null;var e=t.selectedLayers[0];if(e instanceof AVLayer)return e;return null};t.prototype.getSecondsPerTick=function(){if(!this.portal.midi)throw new z;var t;var e=this.portal.midi.timeDivision;if(e instanceof Array)t=1/e[0]/e[1];else{var i=parseFloat(this.portal.selectBpmTxt.text),r=60/i;t=r/e}return t};t.prototype.getStartTime=function(t){var e=this.portal.startTimeCombo.getSelectedIndex();if(0===e)return t.displayStartTime;else if(1===e)return t.time;else if(2===e)return t.workAreaStart;else return 0};t.prototype.dealNoteEvents=function(t,e,i,r,n){if(void 0!==t)for(var a=0,o=t;a<o.length;a++){var l=o[a];n(l)}else{var s=0;while(s*i<=r+e.duration)n(new xt(0,60,100,+!!s,1,s++))}};t.prototype.getBasePitch=function(){var t=this.portal.applyEffectsTab;return 12*t.basePitchOctCombo.getSelectedIndex()+t.basePitchKeyCombo.getSelectedIndex()};t.prototype.splitLayer=function(t,e){var i=t.outPoint;var r=t.duplicate();t.outPoint=e;r.inPoint=e;r.outPoint=i;return r};t.prototype.setPointKeyEase=function(t,e,i,r){var n=t.keyInTemporalEase(e).length;var a=[];for(var o=0;o<n;o++)a.push(new KeyframeEase(0,100));if(0!==a.length)t.setTemporalEaseAtKey(e,a);var l=r?KeyframeInterpolationType.HOLD:KeyframeInterpolationType.LINEAR;if(i===at.EASE_IN)t.setInterpolationTypeAtKey(e,KeyframeInterpolationType.BEZIER,l);else if(i===at.EASE_OUT)t.setInterpolationTypeAtKey(e,l,KeyframeInterpolationType.BEZIER)};t.prototype.getGeometry2Effect=function(e){var i="ADBE Geometry2";var r=t.getEffects(e);for(var n=1;n<=r.numProperties;n++){var a=r.property(n);if(a.name===ee&&a.matchName===i)return a}var o=r.addProperty(i);o.name=ee;return o};t.prototype.getIntegrator=function(){var t=this.portal.midi;return t&&t.isDynamicBpm&&t.integrator&&this.portal.isUseDynamicBpm()?t.integrator:void 0};return t}();var oe="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAEMklEQVRIib1WTUgjWRCudeemiK4N4iy6GjYHESHYZC8yvqcEVvxBUEQvUcQQzOYayDALe3IGc1ToGQysoBdJBvUQVi9BXoSAkDQEg+QQiBsRvXQiO8bAHpYsX6c7ZESduewWNP3yut6rqq/qq8o3jDH6Smk11G6/9kAsFqMXWAghnlTinPuIyCNJkgW/NU2DgY9E9EEIkXrmXHWBCCqVyqMPY0z2+XwVTdMqptzf31disViFMbb51DnjrH7/iy9E6Z6cnNQXGxsb+ttms9HQ0BBZrVY35zwghMg9d0HNAOe8GVAQEaCICiEAg9zT00Pn5+e0v78fxH46nQ7DQH9/P2WzWZlzDsjcRo4+CiHURw0Q0ZrX6/W0t7dTKpWCd6okSXJbWxudnp7iew5GOee5QqFgsVqt2PNLkhSem5ujpqYmOj4+9nPOXUKI32u3AivG2NutrS0d5cvLy9ob2OM9MzMDzFsNbP3hcLimg5zgMXUZY0nG2A9mDlCmrZIkFXd2dvSyCgQCqt1ul0dGRqhUKlEoFELluIhIMmCIEtH09PS0B1GYOpC6OwJE9BprGPB7vd618fFxWlhYwGXdxmWzRs03S5L0xoRBVVWKRqMwgpzIhg7Wfgg8Hxsbw953MICQw8lkUg/R5XIhxLd1pfYecACCeslkMiZsw4aeDWV7eHioa6G0UeJmDoahbOJpfPSZHICg7mEceuvr67oenIJzjLFmXA4dCByCY2YOvu3u7v6zXC5fHRwcfD8wMPByYmKCwuHwj8B7ZWVFBiwejydXLBZHyuXym0wm809LS8srh8NB8Xi8r1gs/uX1elE9wB75+AD8iejvfD5PDVRtFSirQDweJ5Sl0RZ0DpTLZajcoi0IIYBt6ubmRvcOXIAjcKJQKCA3qhDiFyHEp894wDlfBskGBwd1RU3TwE714uJC7uvr0y/hnNuIKA8yd3R06IfT6bRuHJXU2dlJDocDxHtvRPDJhGhYkqS9zc3Nl11dXbS6ukrX19fviGivVCq5p6amyGKxtF5dXa00NDT4R0dHX83Pz9PZ2Rnt7u6C7b8lEok2i8UiO51OamxstCcSiRYi+gMQ/edVBIjUXC4329vbS7e3eqsPcs4dRIQnryjKu1Ao9BQPfuac/2Ss9cPIWSKRwFo1DQRDoZBOtOXlZVTCHrCUZfkzJiuK8pDJ4Tomr5ltRydX1eD/04vMifYr5xzl5gEM29vbesmhm6K/AB5FUdCS0WPc6FNHR0d634IOvqMLRyIRMiZd3pxo9e36taIoeRMGIUSUc54sFAoyDmNOcM5n7Xa7BVzJZrPYC2iaFjWMgzvBJ+eBQY7Ag4FU48Li4qL77u7ObcwBkwMgFhL68NyjA+cxCUYiETcYvbS0VPt+cnKCCODts+PyiwYQLiaU0+nEv4pqd6z+s0CVoOc8L0T0L32CI0/szYESAAAAAElFTkSuQmCC";var le=function(t){s(e,t);function e(i,r){if(void 0===r)r="tmp"+(new Date).valueOf()+".png";var n=t.call(this,r)||this;if(n&&n.open("w")){n.encoding="binary";n.write(e.base64Decode(i));n.close()}else throw new B;return n}e.base64Decode=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var i={RE_NON_ALPHA:new RegExp("[^"+e+"]"),RE_BAD_EQUALS:/\=([^=]|\=\=)/};var r=t.length>>>0,n=[];if(r%4||i.RE_NON_ALPHA.test(t)||i.RE_BAD_EQUALS.test(t))throw Error("Invalid Base64 data");var a=0,o,l,s,c,u,p,h,_;while(a<r){o=e.indexOf(t[a++]);l=e.indexOf(t[a++]);s=e.indexOf(t[a++]);c=e.indexOf(t[a++]);u=(o<<18)+(l<<12)+((63&s)<<6)+(63&c);p=(u&255<<16)>>16;h=64===s?-1:(u&255<<8)>>8;_=64===c?-1:255&u;n[n.length]=String.fromCharCode(p);if(0<=h)n[n.length]=String.fromCharCode(h);if(0<=_)n[n.length]=String.fromCharCode(_)}t=n.join("");n.length=0;return t};e.settingIcon=function(){return new e(oe,"settings_icon.png")};return e}(ft);var se=1e4;var ce=22;var ue=15;var pe=function(){function t(t){var e,i,r,a;var l=this;this.selectedTracks=[];this.window=t;this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:["fill","fill"],spacing:5});var s=["fill","center"];e=o(this.group,"","button",{text:"...",size:[ue,ce]}),this.selectMidiGroup=e.group,this.selectMidiLbl=e.label,this.selectMidiBtn=e.control;this.selectMidiName=n(this.selectMidiGroup,"statictext",{alignment:s});i=o(this.group,"","button",{text:"",alignment:s,maximumSize:[se,ce],enabled:false}),this.selectTrackGroup=i.group,this.selectTrackLbl=i.label,this.selectTrackBtn=i.control;r=o(this.group,"","edittext",{text:"120",alignment:s,enabled:false}),this.selectBpmGroup=r.group,this.selectBpmLbl=r.label,this.selectBpmTxt=r.control;a=o(this.group,"","dropdownlist",{alignment:s}),this.startTimeGroup=a.group,this.startTimeLbl=a.label,this.startTimeCombo=a.control;this.tabs=n(this.group,"tabbedpanel",{alignment:["fill","fill"]});this.buttonGroup=n(this.group,"group",{orientation:"row",alignment:["fill","bottom"]});this.applyBtn=n(this.buttonGroup,"button",{alignment:"left"});var c=le.settingIcon();this.settingBtn=n(this.buttonGroup,"iconbutton",{alignment:["right","center"],image:c},{style:"toolbutton"});c.remove();this.nullObjTab=new L(this);this.applyEffectsTab=new tt(this);this.toolsTab=new _t(this);this.translate();this.core=new ae(this);this.selectMidiBtn.onClick=function(){var t;var e=File.openDialog(localize(f.select_a_midi_file),localize(f.midi_files)+":*.mid;*.midi,"+localize(f.all_files)+":*.*");if(null===e)return;var i;try{i=new jt(e);if(0===i.tracks.length)throw new D;l.updateDefaultBpm(i);l.selectMidiName.text=e.displayName;var r=i.tracks[i.preferredTrackIndex];l.selectedTracks=[r];l.selectTrackBtn.text=r.toString();l.selectTrackBtn.enabled=true;l.selectBpmTxt.enabled=true;l.midi=i}catch(e){if(i)null===(t=i.file)||void 0===t?void 0:t.close();throw new C(e)}};this.applyBtn.onClick=function(){return l.core.apply()};this.settingBtn.onClick=function(){var t;new Xt(l).showDialog();if(null===(t=l.midi)||void 0===t?void 0:t.isPureQuarter)l.selectTrackBtn.enabled=false;l.translate()};this.selectTrackBtn.onClick=function(){new Wt(l).showDialog()};this.tabs.onChange=function(){var t=l.getSelectedTab();if(t===l.applyEffectsTab)l.startTimeCombo.selection=ut.getApplyEffectsStartTime();else l.startTimeCombo.selection=ut.getNullObjectStartTime()};this.tabs.onChange();this.startTimeCombo.onChange=function(){var t=l.getSelectedTab(),e=l.startTimeCombo.getSelectedIndex();if(t===l.applyEffectsTab)ut.setApplyEffectsStartTime(e);else ut.setNullObjectStartTime(e)}}t.build=function(e,i){$.strict=true;var r=e instanceof Panel?e:new Window("palette",i.scriptName+" v"+i.version,void 0,{resizeable:true});if(null===r)throw new N;var n=new t(r);r.onShow=r.onResizing=r.onResize=function(){r.layout.resize();n.resizeScrollGroups()};if(r instanceof Window){r.center();r.show()}else{r.layout.layout(true);r.layout.resize()}return n};t.prototype.getSelectedTab=function(){if(null===this.tabs.selection)return null;switch(this.tabs.selection.text){case this.nullObjTab.tab.text:return this.nullObjTab;case this.applyEffectsTab.tab.text:return this.applyEffectsTab;case this.toolsTab.tab.text:return this.toolsTab;default:return null}};t.prototype.translate=function(){this.applyBtn.text=localize(f.apply);this.nullObjTab.translate();this.applyEffectsTab.translate();this.toolsTab.translate();if(!this.midi||!this.selectedTracks.length)this.selectMidiName.text=localize(f.no_midi_file_selected);this.selectMidiLbl.text=localize(f.select_midi_file);this.selectTrackLbl.text=localize(f.select_midi_track);this.selectBpmLbl.text=localize(f.set_midi_bpm);this.startTimeLbl.text=localize(f.start_time);a(this.startTimeCombo,localize(f.display_start_time),localize(f.current_time),localize(f.work_area),"0")};t.prototype.resizeScrollGroups=function(){var t=[this.nullObjTab,this.applyEffectsTab];for(var e=0,i=t;e<i.length;e++){var r=i[e];r.group.onResize()}};t.prototype.displayBpmForNoBpm=function(){var t;try{t=parseFloat(this.selectBpmTxt.text)}catch(e){t=120}return String(t)};t.prototype.updateDefaultBpm=function(t){var e=t.bpm?t.displayBpm():this.displayBpmForNoBpm();this.selectBpmTxt.text=e;q(this.selectBpmTxt,{type:"decimal",min:1},e)};t.prototype.isUseDynamicBpm=function(){return-1!==this.selectBpmTxt.text.indexOf(v)};return t}();function he(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1};Array.prototype.includes=function(t){return-1!==this.indexOf(t)};Array.prototype.forEach=function(t){for(var e=0;e<this.length;e++){var i=this[e];t(i,e,this)}};DropDownList.prototype.getSelectedIndex=function(){for(var t=0;t<this.items.length;t++)if(this.items[t].selected)return t;return-1};Math.sign=function(t){if(t>0)return 1;else if(t<0)return-1;else return 0}}if("aftereffects"!==BridgeTalk.appName)throw new M;else if(parseFloat(app.version)<9)throw new Y;else{he();pe.build(t,e)}})(this);

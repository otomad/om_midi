/**
 * om midi v3.14.20.0
 * After Effects 的音 MAD / YTPMV 辅助脚本。它是一个能够自动将 MIDI 文件转换为 After Effects 中关键帧的脚本。
 * 希望在 om midi 的帮助下，可以把人们从枯燥繁重的音画对齐中解救出来，把更多的精力投入到更有创造性的工作中。
 *
 * 描述：读取一个 MIDI 序列，并为当前合成添加一个或多个新图层，其中包含各个 MIDI 轨道的音高、力度和持续时间等滑块控件。
 *
 * 脚本原作者：大卫·范·布林克 (omino)、Dora (NGDXW)、家鳖大帝
 * 脚本作者：兰音
 *
 * 在此处获取最新版：https://github.com/otomad/om_midi/releases/latest
 * 仓库地址：https://github.com/otomad/om_midi
 *
 * 构建日期：2023 年 2 月 20 日 星期一 中午 12:59:01
 * Copyright (c) 2022 ~, Ranne
 *
 * 原作者介绍：
 * 日期：2011 年 12 月 25 日 星期日 晚上 22:58:10 太平洋时间
 * 作者：大卫·范·布林克
 *
 * 此脚本是 omino Adobe 脚本套件的一部分。
 * 我写这些是因为我喜欢。请尽情享受。
 * 向 poly@omino.com 提出问题，主题栏应以“插件”开头，以便我的垃圾邮件过滤器允许它。
 * 此文件已被预处理为独立脚本。我针对一些可重用的库开发它们⸺例如对话框布局⸺但对于分发来说，最好只有一个文件。
 * 大卫·范·布林克 2007。
 *
 * ****************************************************************************************************
 *
 * om midi v3.14.20.0
 * Or OMM for short, an Otomad/YTPMV assistant script for After Effects. It is a script that automatically
 * converts MIDI files to keyframes in After Effects. Hope that with the help of om midi, people can be
 * rescued from tedious aligning video and audio, and put more energy into more creative works.
 *
 * Description: This After Effects script reads a Standard MIDI file (.mid)
 * and creates layers and keyframes corresponding to the notes and controllers in that MIDI file.
 *
 * Script Original Authors: David Van Brink (omino), Dora (NGDXW), Z4HD
 * Script Author: Ranne
 *
 * Get the Latest Version Here: https://github.com/otomad/om_midi/releases/latest
 * Repository Link: https://github.com/otomad/om_midi
 *
 * Building Date: Monday, February 20, 2023 12:59 PM
 * Copyright (c) 2022 ~, Ranne
 *
 * Introduction by the Original Author:
 * Date: Sunday, December 25, 2011 10:58 PM PST
 * Author: David Van Brink
 * This script is part of the omino adobe script suite.
 *
 * I write these because I like to. Please enjoy as you see fit.
 *
 * Questions to poly@omino.com, subject line should start with "plugins" so my spam filter lets it in.
 *
 * This file has been preprocessed to be standalone. I develop them against some reusable libraries
 * ⸺ such as for dialog layout ⸺ but for distribution it's nicer to have just one file.
 * dvb 2007.
 */

(function(t){"use strict";var e={scriptName:"om midi",version:"3.14.20.0",githubPage:unescape("%68%74%74%70%73%3a%2f%2f%67%69%74%68%75%62%2e%63%6f%6d%2f%6f%74%6f%6d%61%64%2f%6f%6d%5f%6d%69%64%69"),githubLatest:unescape("%68%74%74%70%73%3a%2f%2f%67%69%74%68%75%62%2e%63%6f%6d%2f%6f%74%6f%6d%61%64%2f%6f%6d%5f%6d%69%64%69%2f%72%65%6c%65%61%73%65%73%2f%6c%61%74%65%73%74")};function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function r(t,e){for(var r in e)try{if(i(e,r))t[r]=e[r]}catch(t){}return t}function n(t,e,i,n){var o;if("group"===e)o=t.add(e,void 0,n);else if("progressbar"===e)o=t.add(e,void 0,void 0,void 0,n);else if("scrollbar"===e||"slider"===e)o=t.add(e,void 0,void 0,void 0,void 0,n);else o=t.add(e,void 0,void 0,n);var a=o;if(void 0!==i)r(a,i);return a}function o(t){var e=[];for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=t.items.length?t.getSelectedIndex():0;t.removeAll();for(var n=0,o=e;n<o.length;n++){var a=o[n];t.add("item",a)}t.selection=r;return t}function a(t,e,i,r,o){var a=function(){return n(t,"group",{orientation:"row",spacing:7,alignment:"fill",alignChildren:"fill"})};var l=function(t){var e=60;t.minimumSize=[e,Number.MAX_VALUE]};var s=function(t,e){var i=n(t,"statictext",{text:e});l(i);return i};var c=a();var u=s(c,e);var p=void 0;if(i)p=n(c,i,r,o);var _={group:c,label:u,control:p};return _}var l=function(t,e){l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i))t[i]=e[i]};return l(t,e)};function s(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");l(t,e);function i(){this.constructor=t}t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var c=function(){c=Object.assign||function t(e){for(var i,r=1,n=arguments.length;r<n;r++){i=arguments[r];for(var o in i)if(Object.prototype.hasOwnProperty.call(i,o))e[o]=i[o]}return e};return c.apply(this,arguments)};function u(t,e,i){if(i||2===arguments.length)for(var r=0,n=e.length,o;r<n;r++)if(o||!(r in e)){if(!o)o=Array.prototype.slice.call(e,0,r);o[r]=e[r]}return t.concat(o||Array.prototype.slice.call(e))}var p={__translator__:"",ok:"OK",cancel:"Cancel",channel_abbr:"CH",error:"Error",warning:"Warning",apply:"Apply",settings:"Settings",select_all:"Select all",channel:"Channel",name:"name",note_count:"Note count",language:"Language",general:"General",app_default:"App Default",tools:"Tools",create_null_object_short:"Null",create_null_object:"Create Null Object",apply_effects_short:"Effects",apply_effects:"Apply Effects",marker_conductor:"Marker Conductor",easing_100_percent:"Easing 100%",unit:"Unit",time:"Time",frames:"Frames",seconds:"Seconds",beat:"Beat",shift_seconds_and_frames:"Shift",mark_on:"Mark on",add_null_layer:"Add null layer",current_layer:"Current layer",ease_in:"Ease in",ease_out:"Ease out",ease_in_out:"Ease in out",midi_track_selector_title:"Select MIDI tracks",select_at_least_one_track:"Please select at least one track.",no_midi_file_selected:"No MIDI file selected",select_midi_file:"MIDI",select_midi_track:"Track",set_midi_bpm:"BPM",start_time:"Start time",display_start_time:"Display start time",current_time:"Current time",work_area:"Work area",select_a_midi_file:"Select a MIDI Sequence",midi_files:"MIDI Sequence",all_files:"All Files",check_update:"Check for updates",repository_link:"Repository link",about_script_engine:"About ExtendScript engine",import_om_utils:"Import om utils",import_pure_quarter_midi:"Import pure quarter MIDI",using_selected_layer_name:"Use selected layer name instead of MIDI track name　",normalize_pan_to_100:"Normalize the pan to -100 ~ 100",using_layering:"@Hibato Sakuno's unique layering method",optimize_apply_effects:"Turn on visual motion for some effects",add_to_effect_transform:"Add the properties to an effect called Transform",sure_to_import_pure_quarter_midi:"Are you sure you want to import the pure quarter notes MIDI file?",pure_quarter_midi:"Pure quarter notes MIDI",add_at_top_of_expression:"Prepend to expressions",om_utils_same_as_project_directory:"If placed in the same directory as the aep project",om_utils_added_to_project:"If placed anywhere, and then add to AE project",pitch:"Pitch",velocity:"Velocity",duration:"Duration",scale:"Scale",cw_rotation:"Clockwise Rotation",ccw_ratation:"Counterclockwise Rotation",count:"Count",bool:"Bool",time_remap:"Time Remap",pingpong:"Ping-pong",note_on:"Note On",channel_pan:"Channel Pan",channel_volume:"Channel Volume",channel_glide:"Channel Glide",horizontal_flip:"Horizontal Flip",invert_color:"Invert Color",tuning:"Tuning",base_pitch:"Base pitch",paren_stretched:" (Stretched)",paren_truncated:" (Truncated)",cannot_find_window_error:"Error: Unable to find or create window.",unsupported_setting_type_error:"Error: Unsupported setting data type.",file_unreadable_error:"Error: Could not read the MIDI file. The file may already be occupied or not exist.",midi_header_validation_error:"Error: MIDI file header chunks validation failed (not a standard MIDI file or this file is corrupt).",midi_track_header_validation_error:"Error: MIDI track header chunks validation failed.",midi_custom_events_error:"Error: Custom MIDI events could not be read.",midi_no_track_error:"Error: This MIDI file does not contain any valid tracks.",not_after_effects_error:"Error: Please use this script on Adobe After Effects.",cannot_create_file_error:"Error: Could not create file.",cannot_find_composition_error:"Error: Could not find an active composition. Please activate a composition first.\n\nSolution: Open a composite first, then click on the composite preview or track window to make it active.",no_midi_error:"Error: Please open a valid MIDI file first.",no_options_checked_error:"Error: Please check at least one option.",no_layer_selected_error:"Error: No layers are selected in the current composition.",not_one_track_for_apply_effects_only_error:"Error: Applying effects can only select one MIDI track at one time.",end_of_track_position_error:"Error: Track ends in wrong position. Expected %1, actually %2.",cannot_set_time_remap_error:"Error: Time remapping cannot be set for the selected layer.",cannot_tuning_error:"Error: The selected layer does not contain audio so that cannot be tuned.",about:"It reads a Standard MIDI sequence file and creates layers and keyframes corresponding to the notes and controllers in that MIDI sequence file.\n\nVersion: %4\nApp: %2\nSpecifier: %3\n\nOriginal Authors: David Van Brink (omino), Dora (NGDXW), Z4HD\nAuthor: Ranne\nRepository Link: %1",horizontal_mirror:"Horizontal Mirror",advanced_scale:"Advanced Scale",loading_midi:"Loading %1 ...",unsupported_fps_time_division_error:"Error: The current mode does not support frames per second time division data format.",low_version_error:"Error: Using Adobe After Effects software version is too low, please update.",map_velocity:"Mapping Velocity",map_velocity_to_opacity:"Mapping Velocity to Opacity",map_velocity_to_volume:"Mapping Velocity to Volume",opacity:"Opacity",audio_levels:"Audio levels",notes_velocity:"Notes velocity",has_no_video_error:"Error: The selected layer does not contain video so that the selected effect cannot be applied.",motion_for_horizontal_flip:"Motion for Horizontal Flip",motion_entrance:"Entrance",motion_exit:"Exit",motion_float_left:"Float Left",motion_float_right:"Float Right",motion_float_up:"Float Up",motion_float_down:"Float Down",script_translator:"Translator: "};var _={__translator__:"",ok:"OK",cancel:"キャンセル",channel_abbr:"チャネル",error:"エラー",warning:"警告",apply:"適用",settings:"設定",select_all:"すべて選択",channel:"チャネル",name:"名",note_count:"音符の数",language:"言語",general:"一般",app_default:"アプリのデフォルト",tools:"ツール",create_null_object_short:"ヌル",create_null_object:"ヌル オブジェクトを作成",apply_effects_short:"効果を適用",apply_effects:"効果を適用",marker_conductor:"マーカー司令官",easing_100_percent:"イージング百パーセント",unit:"単位",time:"時間",frames:"フレーム",seconds:"秒数",beat:"拍子",shift_seconds_and_frames:"シフト",mark_on:"どこ",add_null_layer:"ヌルレイヤーを追加",current_layer:"現在のレイヤー",ease_in:"イーズイン",ease_out:"イーズアウト",ease_in_out:"イーズインアウト",midi_track_selector_title:"MIDI トラックを選択",select_at_least_one_track:"少なくとも 1 つのトラックを選択してください。",no_midi_file_selected:"MIDI が選択されていない",select_midi_file:"MIDI",select_midi_track:"トラック",set_midi_bpm:"BPM",start_time:"開始時刻",display_start_time:"表示開始時刻",current_time:"現在の時刻",work_area:"作業エリア",select_a_midi_file:"MIDI シーケンスを選択する",midi_files:"MIDI シーケンス",all_files:"全ファイル",check_update:"アップデートを確認",repository_link:"リポジトリ リンク",about_script_engine:"スクリプトエンジンについて",import_om_utils:"om utils をインポート",import_pure_quarter_midi:"純粋な 4 分 MIDI をインポート",using_selected_layer_name:"MIDI トラック名の代わりに、選択したレイヤー名を使用します",normalize_pan_to_100:"パンを -100~100 に正規化します",using_layering:"@氷鳩さくのの特有なレイヤリング方法",optimize_apply_effects:"一部の効果の視覚モーションを有効にする",add_to_effect_transform:"変換という効果にプロパティを追加します",sure_to_import_pure_quarter_midi:"純粋な 4 分音符 MIDI ファイルをインポートしてもよろしいですか？",pure_quarter_midi:"純粋な 4 分音符 MIDI",add_at_top_of_expression:"式の先頭に追加",om_utils_same_as_project_directory:"AEP プロジェクトと同じディレクトリに配置する場合",om_utils_added_to_project:"任意の場所に配置し、AE プロジェクトに追加する場合",pitch:"ピッチ",velocity:"ベロシティ",duration:"持続時間",scale:"スケール",cw_rotation:"右回り",ccw_ratation:"左回り",count:"カウント",bool:"ブール",time_remap:"時間リマップ",pingpong:"ピンポン",note_on:"音符オン",channel_pan:"チャンネルパン",channel_volume:"チャンネル音量",channel_glide:"チャンネルポルタメント",horizontal_flip:"水平方向にフリップ",invert_color:"色を反転",tuning:"色を反転",base_pitch:"ベースピッチ",paren_stretched:"（ストレッチ）",paren_truncated:"（切り捨て）",cannot_find_window_error:"エラー：ウィンドウが見つからないか作成できません。",unsupported_setting_type_error:"エラー：サポートされていないセット データ型です。",file_unreadable_error:"エラー：MIDI ファイルを読み取れませんでした。ファイルが既に占有されているか、存在しない可能性があります。",midi_header_validation_error:"エラー：MIDI ファイル ヘッダー チャンクの検証に失敗しました（標準の MIDI ファイルではないか、ファイルが破損しています）。",midi_track_header_validation_error:"エラー：MIDI トラック ヘッダー チャンクの検証に失敗しました。",midi_custom_events_error:"エラー：カスタム MIDI イベントを読み取れませんでした。",midi_no_track_error:"エラー：MIDI ファイルに有効なトラックが含まれていません。",not_after_effects_error:"エラー：Adobe After Effects でこのスクリプトを使用してください。",cannot_create_file_error:"エラー：ファイルを作成できませんでした。",cannot_find_composition_error:"エラー：アクティブな構成が見つかりません。最初にコンポジションをアクティブにしてください。\n\n解決策: まずコンポジットを開き、コンポジット プレビューまたはトラック ウィンドウをクリックしてアクティブにします。",no_midi_error:"エラー：最初に有効な MIDI ファイルを開いてください。",no_options_checked_error:"エラー：少なくとも 1 つのオプションをオンにしてください。",no_layer_selected_error:"エラー：現在のコンポジションでレイヤーが選択されていません。",not_one_track_for_apply_effects_only_error:"エラー：エフェクトを適用すると、一度に選択できる MIDI トラックは 1 つだけです。",end_of_track_position_error:"エラー：トラックの終了位置が間違っています。期待される %1、実際には %2。",cannot_set_time_remap_error:"エラー：選択したレイヤーにタイム リマップを設定できません。",cannot_tuning_error:"エラー：選択したレイヤーにはオーディオが含まれていないため、調整できません。",about:"標準 MIDI ファイルを読み取り、その MIDI ファイル内のノートとコントローラーに対応するレイヤーとキーフレームを作成します。\n\nバージョン：%4\nアプリ：%2\nスペック：%3\n\n元開発者：デビッド・ヴァン・ブリンク（オミノ）、ドラ (NGDXW)、家鼈大帝\n開発者：蘭音\nリポジトリ リンク：%1",horizontal_mirror:"水平方向のミラー",advanced_scale:"高度なスケール",loading_midi:"%1 を読み込んでいます...",unsupported_fps_time_division_error:"エラー：現在のモードは、FPS 時分割データフォーマットに対応していません。",low_version_error:"エラー：Adobe After Effects のソフトウェアのバージョンが低すぎるため、アップデートしてください。",map_velocity:"ベロシティのマッピング",map_velocity_to_opacity:"ベロシティと不透明度のマッピング",map_velocity_to_volume:"ベロシティとオーディオレベルのマッピング",opacity:"不透明度",audio_levels:"オーディオレベル",notes_velocity:"音符ベロシティ",has_no_video_error:"エラー：選択したレイヤーにはビデオが含まれていないため、選択されたエフェクトを適用できません。",motion_for_horizontal_flip:"水平方向にフリップのモーション",motion_entrance:"開始",motion_exit:"終了",motion_float_left:"フロートレフト",motion_float_right:"フロートライト",motion_float_up:"フロートアップ",motion_float_down:"フロートダウン",script_translator:"訳者："};var h={__translator__:"",ok:"确定",cancel:"取消",channel_abbr:"通道",error:"错误",warning:"警告",apply:"应用",settings:"设置",select_all:"全选",channel:"通道",name:"名称",note_count:"音符数",language:"语言",general:"通用",app_default:"应用默认值",tools:"工具",create_null_object_short:"空对象",create_null_object:"创建空对象",apply_effects_short:"应用效果",apply_effects:"应用效果",marker_conductor:"标记指挥官",easing_100_percent:"缓动百分百",unit:"单位",time:"时间",frames:"帧数",seconds:"秒数",beat:"节拍",shift_seconds_and_frames:"偏移",mark_on:"标记在",add_null_layer:"新建空对象图层",current_layer:"当前图层",ease_in:"缓入",ease_out:"缓出",ease_in_out:"缓入缓出",midi_track_selector_title:"选择 MIDI 轨道",select_at_least_one_track:"请至少选择一条轨道。",no_midi_file_selected:"未选择 MIDI 文件",select_midi_file:"MIDI 文件",select_midi_track:"选择轨道",set_midi_bpm:"设定 BPM",start_time:"开始时间",display_start_time:"显示开始时间",current_time:"当前时间",work_area:"工作区域",select_a_midi_file:"选择一个 MIDI 序列",midi_files:"MIDI 序列",all_files:"所有文件",check_update:"检查更新",repository_link:"仓库地址",about_script_engine:"关于脚本引擎",import_om_utils:"导入 om utils",import_pure_quarter_midi:"导入纯四分 MIDI",using_selected_layer_name:"使用选中图层名称而不是 MIDI 轨道名称",normalize_pan_to_100:"声像标准化到 -100 ~ 100",using_layering:"@冰鸠樱乃的特有图层叠叠乐方法",optimize_apply_effects:"为部分效果开启视觉动画",add_to_effect_transform:"将属性添加到效果中的变换中",sure_to_import_pure_quarter_midi:"确定要导入纯四分音符 MIDI 文件吗？",pure_quarter_midi:"纯四分音符 MIDI",add_at_top_of_expression:"在表达式顶部添加",om_utils_same_as_project_directory:"若放置在 aep 项目的相同目录下",om_utils_added_to_project:"若放置在任意位置，然后添加到 AE 项目中",pitch:"音高",velocity:"力度",duration:"持续时间",scale:"缩放",cw_rotation:"顺时针旋转",ccw_ratation:"逆时针旋转",count:"计数",bool:"布尔",time_remap:"时间重映射",pingpong:"来回",note_on:"音符开",channel_pan:"通道声像",channel_volume:"通道音量",channel_glide:"通道弯音",horizontal_flip:"水平翻转",invert_color:"颜色反转",tuning:"调音",base_pitch:"原始音高",paren_stretched:"（拉伸）",paren_truncated:"（截断）",cannot_find_window_error:"错误：无法找到或创建窗口。",unsupported_setting_type_error:"错误：不支持的设置数据类型。",file_unreadable_error:"错误：无法读取 MIDI 文件。该文件可能已占用或不存在。",midi_header_validation_error:"错误：MIDI 文件头验证失败（不是标准 MIDI 文件或文件已损坏）。",midi_track_header_validation_error:"错误：MIDI 轨道块标头验证失败。",midi_custom_events_error:"错误：自定义 MIDI 事件无法读取。",midi_no_track_error:"错误：该 MIDI 文件不包含任何有效轨道。",not_after_effects_error:"错误：请在 Adobe After Effects 上使用此脚本。",cannot_create_file_error:"错误：无法创建文件。",cannot_find_composition_error:"错误：无法找到活动合成。请先激活一个合成。\n\n解决方法：请先打开一个合成，然后点击一下该合成的预览画面或轨道的窗口使之处于活跃状态即可。",no_midi_error:"错误：请先打开一个有效的 MIDI 文件。",no_options_checked_error:"错误：请至少勾选一个项目。",no_layer_selected_error:"错误：在当前合成中未选中任何图层。",not_one_track_for_apply_effects_only_error:"错误：应用效果只能同时选择一条轨道。",end_of_track_position_error:"错误：轨道结束位置有误。应为 %1，实际 %2。",cannot_set_time_remap_error:"错误：所选图层不能设置时间重映射。",cannot_tuning_error:"错误：所选图层不包含音频，不能进行调音。",about:"读取一个 MIDI 序列，并为当前合成添加一个或多个新图层，其中包含各个 MIDI 轨道的音高、力度和持续时间等滑块控件。\n\n脚本版本：%4\n应用程序：%2\n应用版本：%3\n\n脚本原作者：大卫·范·布林克 (omino)、哆啦 (NGDXW)、家鳖大帝\n脚本作者：兰音\n仓库地址：%1",horizontal_mirror:"水平镜像",advanced_scale:"高级缩放",loading_midi:"加载 %1 ...",unsupported_fps_time_division_error:"错误：当前模式不支持帧每秒时分数据格式。",low_version_error:"错误：使用 Adobe After Effects 软件版本过低，请更新。",map_velocity:"映射力度",map_velocity_to_opacity:"映射力度到不透明度",map_velocity_to_volume:"映射力度到音频电平",opacity:"不透明度",audio_levels:"音频电平",notes_velocity:"音符力度",has_no_video_error:"错误：所选图层不包含视频，不能应用所选效果。",motion_for_horizontal_flip:"水平翻转的运动方式",motion_entrance:"进入",motion_exit:"退出",motion_float_left:"左浮",motion_float_right:"右浮",motion_float_up:"上浮",motion_float_down:"下浮",script_translator:"脚本翻译："};var f={__translator__:"Cyahega",ok:"OK",cancel:"Hủy",channel_abbr:"CH",error:"Lỗi",warning:"Cảnh báo",apply:"Áp dụng",settings:"Cài đặt",select_all:"Chọn tất cả",channel:"Channel",name:"Tên",note_count:"Số nốt đếm được",language:"Ngôn ngữ",general:"Chung",app_default:"Mặc định ứng dụng",tools:"Công cụ",create_null_object_short:"Các thông số",create_null_object:"Tạo vật thể trống",apply_effects_short:"Hiệu ứng",apply_effects:"Áp dụng hiệu ứng",marker_conductor:"Thêm điểm đánh dấu",easing_100_percent:"Easing 100%",unit:"Đơn vị",time:"Thời gian",frames:"Khung hình",seconds:"Giây",beat:"Beat",shift_seconds_and_frames:"Thay đổi giây và khung hình",mark_on:"Đánh dấu",add_null_layer:"Thêm layer trống",current_layer:"Layer hiện tại",ease_in:"Ease in",ease_out:"Ease out",ease_in_out:"Ease in out",midi_track_selector_title:"Chọn MIDI track",select_at_least_one_track:"Vui lòng chọn ít nhất một track.",no_midi_file_selected:"Không có tệp MIDI được chọn",select_midi_file:"MIDI",select_midi_track:"Track",set_midi_bpm:"BPM",start_time:"Thời gian bắt đầu",display_start_time:"Thời gian bắt đầu hiển thị",current_time:"Thời gian hiện tại",work_area:"Khu vực làm việc",select_a_midi_file:"Chọn một trình tự MIDI",midi_files:"Trình tự MIDI",all_files:"Tất cả tệp",check_update:"Kiểm tra bản cập nhật",repository_link:"Link đến lưu trữ",about_script_engine:"Về ExtendScript engine",import_om_utils:"Nhập om utils",import_pure_quarter_midi:"Nhập MIDI quý thuần túy",using_selected_layer_name:"Sử dụng tên layer đã chọn thay vì tên track MIDI",normalize_pan_to_100:"Normalize pan từ -100 ~ 100",using_layering:"Phương pháp layering độc nhất của @Băng Cưu Anh Nãi　",optimize_apply_effects:"Bật visual motion cho một số hiệu ứng",add_to_effect_transform:"Thêm các thuộc tính vào một hiệu ứng gọi là Transform",sure_to_import_pure_quarter_midi:"Bạn có chắc chắn muốn nhập nốt tệp MIDI quý thuần túy không?",pure_quarter_midi:"Nốt MIDI quý thuần túy",add_at_top_of_expression:"Thêm vào biểu thức",om_utils_same_as_project_directory:"Nếu được đặt trong cùng thư mục với project aep",om_utils_added_to_project:"Nếu được đặt vào bất cứ đâu, và sau đó thêm vào project AE",pitch:"Cao độ (pitch)",velocity:"Velocity",duration:"Thời lượng",scale:"Tỉ lệ",cw_rotation:"Xoay theo chiều kim đồng hồ",ccw_ratation:"Xoay ngược chiều kim đồng hồ",count:"Đếm",bool:"Bool",time_remap:"Sắp xếp lại thời gian",pingpong:"Ping-pong",note_on:"Note On",channel_pan:"Pan Channel",channel_volume:"Âm lượng Channel",channel_glide:"Lướt Channel",horizontal_flip:"Lật ngang",invert_color:"Đảo ngược màu",tuning:"Tuning",base_pitch:"pitch ban đầu",paren_stretched:" (Đã kéo dãn)",paren_truncated:" (Đã cắt ngắn)",cannot_find_window_error:"Lỗi: Không thể tìm kiếm hoặc tạo cửa sổ",unsupported_setting_type_error:"Lỗi: Loại dữ liệu cài đặt này không hỗ trợ .",file_unreadable_error:"Lỗi: Không thể đọc tệp MIDI. Tệp có thể đã bị chiếm dụng hoặc không tồn tại.",midi_header_validation_error:"Lỗi: Xác thực khối tiêu đề tệp MIDI không thành công (không phải tệp MIDI tiêu chuẩn hoặc tệp này bị hỏng).",midi_track_header_validation_error:"Lỗi: Xác thực khối tiêu đề tệp MIDI không thành công.",midi_custom_events_error:"Lỗi: MIDI event tùy chỉnh không thể đọc được.",midi_no_track_error:"Lỗi: Tệp MIDI không có track nào hợp lệ",not_after_effects_error:"Lỗi: Vui lòng sử dụng script tại Adobe After Effects.",cannot_create_file_error:"Lỗi: Không thể tạo tệp",cannot_find_composition_error:"Lỗi: Không thể tìm được một composition còn hoạt động. Vui lòng kích hoạt composition trước .\n\nGiải pháp: Mở một composition trước, sau đó click vào composite preview hoặc track window để khiến nó hoạt động.",no_midi_error:"Lỗi: Vui lòng mở một tệp MIDI hợp lệ trước.",no_options_checked_error:"Lỗi: Vui lòng chọn ít nhất 1 tùy chọn.",no_layer_selected_error:"Lỗi: Không có layer nào được chọn trong composition hiện tại.",not_one_track_for_apply_effects_only_error:"Lỗi: Áp dụng hiệu ứng chỉ có thể chọn một track MIDI cùng một lúc.",end_of_track_position_error:"Lỗi: Track kết thúc ở sai vị trí. Dự kiến ​​1%, thực tế 2%.",cannot_set_time_remap_error:"Lỗi: Sắp xếp lại thời gian không thể đặt cho layer được chọn.",cannot_tuning_error:"Lỗi: Layer đã chọn không chứa âm thanh nên không thể tune được.",about:"Nó đọc một tệp trình tự MIDI tiêu chuẩn và tạo các layer cũng như khung hình chính tương ứng với các nốt và bộ điều khiển trong tệp trình tự MIDI đó.\n\nPhiên bản: %4\nỨng dụng: %2\nCông cụ xác định: %3\n\nTác giả gốc: David Van Brink (omino), Dora (NGDXW), Gia Miết Thái Đâ\nTác giả: Lan Âm\nLink lưu trữ: %1",horizontal_mirror:"Lật ngang kiểu gương",advanced_scale:"Tỉ lệ nâng cao",loading_midi:"Đang tải %1 ...",unsupported_fps_time_division_error:"Lỗi: Chế độ hiện tại không hỗ trợ định dạng dữ liệu phân chia khung hình trên giây.",low_version_error:"Lỗi: Phiên bản After Effects sử dụng hiện tại quá thấp, vui lòng cập nhật.",map_velocity:"Mapping Velocity",map_velocity_to_opacity:"Mapping Velocity tới Độ mờ",map_velocity_to_volume:"Mapping Velocity tới Âm lượng",opacity:"Độ mờ",audio_levels:"Audio level",notes_velocity:"Nốt velocity",has_no_video_error:"Lỗi: Layet đã chọn không chứa video nên không thể áp dụng hiệu ứng đã chọn.",motion_for_horizontal_flip:"Motion cho hiệu ứng lật ngang　",motion_entrance:"Vào",motion_exit:"Ra",motion_float_left:"Nổi trái",motion_float_right:"Nổi phải",motion_float_up:"Nổi lên",motion_float_down:"Nổi xuống",script_translator:"Phiên bản Việt hoá thực hiện bởi: "};var d={};for(var m in h)if(i(h,m))d[m]={zh:h[m],en:p[m],ja:_[m],vi:f[m]};var v="...";var g="~";var y=13;var T=function(){function t(t,e){var i=this;if(void 0===e)e={};this.scrollY=0;this.resizeTimes=0;this.parent=t;this.panel=n(t,"group",{orientation:"stack",alignment:["fill","fill"],spacing:0});this.content=n(this.panel,"group",c({orientation:"column",alignment:["fill","top"],alignChildren:"fill"},e));this.children=this.content.children;this.margins=e.margins;this.scrollbar=n(this.panel,"scrollbar",{alignment:"right"});this.scrollbar.onChanging=function(){return i.onScroll()}}t.prototype.add=function(t,e,i){return n(this.content,t,e,i)};t.prototype.onResize=function(){var t=this.getContentPadding(),e=t[0],i=t[1];var r=this.parent.bounds;this.panel.bounds=c(c({},r),{x:0,y:0});var n=false;var o=this.getViewHeight();if(o.viewHeight>=o.height){this.scrollY=i;n=true}else if(o.viewHeight>o.height+this.scrollY)this.scrollY=o.viewHeight-o.height;if(this.resizeTimes>2)this.content.alignment=["left","top"];this.content.bounds={x:e,y:this.scrollY,width:r.width-y*+!n-e,height:this.getContentHeight()};this.scrollbar.bounds={x:n?r.width:r.width-y,y:0,width:y,height:r.height};this.scrollbar.value=(this.scrollY-i)/-o.y*(this.scrollbar.maxvalue-this.scrollbar.minvalue)+this.scrollbar.minvalue;this.resizeTimes++};t.prototype.getContentHeight=function(){var t=this.content.margins[1];var e=t;for(var i=0,r=this.content.children;i<r.length;i++){var n=r[i];e+=n.size.height+this.content.spacing}return e};t.prototype.onScroll=function(){var t=this.getViewHeight().y;if(t<=0)return;var e=this.getContentPadding()[1];var i=(this.scrollbar.value-this.scrollbar.minvalue)/(this.scrollbar.maxvalue-this.scrollbar.minvalue);this.content.location.y=this.scrollY=-t*i+e};t.prototype.getViewHeight=function(){var t=this.content.size.height;var e=this.panel.size.height;var i=t-e;return{height:t,viewHeight:e,y:i}};t.test=function(){var e=new Window("window","Scroll Test",void 0,{resizeable:true});var i=n(e,"group",{alignment:["fill","fill"]});var r=new t(i);var o=20;for(var a=1;a<=o;a++)r.add("checkbox",{text:"Item "+a});e.onShow=e.onResizing=e.onResize=function(){e.layout.resize();r.onResize()};e.center();e.show()};t.prototype.getContentPadding=function(){if(this.margins instanceof Array)return[this.margins[0],this.margins[1]];else if("number"===typeof this.margins)return[this.margins,this.margins];else return[0,0]};return t}();var E=2;var O={spacing:E,margins:[7,5,0,0]};var R={orientation:"column",alignment:["fill","top"],alignChildren:"fill",spacing:E,margins:[10,5,10,0]};var L=function(){function t(t,e,i,r){this.parent=t;this.tab=n(this.parent.tabs,"tab",{text:i});null!==r&&void 0!==r?r:r=e?O:R;this.group=e?new T(this.tab,r):n(this.tab,"group",r)}t.prototype.getCheckedChecks=function(){var t=[];var e=this.group instanceof Group?this.group.children:this.group.content.children;for(var i=0,r=e;i<r.length;i++){var n=r[i];if(n instanceof Checkbox&&n.value)t.push(n)}return t};t.prototype.addCheckbox=function(t){var e={text:t,alignment:["fill","fill"]};var i=this.group instanceof T?this.group.add("checkbox",e):n(this.group,"checkbox",e);return i};return t}();var S=function(t){s(e,t);function e(e){var i=t.call(this,e,true)||this;i.pitch=i.addCheckbox();i.velocity=i.addCheckbox();i.duration=i.addCheckbox();i.scale=i.addCheckbox();i.advancedScale=i.addCheckbox();i.cwRotation=i.addCheckbox();i.ccwRotation=i.addCheckbox();i.count=i.addCheckbox();i.bool=i.addCheckbox();i.timeRemap=i.addCheckbox();i.pingpong=i.addCheckbox();i.noteOn=i.addCheckbox();i.pan=i.addCheckbox();i.volume=i.addCheckbox();i.glide=i.addCheckbox();return i}e.prototype.translate=function(){this.tab.text=localize(d.create_null_object_short);this.pitch.text=localize(d.pitch);this.velocity.text=localize(d.velocity);this.duration.text=localize(d.duration);this.scale.text=localize(d.scale);this.advancedScale.text=localize(d.advanced_scale);this.cwRotation.text=localize(d.cw_rotation);this.ccwRotation.text=localize(d.ccw_ratation);this.count.text=localize(d.count);this.bool.text=localize(d.bool);this.timeRemap.text=localize(d.time_remap);this.pingpong.text=localize(d.pingpong);this.noteOn.text=localize(d.note_on);this.pan.text=localize(d.channel_pan);this.volume.text=localize(d.channel_volume);this.glide.text=localize(d.channel_glide)};return e}(L);var b;(function(t){var e=function(){function t(t){this.velocityLess=0;this.velocityMore=127;this.targetLess=-192;this.targetMore=0;if(t)r(this,t)}return t}();t.MappingVelocity=e})(b||(b={}));var C=b;var N=function(t){s(e,t);function e(i){var r=this.constructor;var n=this;if("string"===typeof i||!(i instanceof e))alert(i.toString(),localize(d.error),true);n=t.call(this,i.toString())||this;n.isMyError=true;n.__proto__=r.prototype;return n}return e}(Error);var k=function(t){s(e,t);function e(){return t.call(this,localize(d.cannot_find_window_error))||this}return e}(N);var I=function(t){s(e,t);function e(){return t.call(this,localize(d.unsupported_setting_type_error))||this}return e}(N);var w=function(t){s(e,t);function e(){return t.call(this,localize(d.file_unreadable_error))||this}return e}(N);var A=function(t){s(e,t);function e(){return t.call(this,localize(d.midi_header_validation_error))||this}return e}(N);var D=function(t){s(e,t);function e(){return t.call(this,localize(d.midi_track_header_validation_error))||this}return e}(N);var M=function(t){s(e,t);function e(){return t.call(this,localize(d.midi_custom_events_error))||this}return e}(N);var x=function(t){s(e,t);function e(){return t.call(this,localize(d.midi_no_track_error))||this}return e}(N);var P=function(t){s(e,t);function e(){return t.call(this,localize(d.not_after_effects_error))||this}return e}(N);var B=function(t){s(e,t);function e(){return t.call(this,localize(d.cannot_create_file_error))||this}return e}(N);var F=function(t){s(e,t);function e(){return t.call(this,localize(d.cannot_find_composition_error))||this}return e}(N);var z=function(t){s(e,t);function e(){return t.call(this,localize(d.no_midi_error))||this}return e}(N);var K=function(t){s(e,t);function e(){return t.call(this,localize(d.no_options_checked_error))||this}return e}(N);var G=function(t){s(e,t);function e(){return t.call(this,localize(d.no_layer_selected_error))||this}return e}(N);var U=function(t){s(e,t);function e(){return t.call(this,localize(d.not_one_track_for_apply_effects_only_error))||this}return e}(N);var V=function(t){s(e,t);function e(e,i){return t.call(this,localize(d.end_of_track_position_error,e,i))||this}return e}(N);var H=function(t){s(e,t);function e(){return t.call(this,localize(d.cannot_set_time_remap_error))||this}return e}(N);var j=function(t){s(e,t);function e(){return t.call(this,localize(d.cannot_tuning_error))||this}return e}(N);var Y=function(t){s(e,t);function e(){return t.call(this,localize(d.unsupported_fps_time_division_error))||this}return e}(N);var X=function(t){s(e,t);function e(){return t.call(this,localize(d.low_version_error))||this}return e}(N);var q=function(t){s(e,t);function e(){return t.call(this,localize(d.has_no_video_error))||this}return e}(N);function Q(t,e,i){t.onChange=function(){var r=t.text;var n=/\d+/g;if("decimal"===e.type){n=/-?\d+(\.\d+)?/g;if(void 0!==e.min&&e.min>=0)n=/\d+(\.\d+)?/g}var o=r.match(n);if(o){r=o[0].replace(/^0+(?!\.)/g,"");r||(r="0");var a="int"===e.type?parseInt(r,10):parseFloat(r);if(isNaN(a))a=null!==i&&void 0!==i?i:0;if(void 0!==e.max&&a>e.max)a=null!==i&&void 0!==i?i:e.max;if(void 0!==e.min&&a<e.min)a=null!==i&&void 0!==i?i:e.min;r=String(a)}else r=String(i);t.text=r}}var W=function(){function t(t,e,i){var r,o;var a=this;this.dialogResult=false;this.window=new Window("dialog",localize(d.map_velocity),void 0,{resizeable:false});if(null===this.window)throw new k;this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"});r=this.addRow(d.notes_velocity),this.velocityLessTxt=r[0],this.velocityMoreTxt=r[1];o=this.addRow(t),this.targetLessTxt=o[0],this.targetMoreTxt=o[1];this.buttonGroup=n(this.group,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]});this.okBtn=n(this.buttonGroup,"button",{text:localize(d.ok)});this.cancelBtn=n(this.buttonGroup,"button",{text:localize(d.cancel)});this.window.defaultElement=this.okBtn;this.window.cancelElement=this.cancelBtn;this.okBtn.onClick=function(){a.dialogResult=true;a.window.close()};if(i){this.velocityLessTxt.text=String(i.velocityLess);this.velocityMoreTxt.text=String(i.velocityMore);this.targetLessTxt.text=String(i.targetLess);this.targetMoreTxt.text=String(i.targetMore)}[this.velocityLessTxt,this.velocityMoreTxt].forEach((function(t){return Q(t,{type:"int",min:0,max:127})}));[this.targetLessTxt,this.targetMoreTxt].forEach((function(t){return Q(t,{type:"decimal",min:e[0],max:e[1]})}))}t.prototype.showDialog=function(){this.window.center();this.window.show();if(!this.dialogResult)return;var t=new C.MappingVelocity({velocityLess:parseFloat(this.velocityLessTxt.text),velocityMore:parseFloat(this.velocityMoreTxt.text),targetLess:parseFloat(this.targetLessTxt.text),targetMore:parseFloat(this.targetMoreTxt.text)});return t};t.prototype.addRow=function(t){var e=6;var i=a(this.group,localize(t),"group",{orientation:"row",alignment:["right","center"]}).control;var r=n(i,"edittext",{characters:e});n(i,"statictext",{text:"~"});var o=n(i,"edittext",{characters:e});return[r,o]};return t}();function Z(t,e,i){return Math.max(t,Math.min(i,e))}function J(t,e,i,r,n){return(n-r)*(t-e)/(i-e)+r}var tt=function(){function t(t,e,i,r,o){var a=this;this.value=false;this.parent=t;this.targetRange=i;this.mapping=new C.MappingVelocity({targetLess:r[0],targetMore:r[1]});this.group=n(t,"group",{orientation:"row"});this.checkbox=n(this.group,"checkbox",{text:o});this.advanceBtn=n(this.group,"button",{text:"...",size:[he,18]});this.checkbox.onClick=function(){return a.value=a.checkbox.value};this.advanceBtn.onClick=function(){var t=new W(e,i,a.mapping).showDialog();if(t)a.mapping=t}}t.prototype.setEnabled=function(t){this.checkbox.enabled=this.advanceBtn.enabled=t;if(!t)this.value=this.checkbox.value=false};t.prototype.map=function(t){return Z(this.targetRange[0],J(t,this.mapping.velocityLess,this.mapping.velocityMore,this.mapping.targetLess,this.mapping.targetMore),this.targetRange[1])};return t}();var et=function(t){s(e,t);function e(e){var i;var r=t.call(this,e,true)||this;r.timeRemap=r.addCheckbox();r.timeRemap2=r.addCheckbox();r.pingpong=r.addCheckbox();r.hFlip=r.addCheckbox();r.hMirror=r.addCheckbox();r.cwRotation=r.addCheckbox();r.ccwRotation=r.addCheckbox();r.negative=r.addCheckbox();r.mapVelToOpacity=new tt(r.group.content,d.opacity,[0,100],[0,100]);r.tuning=r.addCheckbox();i=a(r.group.content,"","dropdownlist"),r.basePitchGroup=i.group,r.basePitchLbl=i.label,r.basePitchKeyCombo=i.control;r.basePitchOctCombo=n(r.basePitchGroup,"dropdownlist");o.apply(void 0,u([r.basePitchKeyCombo],"C,C#,D,D#,E,F,F#,G,G#,A,A#,B".split(",")));o.apply(void 0,u([r.basePitchOctCombo],"0,1,2,3,4,5,6,7,8,9,10".split(",")));r.basePitchOctCombo.selection=5;r.basePitchGroup.enabled=false;r.mapVelToVolume=new tt(r.group.content,d.audio_levels,[-192,12],[-40,0]);r.mapVelToVolume.group.margins=[0,7,10,0];r.cwRotation.onClick=function(){return r.ccwRotation.value=false};r.ccwRotation.onClick=function(){return r.cwRotation.value=false};r.timeRemap.onClick=function(){return r.timeRemap2.value=r.pingpong.value=false};r.timeRemap2.onClick=function(){return r.timeRemap.value=r.pingpong.value=false};r.pingpong.onClick=function(){return r.timeRemap.value=r.timeRemap2.value=false};r.tuning.onClick=function(){r.basePitchGroup.enabled=r.tuning.value;r.mapVelToVolume.setEnabled(r.tuning.value)};r.mapVelToVolume.setEnabled(false);return r}e.prototype.translate=function(){this.tab.text=localize(d.apply_effects_short);this.basePitchLbl.text=localize(d.base_pitch);this.timeRemap.text=localize(d.time_remap)+localize(d.paren_stretched);this.timeRemap2.text=localize(d.time_remap)+localize(d.paren_truncated);this.pingpong.text=localize(d.pingpong);this.hFlip.text=localize(d.horizontal_flip);this.hMirror.text=localize(d.horizontal_mirror);this.cwRotation.text=localize(d.cw_rotation);this.ccwRotation.text=localize(d.ccw_ratation);this.negative.text=localize(d.invert_color);this.tuning.text=localize(d.tuning);this.mapVelToOpacity.checkbox.text=localize(d.map_velocity_to_opacity);this.mapVelToVolume.checkbox.text=localize(d.map_velocity_to_volume)};e.prototype._getCheckedChecks=function(){var t=this.getCheckedChecks();if(this.mapVelToOpacity.value)t.push(this.mapVelToOpacity);if(this.tuning.value&&this.mapVelToVolume.value)t.push(this.mapVelToVolume);return t};return e}(L);var it=function(){function t(t){this.parent=t;this.group=n(this.parent.toolsPanel,"group",{orientation:"column",alignment:["fill","fill"],alignChildren:"fill",spacing:E})}return t}();var rt=function(t){s(e,t);function e(e){var i,r,n,o;var l=t.call(this,e)||this;var s=["fill","center"];i=a(l.group,"","dropdownlist",{alignment:s}),l.unitGroup=i.group,l.unitLbl=i.label,l.unitCombo=i.control;r=a(l.group,"BPM","edittext",{text:"120",alignment:s}),l.bpmGroup=r.group,l.bpmLbl=r.label,l.bpmTxt=r.control;n=a(l.group,"","edittext",{text:"4",alignment:s}),l.beatGroup=n.group,l.beatLbl=n.label,l.beatTxt=n.control;o=a(l.group,"","dropdownlist",{alignment:s}),l.markOnGroup=o.group,l.markOnLbl=o.label,l.markOnCombo=o.control;l.translate();Q(l.bpmTxt,{type:"decimal",min:1},120);l.unitCombo.onChange=function(){var t=l.unitCombo.getSelectedIndex();l.beatLbl.text=0===t?localize(d.beat):localize(d.shift_seconds_and_frames);if(0===t)l.bpmLbl.text="BPM";else if(1===t)l.bpmLbl.text=localize(d.seconds);else l.bpmLbl.text=localize(d.frames);Q(l.beatTxt,0===t?{type:"int",min:1}:{type:"decimal"},4);l.beatTxt.notify("onChange")};l.unitCombo.notify("onChange");return l}e.prototype.translate=function(){this.unitLbl.text=localize(d.unit);this.markOnLbl.text=localize(d.mark_on);o(this.unitCombo,"BPM",localize(d.time),localize(d.frames));o(this.markOnCombo,localize(d.add_null_layer),localize(d.current_layer))};return e}(it);var nt=function(){function t(t,e){this.control=t.add("panel");this.control.alignment="horizontal"===e?["fill","top"]:["center","fill"]}return t}();var ot;(function(t){t[t["EASE_IN"]=0]="EASE_IN";t[t["EASE_OUT"]=1]="EASE_OUT";t[t["EASE_IN_OUT"]=2]="EASE_IN_OUT"})(ot||(ot={}));var at=ot;var lt=function(t){s(e,t);function e(e){var i=t.call(this,e)||this;i.easeInRadio=n(i.group,"radiobutton",{value:true});i.easeOutRadio=n(i.group,"radiobutton");i.easeInOutRadio=n(i.group,"radiobutton");i.translate();return i}e.prototype.getValue=function(){if(this.easeInOutRadio.value)return at.EASE_IN_OUT;else if(this.easeOutRadio.value)return at.EASE_OUT;else return at.EASE_IN};e.prototype.translate=function(){this.easeInRadio.text=localize(d.ease_in);this.easeOutRadio.text=localize(d.ease_out);this.easeInOutRadio.text=localize(d.ease_in_out)};return e}(it);var st="om_midi";var ct={get:function(t,e){if(!app.settings.haveSetting(st,t))return e;else{var i=app.settings.getSetting(st,t);var r=void 0;if("string"===typeof e)r=i;else if("number"===typeof e)r=Number(i);else if("boolean"===typeof e)r="0"!==i;else throw new I;return r}},set:function(t,e){var i=e;if("boolean"===typeof e)i=i?"1":"0";app.settings.saveSetting(st,t,i.toString())},has:function(t){return app.settings.haveSetting(st,t)}};var ut={Language:0,UsingSelectedLayerName:false,UsingLayering:false,OptimizeApplyEffects:true,NormalizePanTo100:true,AddToEffectTransform:false,ApplyEffectsStartTime:1,NullObjectStartTime:0,LastTool:0,MotionForHorizontalFlip:0};var pt={};var _t=function(t){if(i(ut,t)){pt["get"+t]=function(e){if(void 0===e)e=ut[t];return ct.get(t,e)};pt["set"+t]=function(e){return ct.set(t,e)}}};for(var ht in ut)_t(ht);var ft=function(t){s(e,t);function e(e){var i=t.call(this,e,false,void 0,{orientation:"column",alignment:"fill",alignChildren:"fill",margins:[10,5,0,0]})||this;i.toolsCombo=n(i.group,"dropdownlist");i.toolsCombo.selection=pt.getLastTool();i.separator=new nt(i.group,"horizontal");i.toolsPanel=n(i.group,"group",{orientation:"stack",alignment:"fill",alignChildren:"fill"});i.marker=new rt(i);i.ease=new lt(i);i.toolsCombo.onChange=function(){var t=i.toolsCombo.getSelectedIndex();for(var e=0;e<i.toolsPanel.children.length;e++){var r=i.toolsPanel.children[e];r.visible=e===t}pt.setLastTool(i.toolsCombo.getSelectedIndex())};i.toolsCombo.notify("onChange");return i}e.prototype.getSelectedTool=function(){switch(this.toolsCombo.getSelectedIndex()){case 0:return this.marker;case 1:return this.ease;default:return null}};e.prototype.translate=function(){this.tab.text=localize(d.tools);o(this.toolsCombo,localize(d.marker_conductor),localize(d.easing_100_percent));this.marker.translate();this.ease.translate()};return e}(L);var dt=function(t){s(e,t);function e(e){return t.call(this,Folder.temp.fsName+"/"+(new Date).valueOf()+"_"+e)||this}return e}(File);function mt(t){var e;if(-1!==$.os.indexOf("Win"))e="explorer.exe "+t;else e="open "+t;try{system.callSystem(e)}catch(t){throw new N(t)}}var vt=function(){function t(){this.window=new Window("dialog",localize(d.add_at_top_of_expression),void 0,{resizeable:false});if(null===this.window)throw new k;this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"});n(this.group,"statictext",{text:localize(d.om_utils_same_as_project_directory)});n(this.group,"edittext",{text:'$.evalFile(thisProject.fullPath.replace(/\\\\[^\\\\]*$/, "/om_utils.jsx"));'},{readonly:true});n(this.group,"statictext",{text:localize(d.om_utils_added_to_project)});n(this.group,"edittext",{text:'footage("om_utils.jsx").sourceData;'},{readonly:true});this.okBtn=n(this.group,"button",{text:localize(d.ok),alignment:"right"});this.window.defaultElement=this.okBtn}t.prototype.showDialog=function(){this.window.center();this.window.show()};return t}();function gt(t){if("string"===typeof t)t=[t];if(0===t.length)return[];var e=new dt("tmp.txt");var i;if(e&&e.open("w")){i=e.encoding;e.encoding="binary";for(var r=0,n=t;r<n.length;r++){var o=n[r];e.writeln(o)}e.close()}else throw new B;var a=[];if(e&&e.open("r")){e.encoding=i;while(!e.eof)a.push(e.readln());e.close();e.remove()}else throw new B;return a}var yt=function(){function t(t,e,i){this.secondsPerQuarter=t;this.startTick=e;this.startSecond=i}t.prototype.toString=function(){return this.startSecond.toFixed(2)+"s,"+(60/this.secondsPerQuarter).toFixed(2)+"bpm,"+this.startTick+"t"};return t}();var Tt;(function(t){t[t["SINGLE_TRACK"]=0]="SINGLE_TRACK";t[t["SYNC_MULTI_TRACK"]=1]="SYNC_MULTI_TRACK";t[t["ASYNC_MULTI_TRACK"]=2]="ASYNC_MULTI_TRACK"})(Tt||(Tt={}));var Et;(function(t){t[t["END_OF_TRACK"]=47]="END_OF_TRACK";t[t["END_OF_FILE"]=-1]="END_OF_FILE";t[t["TEXT_EVENT"]=1]="TEXT_EVENT";t[t["COPYRIGHT_NOTICE"]=2]="COPYRIGHT_NOTICE";t[t["TRACK_NAME"]=3]="TRACK_NAME";t[t["INSTRUMENT_NAME"]=4]="INSTRUMENT_NAME";t[t["LYRICS"]=5]="LYRICS";t[t["MARKER"]=6]="MARKER";t[t["CUE_POINT"]=7]="CUE_POINT";t[t["MIDI_PORT"]=33]="MIDI_PORT";t[t["MIDI_PORT_2"]=32]="MIDI_PORT_2";t[t["SET_TEMPO"]=81]="SET_TEMPO";t[t["KEY_SIGNATURE"]=89]="KEY_SIGNATURE";t[t["SMPTE_OFFSET"]=84]="SMPTE_OFFSET";t[t["TIME_SIGNATURE"]=88]="TIME_SIGNATURE";t[t["SEQUENCER_SPECIFIC"]=127]="SEQUENCER_SPECIFIC"})(Et||(Et={}));var Ot;(function(t){t[t["SYSTEM_EXCLUSIVE_EVENTS"]=15]="SYSTEM_EXCLUSIVE_EVENTS";t[t["NOTE_AFTERTOUCH"]=10]="NOTE_AFTERTOUCH";t[t["CONTROLLER"]=11]="CONTROLLER";t[t["PITCH_BEND_EVENT"]=14]="PITCH_BEND_EVENT";t[t["NOTE_OFF"]=8]="NOTE_OFF";t[t["NOTE_ON"]=9]="NOTE_ON";t[t["PROGRAM_CHANGE"]=12]="PROGRAM_CHANGE";t[t["CHANNEL_AFTERTOUCH"]=13]="CHANNEL_AFTERTOUCH";t[t["END_OF_FILE"]=-1]="END_OF_FILE"})(Ot||(Ot={}));var Rt;(function(t){t[t["BANK_SELECT"]=0]="BANK_SELECT";t[t["MODULATION"]=1]="MODULATION";t[t["BREATH_CONTROLLER"]=2]="BREATH_CONTROLLER";t[t["FOOT_CONTROLLER"]=4]="FOOT_CONTROLLER";t[t["PORTAMENTO_TIME"]=5]="PORTAMENTO_TIME";t[t["DATA_ENTRY"]=6]="DATA_ENTRY";t[t["MAIN_VOLUME"]=7]="MAIN_VOLUME";t[t["BALANCE"]=8]="BALANCE";t[t["PAN"]=10]="PAN";t[t["EXPRESSION_CONTROLLER"]=11]="EXPRESSION_CONTROLLER";t[t["EFFECT_CONTROL_1"]=12]="EFFECT_CONTROL_1";t[t["EFFECT_CONTROL_2"]=13]="EFFECT_CONTROL_2";t[t["GENERAL_PURPOSE_CONTROLLERS_1"]=16]="GENERAL_PURPOSE_CONTROLLERS_1";t[t["GENERAL_PURPOSE_CONTROLLERS_2"]=17]="GENERAL_PURPOSE_CONTROLLERS_2";t[t["GENERAL_PURPOSE_CONTROLLERS_3"]=18]="GENERAL_PURPOSE_CONTROLLERS_3";t[t["GENERAL_PURPOSE_CONTROLLERS_4"]=19]="GENERAL_PURPOSE_CONTROLLERS_4";t[t["LSB_FOR_CONTROLLERS_0"]=32]="LSB_FOR_CONTROLLERS_0";t[t["LSB_FOR_CONTROLLERS_1"]=33]="LSB_FOR_CONTROLLERS_1";t[t["LSB_FOR_CONTROLLERS_2"]=34]="LSB_FOR_CONTROLLERS_2";t[t["LSB_FOR_CONTROLLERS_3"]=35]="LSB_FOR_CONTROLLERS_3";t[t["LSB_FOR_CONTROLLERS_4"]=36]="LSB_FOR_CONTROLLERS_4";t[t["LSB_FOR_CONTROLLERS_5"]=37]="LSB_FOR_CONTROLLERS_5";t[t["LSB_FOR_CONTROLLERS_6"]=38]="LSB_FOR_CONTROLLERS_6";t[t["LSB_FOR_CONTROLLERS_7"]=39]="LSB_FOR_CONTROLLERS_7";t[t["LSB_FOR_CONTROLLERS_8"]=40]="LSB_FOR_CONTROLLERS_8";t[t["LSB_FOR_CONTROLLERS_9"]=41]="LSB_FOR_CONTROLLERS_9";t[t["LSB_FOR_CONTROLLERS_10"]=42]="LSB_FOR_CONTROLLERS_10";t[t["LSB_FOR_CONTROLLERS_11"]=43]="LSB_FOR_CONTROLLERS_11";t[t["LSB_FOR_CONTROLLERS_12"]=44]="LSB_FOR_CONTROLLERS_12";t[t["LSB_FOR_CONTROLLERS_13"]=45]="LSB_FOR_CONTROLLERS_13";t[t["LSB_FOR_CONTROLLERS_14"]=46]="LSB_FOR_CONTROLLERS_14";t[t["LSB_FOR_CONTROLLERS_15"]=47]="LSB_FOR_CONTROLLERS_15";t[t["LSB_FOR_CONTROLLERS_16"]=48]="LSB_FOR_CONTROLLERS_16";t[t["LSB_FOR_CONTROLLERS_17"]=49]="LSB_FOR_CONTROLLERS_17";t[t["LSB_FOR_CONTROLLERS_18"]=50]="LSB_FOR_CONTROLLERS_18";t[t["LSB_FOR_CONTROLLERS_19"]=51]="LSB_FOR_CONTROLLERS_19";t[t["LSB_FOR_CONTROLLERS_20"]=52]="LSB_FOR_CONTROLLERS_20";t[t["LSB_FOR_CONTROLLERS_21"]=53]="LSB_FOR_CONTROLLERS_21";t[t["LSB_FOR_CONTROLLERS_22"]=54]="LSB_FOR_CONTROLLERS_22";t[t["LSB_FOR_CONTROLLERS_23"]=55]="LSB_FOR_CONTROLLERS_23";t[t["LSB_FOR_CONTROLLERS_24"]=56]="LSB_FOR_CONTROLLERS_24";t[t["LSB_FOR_CONTROLLERS_25"]=57]="LSB_FOR_CONTROLLERS_25";t[t["LSB_FOR_CONTROLLERS_26"]=58]="LSB_FOR_CONTROLLERS_26";t[t["LSB_FOR_CONTROLLERS_27"]=59]="LSB_FOR_CONTROLLERS_27";t[t["LSB_FOR_CONTROLLERS_28"]=60]="LSB_FOR_CONTROLLERS_28";t[t["LSB_FOR_CONTROLLERS_29"]=61]="LSB_FOR_CONTROLLERS_29";t[t["LSB_FOR_CONTROLLERS_30"]=62]="LSB_FOR_CONTROLLERS_30";t[t["LSB_FOR_CONTROLLERS_31"]=63]="LSB_FOR_CONTROLLERS_31";t[t["DAMPER_PEDAL"]=64]="DAMPER_PEDAL";t[t["PORTAMENTO"]=65]="PORTAMENTO";t[t["SOSTENUTO"]=66]="SOSTENUTO";t[t["SOFT_PEDAL"]=67]="SOFT_PEDAL";t[t["LEGATO_FOOTSWITCH"]=68]="LEGATO_FOOTSWITCH";t[t["HOLD_2"]=69]="HOLD_2";t[t["SOUND_CONTROLLER_1"]=70]="SOUND_CONTROLLER_1";t[t["SOUND_CONTROLLER_2"]=71]="SOUND_CONTROLLER_2";t[t["SOUND_CONTROLLER_3"]=72]="SOUND_CONTROLLER_3";t[t["SOUND_CONTROLLER_4"]=73]="SOUND_CONTROLLER_4";t[t["SOUND_CONTROLLER_5"]=74]="SOUND_CONTROLLER_5";t[t["SOUND_CONTROLLER_6"]=75]="SOUND_CONTROLLER_6";t[t["SOUND_CONTROLLER_7"]=76]="SOUND_CONTROLLER_7";t[t["SOUND_CONTROLLER_8"]=77]="SOUND_CONTROLLER_8";t[t["SOUND_CONTROLLER_9"]=78]="SOUND_CONTROLLER_9";t[t["SOUND_CONTROLLER_10"]=79]="SOUND_CONTROLLER_10";t[t["GENERAL_PURPOSE_CONTROLLERS_5"]=80]="GENERAL_PURPOSE_CONTROLLERS_5";t[t["GENERAL_PURPOSE_CONTROLLERS_6"]=81]="GENERAL_PURPOSE_CONTROLLERS_6";t[t["GENERAL_PURPOSE_CONTROLLERS_7"]=82]="GENERAL_PURPOSE_CONTROLLERS_7";t[t["GENERAL_PURPOSE_CONTROLLERS_8"]=83]="GENERAL_PURPOSE_CONTROLLERS_8";t[t["PORTAMENTO_CONTROL"]=84]="PORTAMENTO_CONTROL";t[t["EFFECTS_1_DEPTH"]=91]="EFFECTS_1_DEPTH";t[t["EFFECTS_2_DEPTH"]=92]="EFFECTS_2_DEPTH";t[t["EFFECTS_3_DEPTH"]=93]="EFFECTS_3_DEPTH";t[t["EFFECTS_4_DEPTH"]=94]="EFFECTS_4_DEPTH";t[t["EFFECTS_5_DEPTH"]=95]="EFFECTS_5_DEPTH";t[t["DATA_INCREMENT"]=96]="DATA_INCREMENT";t[t["DATA_DECREMENT"]=97]="DATA_DECREMENT";t[t["NON_REGISTERED_PARAMETER_NUMBER_LSB"]=98]="NON_REGISTERED_PARAMETER_NUMBER_LSB";t[t["NON_REGISTERED_PARAMETER_NUMBER_MSB"]=99]="NON_REGISTERED_PARAMETER_NUMBER_MSB";t[t["REGISTERED_PARAMETER_NUMBER_LSB"]=100]="REGISTERED_PARAMETER_NUMBER_LSB";t[t["REGISTERED_PARAMETER_NUMBER_MSB"]=101]="REGISTERED_PARAMETER_NUMBER_MSB";t[t["MODE_MESSAGES_1"]=121]="MODE_MESSAGES_1";t[t["MODE_MESSAGES_2"]=122]="MODE_MESSAGES_2";t[t["MODE_MESSAGES_3"]=123]="MODE_MESSAGES_3";t[t["MODE_MESSAGES_4"]=124]="MODE_MESSAGES_4";t[t["MODE_MESSAGES_5"]=125]="MODE_MESSAGES_5";t[t["MODE_MESSAGES_6"]=126]="MODE_MESSAGES_6";t[t["MODE_MESSAGES_7"]=127]="MODE_MESSAGES_7"})(Rt||(Rt={}));var Lt=function(){function t(){this.deltaTime=0;this.startTick=0}return t}();var St=function(t){s(e,t);function e(e){var i=t.call(this)||this;i.type=0;i.type=e;return i}return e}(Lt);var bt=function(t){s(e,t);function e(e,i){var r=t.call(this,e)||this;r.content=i;return r}return e}(St);var Ct=function(t){s(e,t);function e(e,i){var r=t.call(this,e)||this;r.value=i;return r}return e}(St);var Nt=function(t){s(e,t);function e(e){var i=t.call(this,Et.SET_TEMPO,e)||this;i.tempo=e;return i}return e}(Ct);var kt=function(t){s(e,t);function e(e){var i=t.call(this,Et.SMPTE_OFFSET)||this;i.hour=e[0];i.min=e[1];i.sec=e[2];i.fr=e[3];i.subFr=e[4];return i}return e}(St);var It=function(t){s(e,t);function e(e){var i=t.call(this,Et.TIME_SIGNATURE)||this;i.number=e[0];i.denom=e[1];i.metro=e[2];i.thirtySeconds=e[3];return i}e.prototype.toString=function(){return this.number+"/"+Math.pow(2,this.denom)};return e}(St);var wt=function(t){s(e,t);function e(e,i){var r=t.call(this,e)||this;r.value=i;return r}return e}(St);var At=function(t){s(e,t);function e(e,i,r){var n=t.call(this)||this;n.type=e;n.channel=i;n.values=r;return n}return e}(Lt);var Dt=function(t){s(e,t);function e(e,i,r){var n=t.call(this,e,i,r)||this;n.pitch=r[0];n.velocity=r[1];return n}return e}(At);var Mt=function(t){s(e,t);function e(e,i,r,n,o,a){var l=this;if(i instanceof Array)l=t.call(this,Ot.NOTE_ON,e,i)||this;else{l=t.call(this,Ot.NOTE_ON,e,[i,r])||this;l.deltaTime=n;l.duration=o;l.startTick=a}return l}return e}(Dt);var xt=function(t){s(e,t);function e(e,i){return t.call(this,Ot.NOTE_OFF,e,i)||this}return e}(Dt);var Pt=function(t){s(e,t);function e(e,i){return t.call(this,Ot.SYSTEM_EXCLUSIVE_EVENTS,e,i)||this}return e}(At);var Bt=function(t){s(e,t);function e(e,i){var r=t.call(this,Ot.CONTROLLER,e,i)||this;r.controller=i[0];r.value=i[1];return r}return e}(At);var Ft=function(t){s(e,t);function e(i,r){var n=t.call(this,Ot.PITCH_BEND_EVENT,i,r)||this;n.value=e.take7Bit(r[1])<<7|e.take7Bit(r[0]);return n}e.take7Bit=function(t){return 127&t};return e}(At);var zt=function(t){s(e,t);function e(e,i){var n=t.call(this,e.channel,e.values)||this;r(n,e);n.startSecond=i;return n}return e}(Mt);var Kt=function(t){s(e,t);function e(e,i){var n=t.call(this)||this;r(n,e);n.startSecond=i;return n}return e}(Lt);var Gt=function(){function t(t){this.datas=[];this.tempoTrack=t;var e=t.midi();if(!e.isTpbTimeDivision())throw new Y;this.ticksPerQuarter=e.timeDivision;this.initData()}t.prototype.initData=function(){for(var t=0,e=this.tempoTrack;t<e.length;t++){var i=e[t];if(i instanceof Nt){var r=i.startTick;if(0===this.datas.length&&0!==r)r=0;var n=0;var o=this.getLastData();var a=i.tempo/1e6;if(o){if(a===o.secondsPerQuarter)continue;else if(r===o.startTick){o.secondsPerQuarter=a;continue}n=(r-o.startTick)/this.ticksPerQuarter*o.secondsPerQuarter+o.startSecond}this.datas.push(new yt(a,r,n))}}write(this.datas.length)};t.prototype.getLastData=function(){return this.datas[this.datas.length-1]};t.prototype.getSecond=function(t){var e=this.getActualSecond(t.startTick);if(t instanceof Mt){var i=new zt(t,e);if(t.duration)i.durationSecond=this.getActualSecond(t.startTick+t.duration)-e;if(t.interruptDuration)i.interruptDurationSecond=this.getActualSecond(t.startTick+t.interruptDuration)-e;return i}else{var i=new Kt(t,e);return i}};t.prototype.getActualSecond=function(t){for(var e=0;e<this.datas.length;e++){var i=this.datas[e],r=this.datas[e+1];if(void 0!==r&&t>r.startTick)continue;var n=(t-i.startTick)*i.secondsPerQuarter/this.ticksPerQuarter;return i.startSecond+n}alert("No Bpm Keys!");return t};return t}();var Ut=function(){function t(){}return t}();var Vt=function(t){s(e,t);function e(e){var i=t.call(this)||this;i.file=e;return i}e.prototype.getPointer=function(){return this.file.tell()};e.prototype.length=function(){return this.file.length};e.prototype.readByte=function(t){if(void 0===t)t=1;var e=this.file.read(t);var i=0;for(var r=0;r<e.length;r++){i<<=8;i+=e.charCodeAt(r)}return i};e.prototype.readString=function(t){return this.file.read(t)};e.prototype.readByteArray=function(t){var e=this.file.read(t);var i=[];for(var r=0;r<e.length;r++)i.push(e.charCodeAt(r));return i};e.prototype.readDeltaTime=function(){var t=0;var e=false;while(!(this.isReadOver()||e)){t<<=7;var i=this.file.read(1).charCodeAt(0);if(!(128&i))e=true;t+=127&i}return t};e.prototype.isReadOver=function(){return this.file.eof};e.prototype.movePointer=function(t){this.file.seek(t,1)};e.prototype.setPointer=function(t){if(t<0||t>=this.length())return false;return this.file.seek(t,0)};return e}(Ut);var Ht=function(t){s(e,t);function e(e,i,r){var n=this.constructor;var o=t.call(this)||this;o.noteCount=0;o.lengthTick=0;o.__proto__=n.prototype;o.parent=e;o.offset=i;o.size=r;o.readNotes();return o}e.prototype.setName=function(t){var e;null!==(e=this.name)&&void 0!==e?e:this.name=t};e.prototype.setInstrument=function(t){var e;null!==(e=this.instrument)&&void 0!==e?e:this.instrument=t};e.prototype.setChannel=function(t){var e;null!==(e=this.channel)&&void 0!==e?e:this.channel=t};e.prototype.setTempo=function(t){var e,i,r;null!==(e=this.tempo)&&void 0!==e?e:this.tempo=t;var n=this.midi(),o=this.bpm();null!==(i=n.bpm)&&void 0!==i?i:n.bpm=o;null!==(r=n.tempoTrack)&&void 0!==r?r:n.tempoTrack=this;if(this.tempo!==t)n.isDynamicBpm=true};e.prototype.bpm=function(){if(void 0===this.tempo)return;var t=6e7/this.tempo;return parseFloat(t.toFixed(3))};e.prototype.readNotes=function(){var t=this.offset+this.size;var e=[];var i;while(!(this.parent.isReadOver()||this.parent.getPointer()>=t)){var r=this.parent.readDeltaTime();var n=this.lengthTick+=r;var o=i;i=this.parent.readByte(1);if(-1===i)break;else if(!(128&i)){i=o;this.parent.movePointer(-1)}var a=null;if(255===i){var l=this.parent.readByte(1);var s=this.parent.readDeltaTime();switch(l){case Et.END_OF_TRACK:if(this.parent.getPointer()!==t)new V(t,this.parent.getPointer());case Et.END_OF_FILE:return;case Et.TEXT_EVENT:case Et.COPYRIGHT_NOTICE:case Et.TRACK_NAME:case Et.INSTRUMENT_NAME:case Et.LYRICS:case Et.MARKER:case Et.CUE_POINT:var c=this.parent.readString(s);a=new bt(l,c);if(l===Et.TRACK_NAME)this.setName(c);else if(l===Et.INSTRUMENT_NAME)this.setInstrument(c);break;case Et.MIDI_PORT:case Et.MIDI_PORT_2:case Et.KEY_SIGNATURE:case Et.SET_TEMPO:var u=this.parent.readByte(s);if(l===Et.SET_TEMPO){a=new Nt(u);this.setTempo(u)}else a=new Ct(l,u);break;case Et.SMPTE_OFFSET:var p=this.parent.readByteArray(s);a=new kt(p);break;case Et.TIME_SIGNATURE:var _=this.parent.readByteArray(s);a=new It(_);break;default:var h=this.parent.readByteArray(s);a=new wt(l,h);break}}else{var f=(15&i)+1;this.setChannel(f);var d=i>>4;switch(d){case Ot.NOTE_AFTERTOUCH:case Ot.CONTROLLER:case Ot.PITCH_BEND_EVENT:case Ot.NOTE_OFF:case Ot.NOTE_ON:var m=this.parent.readByteArray(2);switch(d){case Ot.NOTE_ON:a=new Mt(f,m);var v=a;this.noteCount++;for(var g=0,y=e;g<y.length;g++){var T=y[g];if(void 0===T.interruptDuration)if(n<=T.startTick)v.interruptDuration=0;else T.interruptDuration=n-T.startTick}e.push(v);break;case Ot.NOTE_OFF:a=new xt(f,m);var E=a;for(var O=e.length-1;O>=0;O--){var v=e[O];if(v.pitch===E.pitch){v.duration=n-v.startTick;v.noteOff=E;E.noteOn=v;e.splice(O,1);break}}break;case Ot.CONTROLLER:a=new Bt(f,m);break;case Ot.PITCH_BEND_EVENT:a=new Ft(f,m);break;case Ot.NOTE_AFTERTOUCH:default:a=new At(d,f,m);break}break;case Ot.PROGRAM_CHANGE:case Ot.CHANNEL_AFTERTOUCH:var R=this.parent.readByteArray(1);a=new At(d,f,R);break;case Ot.END_OF_FILE:return;case Ot.SYSTEM_EXCLUSIVE_EVENTS:var L=this.parent.readDeltaTime();a=new Pt(f,this.parent.readByteArray(L));break;default:throw new M}}if(null!==a){a.deltaTime=r;a.startTick=n;this.push(a)}}};e.prototype.toString=function(){var t;var e=localize(d.channel_abbr)+" "+(null!==(t=this.channel)&&void 0!==t?t:0);if(this.name)e+=": "+this.name;e+=" ("+this.noteCount+")";return e};e.prototype.getPointer=function(){return this.parent.getPointer()};e.prototype.midi=function(){return this.parent.midi};return e}(Array);var jt=function(t){s(e,t);function e(e){var i=t.call(this,e.file)||this;i.midi=e;i.readHeader();i.readTracks();return i}e.prototype.readHeader=function(){if(1297377380!==this.readByte(4))throw new A;this.readByte(4);this.midi.formatType=this.readByte(2);this.midi.trackCount=this.readByte(2);var t=this.readByte(1),e=this.readByte(1);if(128&t)this.midi.timeDivision=[127&t,e];else this.midi.timeDivision=(t<<8)+e};e.prototype.readTracks=function(){while(!this.isReadOver()){var t=this.readByte(4);if(-1===t)break;if(1297379947!==t)throw new D;var e=this.readByte(4);var i=new Ht(this,this.getPointer(),e);this.midi.tracks.push(i)}};return e}(Vt);var Yt=function(){function t(t){this.formatType=Tt.SYNC_MULTI_TRACK;this.trackCount=0;this.timeDivision=0;this.tracks=[];this.preferredTrackIndex=0;this.isPureQuarter=false;this.isDynamicBpm=false;if(true===t){this.fileName=localize(d.pure_quarter_midi);this.isPureQuarter=true;this.formatType=Tt.SINGLE_TRACK;this.trackCount=1;this.timeDivision=1;return}this.file=t;this.fileName=t.displayName;if(t&&t.open("r")){t.encoding="binary";this.length=t.length;this.midiReader=new jt(this);t.close();if(this.isDynamicBpm&&this.tempoTrack)this.integrator=new Gt(this.tempoTrack);this.removeNotNoteTrack();this.setPreferredTrack();this.convertTracksNameEncoding()}else throw new w}t.prototype.removeNotNoteTrack=function(){for(var t=this.tracks.length-1;t>=0;t--){var e=this.tracks[t];if(0===e.noteCount)this.tracks.splice(t,1)}};t.prototype.setPreferredTrack=function(){for(var t=0;t<this.tracks.length;t++){var e=this.tracks[t];if(10!==e.channel){this.preferredTrackIndex=t;break}}};t.prototype.convertTracksNameEncoding=function(){var t=[];var e=[];for(var i=0,r=this.tracks;i<r.length;i++){var n=r[i];if(n.name){t.push(n);e.push(n.name)}}if(0===e.length)return;e=gt(e);for(var o=0;o<t.length&&o<e.length;o++){var n=t[o];var a=e[o].trim();if(""===a)a=void 0;n.name=a}};t.prototype.isTpbTimeDivision=function(){return"number"===typeof this.timeDivision};t.prototype.displayBpm=function(){var t=120;if(!this.bpm)return String(t);var e=String(this.bpm);if(this.isDynamicBpm)e+=g;return e};return t}();var Xt=function(){function t(t,e,i){if(void 0===i)i="fill";this.parent=t;this.outerGroup=n(this.parent,"group",{orientation:"column",alignment:i,alignChildren:"fill"});this.columns=e}t.prototype.add=function(t,e,i){var r=this.outerGroup.children;if(0===r.length||r[r.length-1].children.length>=this.columns)this.addRow();r=this.outerGroup.children;var o=r[r.length-1];return n(o,t,e,i)};t.prototype.addRow=function(){n(this.outerGroup,"group",{orientation:"row",alignment:"fill",alignChildren:"left"})};return t}();function qt(t){var e=t.graphics.BrushType.SOLID_COLOR;t.graphics.newBrush(e,[1,1,1,1]);var i=.25*Math.random();var r=t.graphics.newBrush(e,[i,i,i,1]);t.graphics.backgroundColor=r;t.layout.layout(true);var n=24;var o=.05;var a=.15;var l=t.windowBounds.width;var s=t.windowBounds.height;for(var c=0;c<n;c++){var u=10+(l-20)*Math.random();var p=10+(s-20)*Math.random();var _=5+15*Math.random();var h=5+15*Math.random();var f=1+4*Math.random();var d=[Math.random(),Math.random(),Math.random(),o+(a-o)*Math.random()];var m=t.graphics.newBrush(e,d);var v=t.add("group",[u,p,u+_,p+f]);var g=t.add("group",[u,p+h-f,u+_,p+h]);var y=t.add("group",[u,p+f,u+f,p+h-f]);var T=t.add("group",[u+_-f,p+f,u+_,p+h-f]);v.graphics.backgroundColor=g.graphics.backgroundColor=y.graphics.backgroundColor=T.graphics.backgroundColor=m}}var Qt=BridgeTalk.getDisplayName(BridgeTalk.appSpecifier);var Wt=function(){function t(i){var r;var l=this;this.portal=i;this.window=new Window("dialog",localize(d.settings)+" - "+e.scriptName+" v"+e.version,void 0,{resizeable:false});if(null===this.window)throw new k;this.group=n(this.window,"group",{orientation:"row",alignChildren:"fill",alignment:"fill"});this.leftGroup=n(this.group,"group",{orientation:"column",alignChildren:"fill",alignment:"fill"});this.separator=new nt(this.group,"vertical");this.rightGroup=n(this.group,"group",{orientation:"column",alignChildren:"fill",alignment:"fill",spacing:5});var s=localize(d.about,e.githubPage,Qt,BridgeTalk.appSpecifier,"v"+e.version);var c=localize(d.__translator__);if(""!==c)s+="\n"+localize(d.script_translator)+c;this.aboutLbl=n(this.leftGroup,"statictext",{text:s},{multiline:true,scrolling:true});this.openGithubBtnGroup=new Xt(this.leftGroup,3,["fill","bottom"]);this.openGithubLatestBtn=this.openGithubBtnGroup.add("button",{text:localize(d.check_update)+v});this.openGithubPageBtn=this.openGithubBtnGroup.add("button",{text:localize(d.repository_link)});this.extendScriptEngineAboutBtn=this.openGithubBtnGroup.add("button",{text:localize(d.about_script_engine)});this.importOmUtilsBtn=this.openGithubBtnGroup.add("button",{text:localize(d.import_om_utils)+v});this.importPureQuarterMidiBtn=this.openGithubBtnGroup.add("button",{text:localize(d.import_pure_quarter_midi)+v});this.generalPanel=this.addPanel(this.rightGroup,localize(d.general),[10,10,10,7]);r=a(this.generalPanel,localize(d.language),"dropdownlist"),this.languageGroup=r.group,this.languageLbl=r.label,this.languageCombo=r.control;o(this.languageCombo,localize(d.app_default)+" ("+this.getDefaultLocale()+")","简体中文","English","日本語","Tiếng Việt");var u=pt.getLanguage();if(u>0&&u<this.languageCombo.items.length)this.languageCombo.selection=u;this.nullObjPanel=this.addPanel(this.rightGroup,localize(d.create_null_object));this.usingSelectedLayerName=n(this.nullObjPanel,"checkbox",{text:localize(d.using_selected_layer_name)});this.usingSelectedLayerName.value=pt.getUsingSelectedLayerName();this.normalizePanTo100=n(this.nullObjPanel,"checkbox",{text:localize(d.normalize_pan_to_100)});this.normalizePanTo100.value=pt.getNormalizePanTo100();this.applyEffectsPanel=this.addPanel(this.rightGroup,localize(d.apply_effects));this.usingLayering=n(this.applyEffectsPanel,"checkbox",{text:localize(d.using_layering)});this.usingLayering.value=pt.getUsingLayering();this.addToEffectTransform=n(this.applyEffectsPanel,"checkbox",{text:localize(d.add_to_effect_transform)});this.addToEffectTransform.value=pt.getAddToEffectTransform();this.optimizeApplyEffects=n(this.applyEffectsPanel,"checkbox",{text:localize(d.optimize_apply_effects)});this.optimizeApplyEffects.value=pt.getOptimizeApplyEffects();this.hFlipMotionCombo=a(this.applyEffectsPanel,localize(d.motion_for_horizontal_flip),"dropdownlist").control;o(this.hFlipMotionCombo,localize(d.motion_entrance),localize(d.motion_exit),localize(d.motion_float_left),localize(d.motion_float_right),localize(d.motion_float_up),localize(d.motion_float_down));var p=pt.getMotionForHorizontalFlip();if(p>0&&p<this.hFlipMotionCombo.items.length)this.hFlipMotionCombo.selection=p;this.buttonGroup=n(this.rightGroup,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]});this.okBtn=n(this.buttonGroup,"button",{text:localize(d.ok)});this.cancelBtn=n(this.buttonGroup,"button",{text:localize(d.cancel)});this.window.defaultElement=this.okBtn;this.window.cancelElement=this.cancelBtn;this.okBtn.onClick=function(){pt.setUsingSelectedLayerName(l.usingSelectedLayerName.value);pt.setUsingLayering(l.usingLayering.value);pt.setOptimizeApplyEffects(l.optimizeApplyEffects.value);pt.setNormalizePanTo100(l.normalizePanTo100.value);pt.setAddToEffectTransform(l.addToEffectTransform.value);pt.setMotionForHorizontalFlip(l.hFlipMotionCombo.getSelectedIndex());pt.setLanguage(l.languageCombo.getSelectedIndex());$.locale=t.langIso[l.languageCombo.getSelectedIndex()];l.window.close()};this.openGithubPageBtn.onClick=function(){return mt(e.githubPage)};this.openGithubLatestBtn.onClick=function(){return mt(e.githubLatest)};this.importPureQuarterMidiBtn.onClick=function(){if(!confirm(localize(d.sure_to_import_pure_quarter_midi),true,localize(d.import_pure_quarter_midi)))return;var t=new Yt(true);l.portal.midi=t;l.portal.selectedTracks=[void 0];l.portal.selectMidiName.text=localize(d.pure_quarter_midi);l.portal.selectTrackBtn.text="";l.portal.selectTrackBtn.enabled=false;l.portal.selectBpmTxt.enabled=true;l.portal.updateDefaultBpm(t)};this.importOmUtilsBtn.onClick=function(){return(new vt).showDialog()};this.extendScriptEngineAboutBtn.onClick=function(){return $.about()};this.optimizeApplyEffects.onClick=function(){return l.hFlipMotionCombo.enabled=l.optimizeApplyEffects.value};this.optimizeApplyEffects.onClick();qt(this.window)}t.prototype.showDialog=function(){this.window.center();this.window.show()};t.prototype.addPanel=function(t,e,i){if(void 0===i)i=[10,13,10,3];return n(t,"panel",{text:e,orientation:"column",alignChildren:"fill",alignment:"fill",spacing:2,margins:i})};t.prototype.getDefaultLocale=function(){if(!pt.getLanguage()){$.locale="";return $.locale}else{var t=$.locale;$.locale="";var e=$.locale;$.locale=t;return e}};t.langIso=["","zh_CN","en","ja","vi"];return t}();var Zt=function(){function t(t){var e=this;this.parent=t;this.window=new Window("dialog",localize(d.midi_track_selector_title),void 0,{resizeable:true});if(null===this.window)throw new k;this.window.onResizing=this.window.onResize=function(){return e.window.layout.resize()};this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:["fill","fill"]});this.selectAllCheck=n(this.group,"checkbox",{text:localize(d.select_all)});this.trackList=n(this.group,"listbox",{alignment:["fill","fill"]},{multiselect:true,numberOfColumns:3,showHeaders:true,columnTitles:[localize(d.channel),localize(d.name),localize(d.note_count)],columnWidths:[50,225,75]});this.trackList.size=[400,400];this.buttonGroup=n(this.group,"group",{orientation:"row",alignment:["fill","bottom"],alignChildren:["right","center"]});this.okBtn=n(this.buttonGroup,"button",{text:localize(d.ok)});this.cancelBtn=n(this.buttonGroup,"button",{text:localize(d.cancel)});this.window.defaultElement=this.okBtn;this.window.cancelElement=this.cancelBtn;this.initMidiTracks();this.selectAllCheck.onClick=function(){var t=e.selectAllCheck.value;for(var i=0,r=e.trackList.items;i<r.length;i++){var n=r[i];n.checked=n.selected=t}};this.trackList.onChange=function(){return e.trackList_onChange()};this.okBtn.onClick=function(){var t;if(!e.parent.midi){e.window.close();return}var i=[];for(var r=0;r<e.trackList.items.length;r++){var n=e.trackList.items[r];var o=e.parent.midi.tracks[r];if(n.checked)i.push(o)}var a="";if(0===i.length){alert(localize(d.select_at_least_one_track),localize(d.warning));return}else if(1===i.length)a=i[0].toString();else{var l=[];for(var s=0,c=i;s<c.length;s++){var o=c[s];var u=String(null!==(t=o.channel)&&void 0!==t?t:0);if(o.name)u+=": "+o.name;l.push(u)}a=l.join("; ")}e.parent.selectedTracks=i;e.parent.selectTrackBtn.text=a;e.window.close()}}t.prototype.showDialog=function(){this.window.center();this.window.show()};t.prototype.initMidiTracks=function(){var t,e;if(this.parent.midi)for(var i=0,r=this.parent.midi.tracks;i<r.length;i++){var n=r[i];var o=this.trackList.add("item",String(null!==(t=n.channel)&&void 0!==t?t:0));o.checked=this.parent.selectedTracks.includes(n);o.subItems[0].text=null!==(e=n.name)&&void 0!==e?e:"";o.subItems[1].text=n.noteCount}this.trackList_onChange(true)};t.prototype.trackList_onChange=function(t){if(void 0===t)t=false;var e=true;for(var i=0,r=this.trackList.items;i<r.length;i++){var n=r[i];if(!t)n.checked=n.selected;if(!n.checked)e=false}this.selectAllCheck.value=e};return t}();function Jt(){var t=app.project.activeItem;if(!isValid(t))return null;return t}var $t=function(){function t(t,e){this.running=true;this.palette=new Window("palette");this.palette.orientation="column";this.palette.alignChildren="left";this.title1=this.palette.add("statictext",void 0,t);this.title2=this.palette.add("statictext",void 0,e);this.progressBar=this.palette.add("progressbar");this.cancelBtn=this.palette.add("button",void 0,localize(d.cancel));this.cancelBtn.alignment="right";this.palette.cancelElement=this.cancelBtn}t.prototype.isRunning=function(){return this.running};t.prototype.isCanceled=function(){return!this.running};t.prototype.setValue=function(t){this.progressBar.value=100*t};t.prototype.setTitle1=function(t){this.title1.text=t};t.prototype.setTitle2=function(t){this.title2.text=t};t.prototype.close=function(){this.palette.close()};t.prototype.show=function(){this.palette.show()};return t}();var te;(function(t){t[t["ENTRANCE"]=0]="ENTRANCE";t[t["EXIT"]=1]="EXIT";t[t["FLOAT_LEFT"]=2]="FLOAT_LEFT";t[t["FLOAT_RIGHT"]=3]="FLOAT_RIGHT";t[t["FLOAT_UP"]=4]="FLOAT_UP";t[t["FLOAT_DOWN"]=5]="FLOAT_DOWN"})(te||(te={}));var ee=te;var ie=5e-4;var re="om midi null";var ne="om midi Transform";var oe=15;var ae=15;var le=false;var se=function(){function t(t){this.portal=t}t.prototype.apply=function(){var t=Jt();if(null===t)throw new F;var e;try{var i=this.portal.getSelectedTab();if(i!==this.portal.toolsTab&&this.portal.midi&&le){e=new $t(localize(d.loading_midi,this.portal.midi.fileName));e.show();e.setValue(.6)}if(i===this.portal.nullObjTab)this.applyCreateNullObject(t);else if(i===this.portal.applyEffectsTab)this.applyEffects(t);else if(i===this.portal.toolsTab){var r=this.portal.toolsTab.getSelectedTool();if(r===this.portal.toolsTab.marker)this.applyMarkerConductor(t);else if(r===this.portal.toolsTab.ease)this.applyEase100Percent(t)}}catch(t){throw new N(t)}finally{if(e)e.close();app.endUndoGroup()}};t.prototype.applyCreateNullObject=function(t){var e=this;var i,r;app.beginUndoGroup("om midi - Apply Create Null Object");var n=this.portal.nullObjTab;if(!this.portal.midi||0===this.portal.selectedTracks.length)throw new z;var o=n.getCheckedChecks();if(0===o.length)throw new K;var a=pt.getUsingSelectedLayerName();var l=this.getSelectLayer(t);if(null===l)a=false;var s=pt.getNormalizePanTo100();var c=this.getSecondsPerTick();var u=this.getStartTime(t);var p=this.getIntegrator();var _=function(_){if(void 0===_&&!h.portal.midi.isPureQuarter)return"continue";var f=h.createNullLayer(t);if(void 0!==_)f.name="[midi]"+(a&&null!==l?l.name:null!==(i=_.name)&&void 0!==i?i:"Channel "+(null!==(r=_.channel)&&void 0!==r?r:0));else f.name="[midi]BPM: "+h.portal.selectBpmTxt.text;f.inPoint=u;f.outPoint=void 0!==_?u+_.lengthTick*c:u+t.duration;for(var d=0,m=o;d<m.length;d++){var v=m[d];h.addSliderControl(f,v.text)}var g=function(t,i,r,n,a){return e.setValueAtTime(f,o,t,u+i,r,n,a)};var y=0,T=Ot.NOTE_OFF,E=-1,O=NaN,R=NaN,L=NaN;var S=function(t){var e,i,r;if(t.startTick<=E&&!(T===Ot.NOTE_OFF&&t instanceof Mt)&&(t instanceof Mt||t instanceof xt))return;var o=p?p.getSecond(t):void 0;var a=o?o.startSecond:t.startTick*c;if(t instanceof Mt&&0!==t.velocity){if(0===t.interruptDuration||0===t.duration||+t.interruptDuration<0||+t.duration<0)return;y++;g(n.pitch,a,t.pitch,KeyframeInterpolationType.HOLD);g(n.velocity,a,t.velocity,KeyframeInterpolationType.HOLD);g(n.duration,a,(null!==(e=t.duration)&&void 0!==e?e:0)*c,KeyframeInterpolationType.HOLD);g(n.count,a,y,KeyframeInterpolationType.HOLD);g(n.bool,a,y%2,KeyframeInterpolationType.HOLD);g(n.scale,a,y%2?100:-100,KeyframeInterpolationType.HOLD);g(n.advancedScale,a,y%2?1:-1,KeyframeInterpolationType.HOLD);g(n.cwRotation,a,(y-1)%4*90,KeyframeInterpolationType.HOLD);g(n.ccwRotation,a,(4-(y-1)%4)%4*90,KeyframeInterpolationType.HOLD);g(n.noteOn,a,1,KeyframeInterpolationType.HOLD);g(n.timeRemap,a,0,KeyframeInterpolationType.LINEAR);g(n.pingpong,a,+!(y%2),KeyframeInterpolationType.LINEAR);if(void 0!==t.interruptDuration||void 0!==t.duration){var l=void 0;if(!o){var u=null!==(i=t.interruptDuration)&&void 0!==i?i:t.duration;l=(t.startTick+u)*c-ie}else l=(null!==(r=o.interruptDurationSecond)&&void 0!==r?r:o.durationSecond)-ie+o.startSecond;g(n.timeRemap,l,1,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD);g(n.pingpong,l,y%2,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD)}T=Ot.NOTE_ON;E=t.startTick}else if(t instanceof Mt&&0===t.velocity||t instanceof xt){var l=a-ie;g(n.velocity,l,t.velocity,KeyframeInterpolationType.HOLD);g(n.noteOn,a,0,KeyframeInterpolationType.HOLD);T=Ot.NOTE_OFF;E=t.startTick}else if(t instanceof Bt){var _=t.controller;if(_===Rt.PAN){if(O===t.value)return;O=t.value;var h=t.value-64;if(s)if(h<0)h=h/64*100;else if(h>0)h=h/63*100;g(n.pan,a,h,KeyframeInterpolationType.HOLD)}else if(_===Rt.MAIN_VOLUME){if(R===t.value)return;R=t.value;g(n.volume,a,t.value,KeyframeInterpolationType.HOLD)}}else if(t instanceof Ft){if(L===t.value)return;L=t.value;var f=t.value-8192;g(n.glide,a,f,KeyframeInterpolationType.HOLD)}};g(n.velocity,0,0,KeyframeInterpolationType.HOLD);g(n.noteOn,0,0,KeyframeInterpolationType.HOLD);g(n.count,0,0,KeyframeInterpolationType.HOLD);h.dealNoteEvents(_,t,c,u,S)};var h=this;for(var f=0,d=this.portal.selectedTracks;f<d.length;f++){var m=d[f];_(m)}};t.prototype.applyMarkerConductor=function(t){app.beginUndoGroup("om midi - Apply Marker Conductor");var e=this.portal.toolsTab.marker;var i;if(1===e.markOnCombo.getSelectedIndex()){var r=this.getSelectLayer(t);if(null===r)throw new G;i=r}else{i=this.createNullLayer(t);i.name="BPM:"+e.bpmTxt.text+" ("+e.beatTxt.text+"/4)"}var n=this.getStartTime(t);i.startTime=n;var o=1;var a=e.unitCombo.getSelectedIndex();if(1===a)n-=parseFloat(e.beatTxt.text);else if(2===a)n-=parseFloat(e.beatTxt.text)*t.frameDuration;var l=parseFloat(e.bpmTxt.text);while(n<=t.displayStartTime+t.duration){if(n>=t.displayStartTime)i.marker.setValueAtTime(n,new MarkerValue(String(o)));if(0===a){o=o%parseInt(e.beatTxt.text)+1;n+=60/l}else{o++;if(1===a)n+=l;else if(2===a)n+=l*t.frameDuration}}};t.prototype.applyEffects=function(e){var i=this;app.beginUndoGroup("om midi - Apply Effects");var r=this.portal.applyEffectsTab;if(!this.portal.midi||0===this.portal.selectedTracks.length)throw new z;if(0===r._getCheckedChecks().length)throw new K;if(1!==this.portal.selectedTracks.length)throw new U;var n=1===r.getCheckedChecks().length&&r.tuning.value;var o=this.getSelectLayer(e);if(null===o)throw new G;var a=o;var l=this.getSecondsPerTick();var s=this.portal.selectedTracks[0];var c=this.getStartTime(e);var u=function(){return c-(a.inPoint-a.startTime)};var p=function(){return void 0!==s?c+s.lengthTick*l:c+e.duration};if(1===this.portal.startTimeCombo.getSelectedIndex())c=a.inPoint;else if(!n)a.startTime=u();var _=this.getIntegrator();var h=pt.getUsingLayering();var f=pt.getOptimizeApplyEffects();var d=pt.getAddToEffectTransform();var m=pt.getMotionForHorizontalFlip();if(a.timeRemapEnabled)a.timeRemapEnabled=false;var v=a.source;var g=(+(v.duration/v.frameDuration).toFixed(0)-1)*v.frameDuration;var y=a.outPoint-a.inPoint-v.frameDuration;var T=0;var E=function(){return t.getEffects(a).property(T).property(2)};if(r.hMirror.value){T=t.getEffects(a).addProperty("ADBE Mirror").propertyIndex;t.getEffects(a).property(T).property(1).setValue([v.width/2,v.height/2])}var O=f&&(m===ee.FLOAT_LEFT||m===ee.FLOAT_RIGHT||m===ee.FLOAT_UP||m===ee.FLOAT_DOWN);var R=[960,540];var L=100;var S=0;var b={prop:function(){return t.getEffects(a).property(S)},scaleTogether:function(){return this.prop().property(3)},scaleHeight:function(){return this.prop().property(4)},scaleWidth:function(){return this.prop().property(5)},rotation:function(){return this.prop().property(8)},opacity:function(){return this.prop().property(9)},anchor:function(){return this.prop().property(1)}};if(r.hFlip.value||r.cwRotation.value||r.ccwRotation.value||r.mapVelToOpacity.value){if(!d){if(!a.hasVideo)throw new q;if(r.hFlip.value)a.scale.expressionEnabled=false;if(r.cwRotation.value||r.ccwRotation.value)a.rotation.expressionEnabled=false;if(r.mapVelToOpacity.value)a.opacity.expressionEnabled=false;if(O)a.anchorPoint.expressionEnabled=false;L=a.scale.value[1]}else{S=this.getGeometry2Effect(a).propertyIndex;b.scaleTogether().setValue(false);L=b.scaleHeight().value}R=a.anchorPoint.value.slice(0,2)}var C=function(t,e){try{t.timeRemap.removeKey(e)}catch(t){}};var N=0;if(r.timeRemap.value||r.timeRemap2.value||r.pingpong.value){if(!a.canSetTimeRemapEnabled)throw new H;a.timeRemapEnabled=true;N=a.timeRemap.valueAtTime(a.inPoint,false);C(a,2);a.timeRemap.expressionEnabled=false}if(!n)a.outPoint=p();var k;var I=this.getBasePitch();if(r.tuning.value){if(!a.hasAudio)throw new j;k=a.duplicate();k.enabled=false;k.moveAfter(a);k.timeRemapEnabled=true;if(!(r.timeRemap.value||r.timeRemap2.value||r.pingpong.value))N=k.timeRemap.valueAtTime(a.inPoint,false);C(k,2);k.startTime=u();k.outPoint=p();k.timeRemap.expressionEnabled=false;a.audioEnabled=false}var w=0;var A=function(){return t.getEffects(a).property(w).property(2)};if(r.negative.value){w=t.getEffects(a).addProperty("ADBE Invert").propertyIndex;A().setValue(100)}var D=0,M=Ot.NOTE_OFF,x=-1;var P=function(t){var e;var o,s,u,p;if(t.startTick<=x&&!(M===Ot.NOTE_OFF&&t instanceof Mt))return;var T=_?_.getSecond(t):void 0;var S=(T?T.startSecond:t.startTick*l)+c;if(t instanceof Mt){if(0===t.interruptDuration||0===t.duration||+t.interruptDuration<0||+t.duration<0)return;var C=void 0!==t.interruptDuration||void 0!==t.duration;var w=void 0;if(!T){var P=null!==(s=null!==(o=t.interruptDuration)&&void 0!==o?o:t.duration)&&void 0!==s?s:0;w=(t.startTick+P)*l-ie+c}else w=(null!==(p=null!==(u=T.interruptDurationSecond)&&void 0!==u?u:T.durationSecond)&&void 0!==p?p:0)-ie+T.startSecond+c;if(r.hFlip.value){var B=function(t){return!d?a.scale.addKey(t):(b.scaleHeight().addKey(t),b.scaleWidth().addKey(t))};var F=function(t,e){return!d?a.scale.setValueAtKey(t,e):(b.scaleHeight().setValueAtKey(t,e[1]),b.scaleWidth().setValueAtKey(t,e[0]))};var z=function(t,e){return!d?a.scale.setInterpolationTypeAtKey(t,e):(b.scaleHeight().setInterpolationTypeAtKey(t,e),b.scaleWidth().setInterpolationTypeAtKey(t,e))};var K=function(t,e,r){return!d?i.setPointKeyEase(a.scale,t,e,r):(i.setPointKeyEase(b.scaleHeight(),t,e,r),i.setPointKeyEase(b.scaleWidth(),t,e,r))};var G=B(S);var U=(D%2?-1:1)*L;var V=oe/100*Math.abs(L);if(!f||!C||O){F(G,[U,L]);z(G,KeyframeInterpolationType.HOLD)}else{var H=[U+V*Math.sign(U),L+V],j=[U,L];if(m===ee.EXIT)e=[j,H],H=e[0],j=e[1];F(G,H);z(G,KeyframeInterpolationType.LINEAR);var Y=B(w);F(Y,j);K(Y,at.EASE_IN,true)}if(O&&C){var X=function(t){return!d?a.anchorPoint.addKey(t):b.anchor().addKey(t)};var q=function(t,e){return!d?a.anchorPoint.setValueAtKey(t,e):b.anchor().setValueAtKey(t,e)};var Q=function(t,e){return!d?a.anchorPoint.setInterpolationTypeAtKey(t,e):b.anchor().setInterpolationTypeAtKey(t,e)};var W=function(t,e,r){return!d?i.setPointKeyEase(a.anchorPoint,t,e,r):i.setPointKeyEase(b.anchor(),t,e,r)};var Z=10;var J=v.width/Z;var $=m===ee.FLOAT_LEFT||m===ee.FLOAT_UP?-1:1;var tt=X(S);if(m===ee.FLOAT_LEFT||m===ee.FLOAT_RIGHT)q(tt,[R[0]+$*J,R[1]]);else q(tt,[R[0],R[1]+$*J]);Q(tt,KeyframeInterpolationType.LINEAR);var Y=X(w);q(Y,R);W(Y,at.EASE_IN,true)}}if(r.cwRotation.value||r.ccwRotation.value){var B=function(t){return!d?a.rotation.addKey(t):b.rotation().addKey(t)};var F=function(t,e){return!d?a.rotation.setValueAtKey(t,e):b.rotation().setValueAtKey(t,e)};var z=function(t,e){return!d?a.rotation.setInterpolationTypeAtKey(t,e):b.rotation().setInterpolationTypeAtKey(t,e)};var K=function(t,e,r){return!d?i.setPointKeyEase(a.rotation,t,e,r):i.setPointKeyEase(b.rotation(),t,e,r)};var et=r.cwRotation.value?D%4*90:(4-D%4)%4*90;var G=B(S);if(!f||!C){F(G,et);z(G,KeyframeInterpolationType.HOLD)}else{var it=et+ae*(r.cwRotation.value?-1:1);F(G,it);z(G,KeyframeInterpolationType.LINEAR);var Y=B(w);F(Y,et);K(Y,at.EASE_IN,true)}}if(r.mapVelToOpacity.value){var B=function(t){return!d?a.opacity.addKey(t):b.opacity().addKey(t)};var F=function(t,e){return!d?a.opacity.setValueAtKey(t,e):b.opacity().setValueAtKey(t,e)};var z=function(t,e){return!d?a.opacity.setInterpolationTypeAtKey(t,e):b.opacity().setInterpolationTypeAtKey(t,e)};var et=r.mapVelToOpacity.map(t.velocity);var G=B(S);F(G,et);z(G,KeyframeInterpolationType.HOLD)}if(r.timeRemap.value||r.timeRemap2.value||r.pingpong.value){if(0===D&&0!==t.startTick){var rt=a.timeRemap.keyValue(1);var nt=a.timeRemap.keyTime(1);a.timeRemap.setValueAtTime(nt+S-c,rt)}var G=a.timeRemap.addKey(S);var $=!(D%2);a.timeRemap.setValueAtKey(G,N);a.timeRemap.setInterpolationTypeAtKey(G,KeyframeInterpolationType.LINEAR);if(C){var Y=a.timeRemap.addKey(w);var ot=r.timeRemap.value||r.pingpong.value?N+y:w-S+N;var lt=r.pingpong.value&&!$;if(lt)a.timeRemap.setValueAtKey(G,ot);if(ot<a.source.duration)a.timeRemap.setValueAtKey(Y,!lt?ot:N);else{a.timeRemap.removeKey(Y);Y=a.timeRemap.addKey(S+g-N);a.timeRemap.setValueAtKey(Y,g)}a.timeRemap.setInterpolationTypeAtKey(Y,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD)}}if(r.negative.value){var G=A().addKey(S);A().setValueAtKey(G,D%2?0:100);A().setInterpolationTypeAtKey(G,KeyframeInterpolationType.HOLD)}if(r.hMirror.value){var G=E().addKey(S);E().setValueAtKey(G,D%2?0:180);E().setInterpolationTypeAtKey(G,KeyframeInterpolationType.HOLD)}if(r.tuning.value&&k){var G=k.timeRemap.addKey(S);k.timeRemap.setValueAtKey(G,N);k.timeRemap.setInterpolationTypeAtKey(G,KeyframeInterpolationType.LINEAR);if(C){var Y=k.timeRemap.addKey(w);var st=w-S;var ct=t.pitch-I;var ut=Math.pow(2,ct/12);var ot=st*ut+N;if(ot<a.source.duration)k.timeRemap.setValueAtKey(Y,ot);else{k.timeRemap.removeKey(Y);Y=k.timeRemap.addKey(S+(g-N)/ut);k.timeRemap.setValueAtKey(Y,g)}k.timeRemap.setInterpolationTypeAtKey(Y,KeyframeInterpolationType.LINEAR,KeyframeInterpolationType.HOLD)}if(r.mapVelToVolume.value){var pt=k.audio.audioLevels;var _t=pt.addKey(S);var et=r.mapVelToVolume.map(t.velocity);pt.setValueAtKey(_t,[et,et]);pt.setInterpolationTypeAtKey(_t,KeyframeInterpolationType.HOLD);if(C){var Y=pt.addKey(w);var ht=-192;pt.setValueAtKey(Y,[ht,ht]);pt.setInterpolationTypeAtKey(Y,KeyframeInterpolationType.HOLD)}}}if(h&&0!==D){if(!n)a=i.splitLayer(a,S);if(r.tuning.value&&k)k=i.splitLayer(k,S)}D++;M=Ot.NOTE_ON;x=t.startTick}};this.dealNoteEvents(s,e,l,N,P)};t.prototype.applyEase100Percent=function(t){app.beginUndoGroup("om midi - Apply Easing 100%");var e=this.portal.toolsTab.ease.getValue();var i=t.selectedLayers;for(var r=0,n=i;r<n.length;r++){var o=n[r];if(void 0===o)continue;for(var a=0,l=o.selectedProperties;a<l.length;a++){var s=l[a];if(void 0===s)continue;for(var c=0,u=s.selectedKeys;c<u.length;c++){var p=u[c];if(void 0===p)continue;this.setPointKeyEase(s,p,e,false)}}}};t.prototype.createNullLayer=function(t){var e;t:while(true){var i=false;try{i=!!this.nullSource&&!!this.nullSource.parentFolder}catch(t){i=false}if(i){e=t.layers.add(this.nullSource,t.workAreaDuration);e.opacity.setValue(0);e.anchorPoint.setValue([0,0])}else{e=t.layers.addNull(t.workAreaDuration);var r=e.source;for(var n=1;n<=r.parentFolder.items.length;n++){var o=r.parentFolder.items[n];if(o.name===re&&o instanceof FootageItem&&o.mainSource instanceof SolidSource){this.nullSource=o;r.remove();continue t}}this.nullSource=r;e.source.name=re}break}e.enabled=false;return e};t.getEffects=function(t){return t("Effects")};t.prototype.addSliderControl=function(e,i){var r=t.getEffects(e).addProperty("ADBE Slider Control");r.name=i;return r.propertyIndex};t.prototype.setValueAtTime=function(e,i,r,n,o,a,l){if(void 0===l)l=a;var s=i.indexOf(r);if(-1===s)return;var c=t.getEffects(e).property(s+1).property(1);var u=c.addKey(n);c.setValueAtKey(u,o);c.setInterpolationTypeAtKey(u,a,l)};t.prototype.getSelectLayer=function(t){if(0===t.selectedLayers.length)return null;var e=t.selectedLayers[0];if(e instanceof AVLayer)return e;return null};t.prototype.getSecondsPerTick=function(){if(!this.portal.midi)throw new z;var t;var e=this.portal.midi.timeDivision;if(e instanceof Array)t=1/e[0]/e[1];else{var i=parseFloat(this.portal.selectBpmTxt.text),r=60/i;t=r/e}return t};t.prototype.getStartTime=function(t){var e=this.portal.startTimeCombo.getSelectedIndex();if(0===e)return t.displayStartTime;else if(1===e)return t.time;else if(2===e)return t.workAreaStart;else return 0};t.prototype.dealNoteEvents=function(t,e,i,r,n){if(void 0!==t)for(var o=0,a=t;o<a.length;o++){var l=a[o];n(l)}else{var s=0;while(s*i<=r+e.duration)n(new Mt(0,60,100,+!!s,1,s++))}};t.prototype.getBasePitch=function(){var t=this.portal.applyEffectsTab;return 12*t.basePitchOctCombo.getSelectedIndex()+t.basePitchKeyCombo.getSelectedIndex()};t.prototype.splitLayer=function(t,e){var i=t.outPoint;var r=t.duplicate();t.outPoint=e;r.inPoint=e;r.outPoint=i;return r};t.prototype.setPointKeyEase=function(t,e,i,r){var n=t.keyInTemporalEase(e).length;var o=[];for(var a=0;a<n;a++)o.push(new KeyframeEase(0,100));if(0!==o.length)t.setTemporalEaseAtKey(e,o);var l=r?KeyframeInterpolationType.HOLD:KeyframeInterpolationType.LINEAR;if(i===at.EASE_IN)t.setInterpolationTypeAtKey(e,KeyframeInterpolationType.BEZIER,l);else if(i===at.EASE_OUT)t.setInterpolationTypeAtKey(e,l,KeyframeInterpolationType.BEZIER)};t.prototype.getGeometry2Effect=function(e){var i="ADBE Geometry2";var r=t.getEffects(e);for(var n=1;n<=r.numProperties;n++){var o=r.property(n);if(o.name===ne&&o.matchName===i)return o}var a=r.addProperty(i);a.name=ne;return a};t.prototype.getIntegrator=function(){var t=this.portal.midi;return t&&t.isDynamicBpm&&t.integrator&&this.portal.isUseDynamicBpm()?t.integrator:void 0};return t}();var ce="iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAEMklEQVRIib1WTUgjWRCudeemiK4N4iy6GjYHESHYZC8yvqcEVvxBUEQvUcQQzOYayDALe3IGc1ToGQysoBdJBvUQVi9BXoSAkDQEg+QQiBsRvXQiO8bAHpYsX6c7ZESduewWNP3yut6rqq/qq8o3jDH6Smk11G6/9kAsFqMXWAghnlTinPuIyCNJkgW/NU2DgY9E9EEIkXrmXHWBCCqVyqMPY0z2+XwVTdMqptzf31disViFMbb51DnjrH7/iy9E6Z6cnNQXGxsb+ttms9HQ0BBZrVY35zwghMg9d0HNAOe8GVAQEaCICiEAg9zT00Pn5+e0v78fxH46nQ7DQH9/P2WzWZlzDsjcRo4+CiHURw0Q0ZrX6/W0t7dTKpWCd6okSXJbWxudnp7iew5GOee5QqFgsVqt2PNLkhSem5ujpqYmOj4+9nPOXUKI32u3AivG2NutrS0d5cvLy9ob2OM9MzMDzFsNbP3hcLimg5zgMXUZY0nG2A9mDlCmrZIkFXd2dvSyCgQCqt1ul0dGRqhUKlEoFELluIhIMmCIEtH09PS0B1GYOpC6OwJE9BprGPB7vd618fFxWlhYwGXdxmWzRs03S5L0xoRBVVWKRqMwgpzIhg7Wfgg8Hxsbw953MICQw8lkUg/R5XIhxLd1pfYecACCeslkMiZsw4aeDWV7eHioa6G0UeJmDoahbOJpfPSZHICg7mEceuvr67oenIJzjLFmXA4dCByCY2YOvu3u7v6zXC5fHRwcfD8wMPByYmKCwuHwj8B7ZWVFBiwejydXLBZHyuXym0wm809LS8srh8NB8Xi8r1gs/uX1elE9wB75+AD8iejvfD5PDVRtFSirQDweJ5Sl0RZ0DpTLZajcoi0IIYBt6ubmRvcOXIAjcKJQKCA3qhDiFyHEp894wDlfBskGBwd1RU3TwE714uJC7uvr0y/hnNuIKA8yd3R06IfT6bRuHJXU2dlJDocDxHtvRPDJhGhYkqS9zc3Nl11dXbS6ukrX19fviGivVCq5p6amyGKxtF5dXa00NDT4R0dHX83Pz9PZ2Rnt7u6C7b8lEok2i8UiO51OamxstCcSiRYi+gMQ/edVBIjUXC4329vbS7e3eqsPcs4dRIQnryjKu1Ao9BQPfuac/2Ss9cPIWSKRwFo1DQRDoZBOtOXlZVTCHrCUZfkzJiuK8pDJ4Tomr5ltRydX1eD/04vMifYr5xzl5gEM29vbesmhm6K/AB5FUdCS0WPc6FNHR0d634IOvqMLRyIRMiZd3pxo9e36taIoeRMGIUSUc54sFAoyDmNOcM5n7Xa7BVzJZrPYC2iaFjWMgzvBJ+eBQY7Ag4FU48Li4qL77u7ObcwBkwMgFhL68NyjA+cxCUYiETcYvbS0VPt+cnKCCODts+PyiwYQLiaU0+nEv4pqd6z+s0CVoOc8L0T0L32CI0/szYESAAAAAElFTkSuQmCC";var ue=function(t){s(e,t);function e(i,r){if(void 0===r)r="tmp"+(new Date).valueOf()+".png";var n=t.call(this,r)||this;if(n&&n.open("w")){n.encoding="binary";n.write(e.base64Decode(i));n.close()}else throw new B;return n}e.base64Decode=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var i={RE_NON_ALPHA:new RegExp("[^"+e+"]"),RE_BAD_EQUALS:/\=([^=]|\=\=)/};var r=t.length>>>0,n=[];if(r%4||i.RE_NON_ALPHA.test(t)||i.RE_BAD_EQUALS.test(t))throw Error("Invalid Base64 data");var o=0,a,l,s,c,u,p,_,h;while(o<r){a=e.indexOf(t[o++]);l=e.indexOf(t[o++]);s=e.indexOf(t[o++]);c=e.indexOf(t[o++]);u=(a<<18)+(l<<12)+((63&s)<<6)+(63&c);p=(u&255<<16)>>16;_=64===s?-1:(u&255<<8)>>8;h=64===c?-1:255&u;n[n.length]=String.fromCharCode(p);if(0<=_)n[n.length]=String.fromCharCode(_);if(0<=h)n[n.length]=String.fromCharCode(h)}t=n.join("");n.length=0;return t};e.settingIcon=function(){return new e(ce,"settings_icon.png")};return e}(dt);var pe=1e4;var _e=22;var he=15;var fe=function(){function t(t){var e,i,r,o;var l=this;this.selectedTracks=[];this.window=t;this.group=n(this.window,"group",{orientation:"column",alignChildren:"fill",alignment:["fill","fill"],spacing:5});var s=["fill","center"];e=a(this.group,"","button",{text:"...",size:[he,_e]}),this.selectMidiGroup=e.group,this.selectMidiLbl=e.label,this.selectMidiBtn=e.control;this.selectMidiName=n(this.selectMidiGroup,"statictext",{alignment:s});i=a(this.group,"","button",{text:"",alignment:s,maximumSize:[pe,_e],enabled:false}),this.selectTrackGroup=i.group,this.selectTrackLbl=i.label,this.selectTrackBtn=i.control;r=a(this.group,"","edittext",{text:"120",alignment:s,enabled:false}),this.selectBpmGroup=r.group,this.selectBpmLbl=r.label,this.selectBpmTxt=r.control;o=a(this.group,"","dropdownlist",{alignment:s}),this.startTimeGroup=o.group,this.startTimeLbl=o.label,this.startTimeCombo=o.control;this.tabs=n(this.group,"tabbedpanel",{alignment:["fill","fill"]});this.buttonGroup=n(this.group,"group",{orientation:"row",alignment:["fill","bottom"]});this.applyBtn=n(this.buttonGroup,"button",{alignment:"left"});var c=ue.settingIcon();this.settingBtn=n(this.buttonGroup,"iconbutton",{alignment:["right","center"],image:c},{style:"toolbutton"});c.remove();this.nullObjTab=new S(this);this.applyEffectsTab=new et(this);this.toolsTab=new ft(this);this.translate();this.core=new se(this);this.selectMidiBtn.onClick=function(){var t;var e=File.openDialog(localize(d.select_a_midi_file),localize(d.midi_files)+":*.mid;*.midi,"+localize(d.all_files)+":*.*");if(null===e)return;var i;try{i=new Yt(e);if(0===i.tracks.length)throw new x;l.updateDefaultBpm(i);l.selectMidiName.text=e.displayName;var r=i.tracks[i.preferredTrackIndex];l.selectedTracks=[r];l.selectTrackBtn.text=r.toString();l.selectTrackBtn.enabled=true;l.selectBpmTxt.enabled=true;l.midi=i}catch(e){if(i)null===(t=i.file)||void 0===t?void 0:t.close();throw new N(e)}};this.applyBtn.onClick=function(){return l.core.apply()};this.settingBtn.onClick=function(){var t;new Wt(l).showDialog();if(null===(t=l.midi)||void 0===t?void 0:t.isPureQuarter)l.selectTrackBtn.enabled=false;l.translate()};this.selectTrackBtn.onClick=function(){new Zt(l).showDialog()};this.tabs.onChange=function(){var t=l.getSelectedTab();if(t===l.applyEffectsTab)l.startTimeCombo.selection=pt.getApplyEffectsStartTime();else l.startTimeCombo.selection=pt.getNullObjectStartTime()};this.tabs.onChange();this.startTimeCombo.onChange=function(){var t=l.getSelectedTab(),e=l.startTimeCombo.getSelectedIndex();if(t===l.applyEffectsTab)pt.setApplyEffectsStartTime(e);else pt.setNullObjectStartTime(e)}}t.build=function(e,i){$.strict=true;var r=e instanceof Panel?e:new Window("palette",i.scriptName+" v"+i.version,void 0,{resizeable:true});if(null===r)throw new k;var n=new t(r);r.onShow=r.onResizing=r.onResize=function(){r.layout.resize();n.resizeScrollGroups()};if(r instanceof Window){r.center();r.show()}else{r.layout.layout(true);r.layout.resize()}return n};t.prototype.getSelectedTab=function(){if(null===this.tabs.selection)return null;switch(this.tabs.selection.text){case this.nullObjTab.tab.text:return this.nullObjTab;case this.applyEffectsTab.tab.text:return this.applyEffectsTab;case this.toolsTab.tab.text:return this.toolsTab;default:return null}};t.prototype.translate=function(){this.applyBtn.text=localize(d.apply);this.nullObjTab.translate();this.applyEffectsTab.translate();this.toolsTab.translate();if(!this.midi||!this.selectedTracks.length)this.selectMidiName.text=localize(d.no_midi_file_selected);this.selectMidiLbl.text=localize(d.select_midi_file);this.selectTrackLbl.text=localize(d.select_midi_track);this.selectBpmLbl.text=localize(d.set_midi_bpm);this.startTimeLbl.text=localize(d.start_time);o(this.startTimeCombo,localize(d.display_start_time),localize(d.current_time),localize(d.work_area),"0")};t.prototype.resizeScrollGroups=function(){var t=[this.nullObjTab,this.applyEffectsTab];for(var e=0,i=t;e<i.length;e++){var r=i[e];r.group.onResize()}};t.prototype.displayBpmForNoBpm=function(){var t;try{t=parseFloat(this.selectBpmTxt.text)}catch(e){t=120}return String(t)};t.prototype.updateDefaultBpm=function(t){var e=t.bpm?t.displayBpm():this.displayBpmForNoBpm();this.selectBpmTxt.text=e;Q(this.selectBpmTxt,{type:"decimal",min:1},e)};t.prototype.isUseDynamicBpm=function(){return-1!==this.selectBpmTxt.text.indexOf(g)};return t}();function de(){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1};Array.prototype.includes=function(t){return-1!==this.indexOf(t)};Array.prototype.forEach=function(t){for(var e=0;e<this.length;e++){var i=this[e];t(i,e,this)}};DropDownList.prototype.getSelectedIndex=function(){for(var t=0;t<this.items.length;t++)if(this.items[t].selected)return t;return-1};Math.sign=function(t){if(t>0)return 1;else if(t<0)return-1;else return 0}}if("aftereffects"!==BridgeTalk.appName)throw new P;else if(parseFloat(app.version)<9)throw new X;else{de();fe.build(t,e)}})(this);
